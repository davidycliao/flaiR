# This workflow uses actions that are not certified by GitHub.
# They are provided by a third-party and are governed by
# separate terms of service, privacy policy, and support
# documentation.
#
# See https://github.com/r-lib/actions/tree/master/examples#readme for
# additional example workflows available for the R community.

name: flaiR-Windows
on:
 push:
   branches: [ "main" ]
 pull_request:
   branches: [ "main" ]

jobs:
 test-installation:
   runs-on: windows-latest
   strategy:
     matrix:
       r-version: ['4.2.0']
       python-version: ['3.10']
     fail-fast: false

   steps:
   - uses: actions/setup-python@v4
     with:
       python-version: ${{ matrix.python-version }}

   - name: Verify Python
     run: |
       python --version
       where python
     shell: cmd

   - uses: r-lib/actions/setup-r@v2
     with:
       r-version: ${{ matrix.r-version }}

   - name: Install R dependencies
     run: |
       Rscript -e "install.packages(c('reticulate', 'remotes'), repos='https://cran.r-project.org')"
       Rscript -e "reticulate::py_config()"
     shell: cmd

   - name: Install flaiR
     env:
       GITHUB_PAT: ${{ secrets.GITHUB_TOKEN }}
     run: |
       Rscript -e "Sys.setenv(GITHUB_PAT = Sys.getenv('GITHUB_PAT')); tryCatch({remotes::install_github('davidycliao/flaiR', force = TRUE); library(flaiR); cat('flaiR installed and loaded successfully\n')}, error = function(e) {cat('Error during installation or loading:', conditionMessage(e), '\n'); quit(status = 1)})"
     shell: cmd

   - name: Print environment info
     if: always()
     run: |
       python --version
       R --version
       Rscript -e "reticulate::py_config()"
     shell: cmd

# name: R-Windows
#
# on: [push, pull_request]
#
# jobs:
#   build:
#     runs-on: windows-latest
#
#     steps:
#       - name: Check out repository
#         uses: actions/checkout@v2
#
#       - name: Install pandoc
#         run: choco install pandoc
#
#       - name: Set up Python
#         uses: actions/setup-python@v2
#         with:
#           python-version: '3.10.x'
#
#       - name: Install Python virtualenv
#         run: pip install virtualenv
#
#       - name: Create Python virtual environment
#         run: virtualenv flair_env
#
#       - name: Install Python dependencies in virtual environment
#         run: |
#           .\flair_env\Scripts\activate
#           pip install flair
#
#       - name: Set up R
#         uses: r-lib/actions/setup-r@v2
#         with:
#           r-version: '4.0.5'
#
#       - name: Install R dependencies
#         run: |
#           install.packages(c("remotes", "rcmdcheck", "reticulate", "rmarkdown"))
#           remotes::install_deps(dependencies = TRUE)
#         shell: Rscript {0}
#
#       - name: Install Python virtualenv
#         run: pip install virtualenv
#         shell: cmd
#
#       - name: Create Python virtual environment
#         run: virtualenv flair_env
#         shell: cmd
#
#       - name: Install Python dependencies in virtual environment
#         run: |
#           flair_env\Scripts\activate
#           pip install flair
#         shell: cmd
#
#       - name: Remove Python cache files
#         run: del /s /q *.pyc
#         shell: cmd
#
#       - name: Check (with virtual environment)
#         run: |
#           flair_env\Scripts\activate
#           R CMD build --no-build-vignettes .
#           R CMD check *tar.gz --no-manual --no-examples
#         shell: cmd
#
#
