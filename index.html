<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="Provides a suite of intuitive and flexible wrapper tools tailored 
             for accessing FLAIR in Python data analysis. The package is an R wrapper 
             designed to provide access to the primary features of FLAIR. 
             FLAIR  is an advanced framework for state-of-the-art natural language 
             processing tasks and sequence tagging. FLAIR offers features such as 
             part-of-speech tagging, transformer-based sentiment analysis, 
             and named entity recognition. To function properly, this package 
             requires Python 3.8 or higher.">
<title>An R Wrapper for Accessing Flair NLP Library â€¢ flaiR</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="apple-touch-icon-60x60.png">
<script src="deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="deps/Source_Sans_Pro-0.4.7/font.css" rel="stylesheet">
<link href="deps/Source_Code_Pro-0.4.7/font.css" rel="stylesheet">
<!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="pkgdown.js"></script><meta property="og:title" content="An R Wrapper for Accessing Flair NLP Library">
<meta property="og:description" content="Provides a suite of intuitive and flexible wrapper tools tailored 
             for accessing FLAIR in Python data analysis. The package is an R wrapper 
             designed to provide access to the primary features of FLAIR. 
             FLAIR  is an advanced framework for state-of-the-art natural language 
             processing tasks and sequence tagging. FLAIR offers features such as 
             part-of-speech tagging, transformer-based sentiment analysis, 
             and named entity recognition. To function properly, this package 
             requires Python 3.8 or higher.">
<meta property="og:image" content="https://davidycliao.github.io/flaiR/logo.png">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--><!-- Global site tag (gtag.js) - Google Analytics --><script async src="https://www.googletagmanager.com/gtag/js?id=G-3ZG40PPG98"></script><script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-3ZG40PPG98');
</script><script defer data-domain="{YOUR DOMAIN},all.tidyverse.org" src="https://plausible.io/js/plausible.js"></script>
</head>
<body>
    <a href="#container" class="visually-hidden-focusable">Skip to content</a>
    

    <nav class="navbar fixed-top navbar-inverse navbar-expand-lg bg-none"><div class="container">
    
    <a class="navbar-brand me-2" href="index.html">flaiR</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="Released version">0.0.6</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="active nav-item">
  <a class="nav-link" href="index.html">
    <span class="fa fa-home"></span>
     
  </a>
</li>
<li class="nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown--quick-start">
    <span class="fa fa-rocket"></span>
     
    Quick Start
  </a>
  <div class="dropdown-menu" aria-labelledby="dropdown--quick-start">
    <a class="dropdown-item" href="articles/quickstart.html#why-write-%7BflaiR%7D-to-access-fair-nlp-in-python">Why {flaiR}</a>
    <a class="dropdown-item" href="articles/quickstart.html#install-flair-with-using-remotes">Install flaiR via GitHub</a>
    <a class="dropdown-item" href="articles/quickstart.html#class-and-ojbect-in-r-via-flair">Class and Ojbect in R</a>
    <a class="dropdown-item" href="articles/quickstart.html#embeddings">FlaiR Embeddings</a>
    <a class="dropdown-item" href="articles/quickstart.html#expanded-feats-for-nlp-tasks-in-flair">Feats in flaiR</a>
    <a class="dropdown-item" href="articles/quickstart.html#how-to-contribute">How to Contribute</a>
  </div>
</li>
<li class="nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown--tutorials">
    <span class="fa fa-project-diagram"></span>
     
    Tutorials
  </a>
  <div class="dropdown-menu" aria-labelledby="dropdown--tutorials">
    <a class="dropdown-item" href="articles/tutorial.html#introduction">Introduction</a>
    <a class="dropdown-item" href="articles/tutorial.html#sentence-and-token">Sentence and Token</a>
    <a class="dropdown-item" href="articles/tutorial.html#sequence-taggings">Sequence Taggings</a>
    <a class="dropdown-item" href="articles/tutorial.html#flair-embedding">Flair Embeddings</a>
    <a class="dropdown-item" href="articles/tutorial.html#training-a-binary-classifier-in-flair">Training a Binary Classifier in flaiR</a>
    <a class="dropdown-item" href="articles/tutorial.html#training-a-rnn-with-flair">Training a RNN with FlaiR</a>
  </div>
</li>
<li class="nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown--expanded-feats">
    <span class="fa fa-newspaper-o"></span>
     
    Expanded Feats
  </a>
  <div class="dropdown-menu" aria-labelledby="dropdown--expanded-feats">
    <a class="dropdown-item" href="articles/get_pos.html">Part-of-speech Tagging</a>
    <a class="dropdown-item" href="articles/get_entities.html">Named Entity Recognition</a>
    <a class="dropdown-item" href="articles/get_sentiments.html">Tagging Sentiment</a>
    <a class="dropdown-item" href="articles/highlight_text.html">The Coloring Entities</a>
    <h6 class="dropdown-header" data-toc-skip>Visualizing the Sentiments (in progress)</h6>
  </div>
</li>
<li class="nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown--reference">
    <span class="fa fa-file-code-o"></span>
     
    Reference
  </a>
  <div class="dropdown-menu" aria-labelledby="dropdown--reference">
    <a class="dropdown-item" href="reference/index.html">All Function Reference</a>
  </div>
</li>
<li class="nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown--news">
    <span class="fa fa-newspaper-o"></span>
     
    News
  </a>
  <div class="dropdown-menu" aria-labelledby="dropdown--news">
    <a class="dropdown-item" href="news/index.html#flair-006-2023-10-29">0.0.6</a>
    <a class="dropdown-item" href="news/index.html#flair-005-2023-10-01">0.0.5</a>
    <a class="dropdown-item" href="news/index.html#flair-003-2023-09-10">0.0.3</a>
    <a class="dropdown-item" href="news/index.html#flair-001-development-version">0.0.1</a>
  </div>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav">
<li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/davidycliao/flaiR">
    <span class="fa fa-github fa-lg"></span>
     
    GitHub
  </a>
</li>
      </ul>
</div>

    
  </div>
</nav><div class="container template-home" id="container">
<div class="row">
  <main id="main" class="col-md-9"><div class="section level2">
<h2 id="flairr-an-r-wrapper-for-accessing-flair-nlp-library-">
<u><code>flairR</code></u>: An R Wrapper for Accessing Flair NLP Library <img src="reference/figures/logo.png" align="right" width="180"><a class="anchor" aria-label="anchor" href="#flairr-an-r-wrapper-for-accessing-flair-nlp-library-"></a>
</h2>
<p><a href="https://github.com/davidycliao/flaiR/actions/workflows/r_macos.yml" class="external-link"><img src="https://github.com/davidycliao/flaiR/actions/workflows/r_macos.yml/badge.svg" alt="R-MacOS"></a> <a href="https://github.com/davidycliao/flaiR/actions/workflows/r_ubuntu.yaml" class="external-link"><img src="https://github.com/davidycliao/flaiR/actions/workflows/r_ubuntu.yaml/badge.svg" alt="R-ubuntu"></a> <a href="https://github.com/davidycliao/flaiR/actions/workflows/r_window.yml" class="external-link"><img src="https://github.com/davidycliao/flaiR/actions/workflows/r_window.yml/badge.svg" alt="R-Windows"></a></p>
<p><a href="https://github.com/davidycliao/flaiR/actions/workflows/r.yml" class="external-link"><img src="https://github.com/davidycliao/flaiR/actions/workflows/r.yml/badge.svg" alt="R-CMD-Check"></a> <a href="https://github.com/davidycliao/flaiR/actions/workflows/test-coverage.yaml" class="external-link"><img src="https://github.com/davidycliao/flaiR/actions/workflows/test-coverage.yaml/badge.svg" alt="coverage"></a> <a href="https://codecov.io/gh/davidycliao/flaiR" class="external-link"><img src="https://codecov.io/gh/davidycliao/flaiR/graph/badge.svg?token=CPIBIB6L78" alt="codecov"></a> <a href="https://www.codefactor.io/repository/github/davidycliao/flair" class="external-link"><img src="https://www.codefactor.io/repository/github/davidycliao/flair/badge" alt="CodeFactor"></a></p>
<!-- README.md is generated from README.Rmd. Please edit that file -->
<div style="text-align: justify">
<p><code>{flaiR}</code> is an R wrapper for the <a href="https://github.com/flairnlp/flair" class="external-link">{flairNLP/flair}</a> library in Python, designed specifically for R users, especially those in the social sciences. It provides easy access to the main functionalities of <code>{flairNLP}</code>. Developed by Developed by <a href="https://engineering.zalando.com/posts/2018/11/zalando-research-releases-flair.html" class="external-link">Zalando Research</a> in Berlin, Flair NLP offers intuitive interfaces and exceptional multilingual support, particularly for various embedding frameworks and state-of-the-art natural language processing models to analyze your text, such as named entity recognition, sentiment analysis, part-of-speech tagging, biomedical data, sense disambiguation, and classification, with support for a rapidly growing number of languages in the community. For a comprehensive understanding of the <code>{flairNLP/flair}</code> architecture, you can refer to the research article â€˜<a href="https://aclanthology.org/C18-1139.pdf" class="external-link">Contextual String Embeddings for Sequence Labeling</a>â€™ and the official <a href="https://flairnlp.github.io" class="external-link">manual</a> written for its Python implementation.</p>
</div>
<p><br></p>
</div>
<div class="section level2">
<h2 id="installation-via-github">Installation via <u><strong><code>GitHub</code></strong></u>
<a class="anchor" aria-label="anchor" href="#installation-via-github"></a>
</h2>
<div style="text-align: justify">
<p>The installation consists of two parts: First, install <a href="https://www.python.org/downloads/" class="external-link">Python 3.8</a> or higher (avoid developmental versions and the very latest release for compatibility reasons). Secondly, install <a href="https://www.r-project.org" class="external-link">R 4.2.0</a> or higher.</p>
<p><strong>System Requirement:</strong></p>
<ul>
<li><p>Python (&gt;= 3.10.x)</p></li>
<li><p>R (&gt;= 4.2.0)</p></li>
<li><p>RStudio <strong><em>(The GUI interface allows users to adjust and manage the Python environment in R)</em></strong></p></li>
<li><p>Anaconda <strong><em>(highly recommended)</em></strong></p></li>
</ul>
<p>We have tested flaiR using CI/CD with GitHub Actions, conducting integration tests across <a href="https://github.com/davidycliao/flaiR/actions" class="external-link">various operating syste</a> These tests include intergration between R versions 4.2.1, 4.3.2, and 4.2.0 and Python 3.10.x. The testing also covers environments with flair NLP and PyTorch (given that <a href="https://flairnlp.github.io" class="external-link">Flair NLP</a> is built on <a href="https://pytorch.org" class="external-link">Torch</a>). For stable usage, we strongly recommend installing these specific versions.</p>
<p>When first installed, {<code>flaiR</code>} automatically detects whether you have Python 3.8 or higher. If not, it will skip the automatic installation of Python and flair NLP. In this case, you will need to manually install it yourself and reload {<code>flaiR</code>} again. If you have correct Pythoninstalled, the {<code>flaiR</code>} will automatically install flair Python NLP in your global environment. If you are using {reticulate}, {flaiR} will typically assume the <strong>r-reticulate</strong> environment by default. At the same time, you can use <code>py_config()</code> to check the location of your environment. Please note that flaiR will directly install flair NLP in the Python environment that your R is using. This environment can be adjusted through <em>RStudio</em> by navigating to <strong><code>Tools -&gt; Global Options -&gt; Python</code></strong>. If there are any issues with the installation, feel free to ask in the <u><a href="https://github.com/davidycliao/flaiR/discussions" class="external-link">Discussion</a> </u>.</p>
<p>First, understanding which Python environment your RStudio is using is very important. We advise you to confirm which Python environment RStudio is using. You can do this by checking with <code><a href="https://rstudio.github.io/reticulate/reference/py_config.html" class="external-link">reticulate::py_config()</a></code> or manually via <strong>Tools -&gt; Global Options -&gt; Python</strong>.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/install.packages.html" class="external-link">install.packages</a></span><span class="op">(</span><span class="st">"reticulate"</span><span class="op">)</span></span>
<span><span class="fu">reticulate</span><span class="fu">::</span><span class="fu"><a href="https://rstudio.github.io/reticulate/reference/py_config.html" class="external-link">py_config</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p>At this stage, youâ€™ll observe that RStudio has defaulted to using the â€˜flair_envâ€™ environment I have set up. Consequently, the Python Flair package will be installed within this environment. Should you wish to modify this setting, you have the option to either adjust it within RStudioâ€™s settings or utilize the {reticulate} package to manage the Python environment in RStudio.</p>
<pre class="shell"><code><span><span class="co">#&gt; python:         /Users/*********/.virtualenvs/flair_env/bin/python</span></span>
<span><span class="co">#&gt; libpython:      /Users/*********/.pyenv/versions/3.10.13/lib/libpython3.10.dylib</span></span>
<span><span class="co">#&gt; pythonhome:     /Users/*********/.virtualenvs/flair_env:/Users/*********/.virtualenvs/flair_env</span></span>
<span><span class="co">#&gt; version:        3.10.13 (main, Oct 27 2023, 04:44:16) [Clang 15.0.0 (clang-1500.0.40.1)]</span></span>
<span><span class="co">#&gt; numpy:          /Users/*********/.virtualenvs/flair_env/lib/python3.10/site-packages/numpy</span></span>
<span><span class="co">#&gt; numpy_version:  1.26.2</span></span>
<span><span class="co">#&gt; flair:          /Users/*********/.virtualenvs/flair_env/lib/python3.10/site-packages/flair</span></span>
<span></span>
<span><span class="co">#&gt; NOTE: Python version was forced by use_python() function</span></span></code></pre>
<p>Now, you can confidently install flaiR in your R environment.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/install.packages.html" class="external-link">install.packages</a></span><span class="op">(</span><span class="st">"remotes"</span><span class="op">)</span></span>
<span><span class="fu">remotes</span><span class="fu">::</span><span class="fu"><a href="https://remotes.r-lib.org/reference/install_github.html" class="external-link">install_github</a></span><span class="op">(</span><span class="st">"davidycliao/flaiR"</span>, force <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
<p>You will notice the following message, indicating a successful installation. This means that your RStudio has successfully detected the correct Python and has installed Flair in your Python environment</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">flaiR</span><span class="op">)</span></span>
<span><span class="co">#&gt; flaiR: An R Wrapper for Accessing Flair NLP 0.13.0</span></span></code></pre></div>
<p><br></p>
</div>
</div>
<div class="section level2">
<h2 id="introduction">Introduction<a class="anchor" aria-label="anchor" href="#introduction"></a>
</h2>
<div style="text-align: justify">
<p>For R users, {<code>flairR</code>} primarily consists of two main components. The first is wrapper functions in {<code>flaiR</code>} built on top of {<code>reticulate</code>}, which enables you to interact directly with Python modules in R and provides seamless support for documents and <a href="https://davidycliao.github.io/flaiR/articles/tutorial.html">tutorial (in progress)</a> in the R community. The {flaiR} package enables R users to leverage Flairâ€™s capabilities to train their own models using the Flair framework and state-of-the-art NLP models without the need to interact directly with Python.</p>
<p>Flair offers a simpler and more intuitive approach for training custom NLP models compared to using Transformer-based models directly. With Flair, data loading and preprocessing are streamlined, facilitating the easy integration of various pre-trained embeddings, including both traditional and Transformer-based types like BERT. The training process in Flair is condensed to just a few lines of code, with automatic handling of fundamental preprocessing steps. Evaluation and optimization are also made user-friendly with accessible tools. In addition, Flair NLP provides an easy framework for training language models and is compatible with HuggingFace.</p>
</div>
<div class="section level4">
<h4 id="training-models-with-huggingface-via-flair">
<strong>Training Models with HuggingFace via flaiR</strong><a class="anchor" aria-label="anchor" href="#training-models-with-huggingface-via-flair"></a>
</h4>
<div style="text-align: justify">
<p>The following example offers a straightforward introduction on how to fully train your own model using the Flair framework and import a <code>BERT</code> model from <a href="https://github.com/huggingface" class="external-link">HuggingFace ðŸ¤—</a>. This example utilizes grandstanding score as training data from Julia Parkâ€™s paper (<em><a href="https://www.journals.uchicago.edu/doi/abs/10.1086/709147?journalCode=jop&amp;mobileUi=0" class="external-link">When Do Politicians Grandstand? Measuring Message Politics in Committee Hearings</a></em>) and trains the model using Transformer-based models via flair NLP through <code>{flaiR}</code>.</p>
<p><u><strong>Step 1</strong></u> Split Data into Train and Test Sets with <code>flair</code> Sentence Object</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># load training data: grandstanding score from Julia Park's paper</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">flaiR</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="va">gs_score</span><span class="op">)</span> </span></code></pre></div>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># load flair functions via flaiR</span></span>
<span><span class="va">Sentence</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/flair_data.html">flair_data</a></span><span class="op">(</span><span class="op">)</span><span class="op">$</span><span class="va">Sentence</span></span>
<span><span class="va">Corpus</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/flair_data.html">flair_data</a></span><span class="op">(</span><span class="op">)</span><span class="op">$</span><span class="va">Corpus</span></span>
<span><span class="va">TransformerDocumentEmbeddings</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/flair_embeddings.html">flair_embeddings</a></span><span class="op">(</span><span class="op">)</span><span class="op">$</span><span class="va">TransformerDocumentEmbeddings</span></span>
<span><span class="va">TextClassifier</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/flair_models.html">flair_models</a></span><span class="op">(</span><span class="op">)</span><span class="op">$</span><span class="va">TextClassifier</span></span>
<span><span class="va">ModelTrainer</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/flair_trainers.html">flair_trainers</a></span><span class="op">(</span><span class="op">)</span><span class="op">$</span><span class="va">ModelTrainer</span></span></code></pre></div>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># split the data</span></span>
<span><span class="va">text</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span><span class="va">gs_score</span><span class="op">$</span><span class="va">speech</span>, <span class="va">Sentence</span><span class="op">)</span></span>
<span><span class="va">labels</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/character.html" class="external-link">as.character</a></span><span class="op">(</span><span class="va">gs_score</span><span class="op">$</span><span class="va">rescaled_gs</span><span class="op">)</span></span>
<span></span>
<span><span class="kw">for</span> <span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">text</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">text</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="fu">add_label</span><span class="op">(</span><span class="st">"classification"</span>, <span class="va">labels</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">2046</span><span class="op">)</span></span>
<span><span class="va">sample</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sample.html" class="external-link">sample</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="cn">TRUE</span>, <span class="cn">FALSE</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">text</span><span class="op">)</span>, replace<span class="op">=</span><span class="cn">TRUE</span>, prob<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.8</span>, <span class="fl">0.2</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">train</span>  <span class="op">&lt;-</span> <span class="va">text</span><span class="op">[</span><span class="va">sample</span><span class="op">]</span></span>
<span><span class="va">test</span>   <span class="op">&lt;-</span> <span class="va">text</span><span class="op">[</span><span class="op">!</span><span class="va">sample</span><span class="op">]</span></span></code></pre></div>
<p><u><strong>Step 2</strong></u> Preprocess Data and Corpus Object</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">corpus</span> <span class="op">&lt;-</span> <span class="fu">Corpus</span><span class="op">(</span>train<span class="op">=</span><span class="va">train</span>, test<span class="op">=</span><span class="va">test</span><span class="op">)</span></span>
<span><span class="co">#&gt; 2023-11-28 15:45:25,437 No dev split found. Using 0% (i.e. 282 samples) of the train split as dev data</span></span></code></pre></div>
<p><u><strong>Step 3</strong></u> Create Classifier Using Transformer</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">document_embeddings</span> <span class="op">&lt;-</span> <span class="fu">TransformerDocumentEmbeddings</span><span class="op">(</span><span class="st">'distilbert-base-uncased'</span>, fine_tune<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
<p><code>$make_label_dictionary</code> function is used to create a label dictionary for the classification task. The label dictionary is a mapping from label to index, which is used to map the labels to a tensor of label indices. expcept classifcation task, flair also supports other label types for training custom model, such as <code>ner</code>, <code>pos</code> and <code>sentiment</code>.</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">label_dict</span> <span class="op">&lt;-</span> <span class="va">corpus</span><span class="op">$</span><span class="fu">make_label_dictionary</span><span class="op">(</span>label_type<span class="op">=</span><span class="st">"classification"</span><span class="op">)</span></span>
<span><span class="co">#&gt; 2023-11-28 15:45:27,011 Computing label dictionary. Progress:</span></span>
<span><span class="co">#&gt; 2023-11-28 15:45:27,061 Dictionary created for label 'classification' with 2 values: 0 (seen 1325 times), 1 (seen 1209 times)</span></span></code></pre></div>
<p><code>$item2idx</code> method to check the mapping from label to index. This is very important to make sure the labels are mapped correctly to the indices and tensors.</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">label_dict</span><span class="op">$</span><span class="va">item2idx</span></span>
<span><span class="co">#&gt; $`b'0'`</span></span>
<span><span class="co">#&gt; [1] 0</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $`b'1'`</span></span>
<span><span class="co">#&gt; [1] 1</span></span></code></pre></div>
<p><code>TextClassifier</code> is used to create a text classifier. The classifier takes the document embeddings (importing from <code>'distilbert-base-uncased</code> from HugginFace) and the label dictionary as input. The label type is also specified as classification.</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">classifier</span> <span class="op">&lt;-</span> <span class="fu">TextClassifier</span><span class="op">(</span><span class="va">document_embeddings</span>,</span>
<span>                             label_dictionary<span class="op">=</span><span class="va">label_dict</span>, </span>
<span>                             label_type<span class="op">=</span><span class="st">'classification'</span><span class="op">)</span></span></code></pre></div>
<p><u><strong>Step 4</strong></u> Start Training</p>
<p>specific computation devices on your local machine. If you have a GPU, you can use <code>flair_gpu</code> to specify the GPU device. If you donâ€™t have a GPU, you can use <code><a href="reference/flair_device.html">flaiR::flair_device</a></code> to specify the CPU device.</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">classifier</span><span class="op">$</span><span class="fu">to</span><span class="op">(</span><span class="fu"><a href="reference/flair_device.html">flair_device</a></span><span class="op">(</span><span class="st">"cpu"</span><span class="op">)</span><span class="op">)</span> </span>
<span><span class="co">#&gt; TextClassifier(</span></span>
<span><span class="co">#&gt;   (embeddings): TransformerDocumentEmbeddings(</span></span>
<span><span class="co">#&gt;     (model): DistilBertModel(</span></span>
<span><span class="co">#&gt;       (embeddings): Embeddings(</span></span>
<span><span class="co">#&gt;         (word_embeddings): Embedding(30523, 768)</span></span>
<span><span class="co">#&gt;         (position_embeddings): Embedding(512, 768)</span></span>
<span><span class="co">#&gt;         (LayerNorm): LayerNorm((768,), eps=1e-12, elementwise_affine=True)</span></span>
<span><span class="co">#&gt;         (dropout): Dropout(p=0.1, inplace=False)</span></span>
<span><span class="co">#&gt;       )</span></span>
<span><span class="co">#&gt;       (transformer): Transformer(</span></span>
<span><span class="co">#&gt;         (layer): ModuleList(</span></span>
<span><span class="co">#&gt;           (0-5): 6 x TransformerBlock(</span></span>
<span><span class="co">#&gt;             (attention): MultiHeadSelfAttention(</span></span>
<span><span class="co">#&gt;               (dropout): Dropout(p=0.1, inplace=False)</span></span>
<span><span class="co">#&gt;               (q_lin): Linear(in_features=768, out_features=768, bias=True)</span></span>
<span><span class="co">#&gt;               (k_lin): Linear(in_features=768, out_features=768, bias=True)</span></span>
<span><span class="co">#&gt;               (v_lin): Linear(in_features=768, out_features=768, bias=True)</span></span>
<span><span class="co">#&gt;               (out_lin): Linear(in_features=768, out_features=768, bias=True)</span></span>
<span><span class="co">#&gt;             )</span></span>
<span><span class="co">#&gt;             (sa_layer_norm): LayerNorm((768,), eps=1e-12, elementwise_affine=True)</span></span>
<span><span class="co">#&gt;             (ffn): FFN(</span></span>
<span><span class="co">#&gt;               (dropout): Dropout(p=0.1, inplace=False)</span></span>
<span><span class="co">#&gt;               (lin1): Linear(in_features=768, out_features=3072, bias=True)</span></span>
<span><span class="co">#&gt;               (lin2): Linear(in_features=3072, out_features=768, bias=True)</span></span>
<span><span class="co">#&gt;               (activation): GELUActivation()</span></span>
<span><span class="co">#&gt;             )</span></span>
<span><span class="co">#&gt;             (output_layer_norm): LayerNorm((768,), eps=1e-12, elementwise_affine=True)</span></span>
<span><span class="co">#&gt;           )</span></span>
<span><span class="co">#&gt;         )</span></span>
<span><span class="co">#&gt;       )</span></span>
<span><span class="co">#&gt;     )</span></span>
<span><span class="co">#&gt;   )</span></span>
<span><span class="co">#&gt;   (decoder): Linear(in_features=768, out_features=2, bias=True)</span></span>
<span><span class="co">#&gt;   (dropout): Dropout(p=0.0, inplace=False)</span></span>
<span><span class="co">#&gt;   (locked_dropout): LockedDropout(p=0.0)</span></span>
<span><span class="co">#&gt;   (word_dropout): WordDropout(p=0.0)</span></span>
<span><span class="co">#&gt;   (loss_function): CrossEntropyLoss()</span></span>
<span><span class="co">#&gt; )</span></span></code></pre></div>
<p><code>ModelTrainer</code> is used to train the model, which learns from the data based on the grandstanding score.</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">trainer</span> <span class="op">&lt;-</span> <span class="fu">ModelTrainer</span><span class="op">(</span><span class="va">classifier</span>, <span class="va">corpus</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">trainer</span><span class="op">$</span><span class="fu">train</span><span class="op">(</span><span class="st">'grand_standing_model'</span>,          <span class="co"># output directory</span></span>
<span>              learning_rate<span class="op">=</span><span class="fl">0.02</span>,              <span class="co"># learning rate: if batch_growth_annealing activates,lr should starts a bit higher.</span></span>
<span>              mini_batch_size<span class="op">=</span><span class="fl">8L</span>,              <span class="co"># batch size</span></span>
<span>              anneal_with_restarts <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>              save_final_model<span class="op">=</span><span class="cn">TRUE</span>,</span>
<span>              max_epochs<span class="op">=</span><span class="fl">3L</span><span class="op">)</span>                   <span class="co"># Maximum number of epochs</span></span></code></pre></div>
<p><u><strong>Step 5</strong></u> Evaluate the Model</p>
<p>During and after the model training process, evaluating the performance of the trained model on the development set is straightforward and easy.</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># import the performance metrics generated during the training process</span></span>
<span><span class="va">performance_df</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/utils/read.table.html" class="external-link">read.table</a></span><span class="op">(</span>file <span class="op">=</span> <span class="st">"grand_standing/loss.tsv"</span>, header <span class="op">=</span> <span class="cn">TRUE</span>, sep <span class="op">=</span> <span class="st">"\t"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">performance_df</span><span class="op">)</span></span>
<span><span class="co">#&gt;   EPOCH TIMESTAMP LEARNING_RATE TRAIN_LOSS DEV_LOSS DEV_PRECISION DEV_RECALL</span></span>
<span><span class="co">#&gt; 1     1  13:07:11          0.02     0.6071   0.6314        0.7250     0.7250</span></span>
<span><span class="co">#&gt; 2     2  13:11:19          0.02     0.4509   0.6139        0.7393     0.7393</span></span>
<span><span class="co">#&gt; 3     3  13:21:47          0.02     0.3294   0.6228        0.7464     0.7464</span></span>
<span><span class="co">#&gt; 4     4  13:25:03          0.02     0.2513   0.6628        0.7393     0.7393</span></span>
<span><span class="co">#&gt; 5     5  13:28:10          0.02     0.1109   0.6920        0.7429     0.7429</span></span>
<span><span class="co">#&gt; 6     6  13:31:16          0.02     0.0553   0.7023        0.7429     0.7429</span></span>
<span><span class="co">#&gt;   DEV_F1 DEV_ACCURACY</span></span>
<span><span class="co">#&gt; 1 0.7250       0.7250</span></span>
<span><span class="co">#&gt; 2 0.7393       0.7393</span></span>
<span><span class="co">#&gt; 3 0.7464       0.7464</span></span>
<span><span class="co">#&gt; 4 0.7393       0.7393</span></span>
<span><span class="co">#&gt; 5 0.7429       0.7429</span></span>
<span><span class="co">#&gt; 6 0.7429       0.7429</span></span></code></pre></div>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org" class="external-link">ggplot2</a></span><span class="op">)</span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">performance_df</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">EPOCH</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>y <span class="op">=</span> <span class="va">TRAIN_LOSS</span>, color <span class="op">=</span> <span class="st">"Training Loss"</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>y <span class="op">=</span> <span class="va">DEV_LOSS</span>, color <span class="op">=</span> <span class="st">"Development Loss"</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>y <span class="op">=</span> <span class="va">DEV_RECALL</span>, color <span class="op">=</span> <span class="st">"Development Recall"</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>y <span class="op">=</span> <span class="va">DEV_F1</span>, color <span class="op">=</span> <span class="st">"Development F1"</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>title <span class="op">=</span> <span class="st">"Training and Development Loss per Epoch"</span>,</span>
<span>       x <span class="op">=</span> <span class="st">"Epoch / Grandstanding Classifier"</span>,</span>
<span>       y <span class="op">=</span> <span class="st">""</span><span class="op">)</span>  <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_manual.html" class="external-link">scale_color_manual</a></span><span class="op">(</span><span class="st">""</span>, </span>
<span>                     values <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Training Loss"</span> <span class="op">=</span> <span class="st">"blue"</span>,</span>
<span>                                <span class="st">"Development Loss"</span> <span class="op">=</span> <span class="st">"red"</span>,</span>
<span>                                <span class="st">"Development F1"</span> <span class="op">=</span> <span class="st">"green"</span><span class="op">)</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_minimal</a></span><span class="op">(</span><span class="op">)</span> </span></code></pre></div>
<p><img src="reference/figures/README-unnamed-chunk-15-1.png" width="100%"></p>
<p>The overall performance of the model on the test set is also straightforward and easy to evaluate. You can find the performance metrics in the <code>model/training.log</code> file.</p>
<div class="sourceCode" id="cb18"><pre class="sourceCode R"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" tabindex="-1"></a>Results<span class="sc">:</span></span>
<span id="cb18-2"><a href="#cb18-2" tabindex="-1"></a><span class="sc">-</span> F<span class="sc">-</span><span class="fu">score</span> (micro) <span class="fl">0.7443</span></span>
<span id="cb18-3"><a href="#cb18-3" tabindex="-1"></a><span class="sc">-</span> F<span class="sc">-</span><span class="fu">score</span> (macro) <span class="fl">0.7438</span></span>
<span id="cb18-4"><a href="#cb18-4" tabindex="-1"></a><span class="sc">-</span> Accuracy <span class="fl">0.7443</span></span>
<span id="cb18-5"><a href="#cb18-5" tabindex="-1"></a></span>
<span id="cb18-6"><a href="#cb18-6" tabindex="-1"></a>By class<span class="sc">:</span></span>
<span id="cb18-7"><a href="#cb18-7" tabindex="-1"></a>              precision    recall  f1<span class="sc">-</span>score   support</span>
<span id="cb18-8"><a href="#cb18-8" tabindex="-1"></a></span>
<span id="cb18-9"><a href="#cb18-9" tabindex="-1"></a>           <span class="dv">1</span>     <span class="fl">0.6781</span>    <span class="fl">0.8519</span>    <span class="fl">0.7551</span>       <span class="dv">324</span></span>
<span id="cb18-10"><a href="#cb18-10" tabindex="-1"></a>           <span class="dv">0</span>     <span class="fl">0.8362</span>    <span class="fl">0.6516</span>    <span class="fl">0.7324</span>       <span class="dv">376</span></span>
<span id="cb18-11"><a href="#cb18-11" tabindex="-1"></a></span>
<span id="cb18-12"><a href="#cb18-12" tabindex="-1"></a>    accuracy                         <span class="fl">0.7443</span>       <span class="dv">700</span></span>
<span id="cb18-13"><a href="#cb18-13" tabindex="-1"></a>   macro avg     <span class="fl">0.7572</span>    <span class="fl">0.7517</span>    <span class="fl">0.7438</span>       <span class="dv">700</span></span>
<span id="cb18-14"><a href="#cb18-14" tabindex="-1"></a>weighted avg     <span class="fl">0.7630</span>    <span class="fl">0.7443</span>    <span class="fl">0.7429</span>       <span class="dv">700</span></span></code></pre></div>
<p><u><strong>Step 6</strong></u> Apply the Trained Model on Unseen Data for Prediction</p>
<p>We use the statement in the dataset as an example.</p>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># load the trained model</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="va">statements</span><span class="op">)</span></span>
<span><span class="va">Sentence</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/flair_data.html">flair_data</a></span><span class="op">(</span><span class="op">)</span><span class="op">$</span><span class="va">Sentence</span></span>
<span></span>
<span><span class="va">text</span> <span class="op">&lt;-</span> <span class="va">statements</span><span class="op">[</span><span class="fl">1</span>, <span class="st">"Statement"</span><span class="op">]</span></span>
<span><span class="va">sentence</span> <span class="op">&lt;-</span> <span class="fu">Sentence</span><span class="op">(</span><span class="va">text</span><span class="op">)</span></span></code></pre></div>
<p><code>lassifier$predict function is used to predict the label of the sentence. The function returns a sentence object with the predicted label.</code></p>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">classifier</span><span class="op">$</span><span class="fu">predict</span><span class="op">(</span><span class="va">sentence</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">sentence</span><span class="op">)</span></span>
<span><span class="co">#&gt; Sentence[55]: "Ladies and gentlemen, I stand before you today not just as a legislator, but as a defender of our very way of life! We are facing a crisis of monumental proportions, and if we don't act now, the very fabric of our society will unravel before our eyes!" â†’ 0 (0.6865)</span></span></code></pre></div>
<p><code>sentence$labels</code> is a list of labels, each of which has a value and a score. The value is the label itself, and the score is the probability of the label. The label with the highest score is the predicted label.</p>
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">sentence</span><span class="op">$</span><span class="va">labels</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">value</span></span>
<span><span class="co">#&gt; [1] "0"</span></span></code></pre></div>
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">sentence</span><span class="op">$</span><span class="va">labels</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">score</span></span>
<span><span class="co">#&gt; [1] 0.6864765</span></span></code></pre></div>
<p><u><strong>Step 7</strong></u> Reload the Model with the Best Performance</p>
<p>When you train the model with <code>save_final_model=TRUE</code>, the model with the best performance on the development set will be saved in the output directory. You can reload the model with the best performance using the <code>load</code> function.</p>
<div class="sourceCode" id="cb23"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">Sentence</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/flair_data.html">flair_data</a></span><span class="op">(</span><span class="op">)</span><span class="op">$</span><span class="va">Sentence</span></span>
<span><span class="va">TextClassifier</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/flair_models.html">flair_models</a></span><span class="op">(</span><span class="op">)</span><span class="op">$</span><span class="va">TextClassifier</span></span>
<span><span class="va">classifier</span> <span class="op">&lt;-</span> <span class="va">TextClassifier</span><span class="op">$</span><span class="fu">load</span><span class="op">(</span><span class="st">'grand_standing/best-model.pt'</span><span class="op">)</span></span></code></pre></div>
<p>We can create a function to classify the text using the specified Flair classifier.</p>
<div class="sourceCode" id="cb24"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">classify_text</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">text</span>, <span class="va">classifier</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="co"># Classifies the given text using the specified Flair classifier.</span></span>
<span>  <span class="co">#</span></span>
<span>  <span class="co"># Args:</span></span>
<span>  <span class="co"># text (str): The text to be classified.</span></span>
<span>  <span class="co"># classifier (TextClassifier): The Flair classifier to use for prediction.</span></span>
<span>  <span class="co">#</span></span>
<span>  <span class="co"># Returns:</span></span>
<span>  <span class="co">#   list: A list containing the predicted class label and score as strings.  </span></span>
<span>  <span class="va">sentence</span> <span class="op">&lt;-</span> <span class="fu">Sentence</span><span class="op">(</span><span class="va">text</span><span class="op">)</span></span>
<span>  <span class="va">classifier</span><span class="op">$</span><span class="fu">predict</span><span class="op">(</span><span class="va">sentence</span><span class="op">)</span></span>
<span>  <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span> <span class="op">(</span>labels  <span class="op">=</span> <span class="va">sentence</span><span class="op">$</span><span class="va">labels</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">value</span>, score  <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/character.html" class="external-link">as.character</a></span><span class="op">(</span><span class="va">sentence</span><span class="op">$</span><span class="va">labels</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">score</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="op">}</span></span></code></pre></div>
<p>Before performing classication tast, letâ€™s quickly check the dataset.</p>
<div class="sourceCode" id="cb25"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="va">statements</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">statements</span><span class="op">)</span></span>
<span><span class="co">#&gt;                                        Type</span></span>
<span><span class="co">#&gt; 1                Dramatic Appeal to Emotion</span></span>
<span><span class="co">#&gt; 2      Exaggerated Praise for a Local Issue</span></span>
<span><span class="co">#&gt; 3 Over-Simplified Solution to Complex Issue</span></span>
<span><span class="co">#&gt; 4             Personal Anecdote Over Policy</span></span>
<span><span class="co">#&gt; 5               Blaming Political Opponents</span></span>
<span><span class="co">#&gt;                                                                                                                                                                                                                                                     Statement</span></span>
<span><span class="co">#&gt; 1 Ladies and gentlemen, I stand before you today not just as a legislator, but as a defender of our very way of life! We are facing a crisis of monumental proportions, and if we don't act now, the very fabric of our society will unravel before our eyes!</span></span>
<span><span class="co">#&gt; 2                  I want to bring attention to the extraordinary achievement of the Smallville High School baseball team. Their victory is not just a win for Smallville, but a symbol of hope for our nation! This is what true American spirit looks like!</span></span>
<span><span class="co">#&gt; 3                                               The solution to our nation's economic struggles is simple: cut taxes. That's it. Cut them. The economy will skyrocket like never before. Why complicate things when the answer is right there in front of us?</span></span>
<span><span class="co">#&gt; 4                        I remember, back in my hometown, old Mr. Jenkins used to say, 'If it ain't broke, don't fix it.' That's exactly how I feel about our current healthcare system. We don't need reform; we just need good, old-fashioned common sense.</span></span>
<span><span class="co">#&gt; 5                                                     Every problem we face today can be traced back to the disastrous policies of the other party. They are the reason we are in this mess, and until we recognize that, we cannot move forward as a nation.</span></span></code></pre></div>
<p>Letâ€™s apply the function to the dataset.</p>
<div class="sourceCode" id="cb26"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw">for</span> <span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq_along</a></span><span class="op">(</span><span class="va">statements</span><span class="op">$</span><span class="va">Statement</span><span class="op">)</span> <span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">out_come</span> <span class="op">&lt;-</span> <span class="fu">classify_text</span><span class="op">(</span><span class="va">statements</span><span class="op">$</span><span class="va">Statement</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span>, <span class="va">classifier</span><span class="op">)</span></span>
<span>  <span class="va">statements</span><span class="op">[</span><span class="va">i</span>, <span class="st">'predicted_labels'</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">out_come</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span></span>
<span>  <span class="va">statements</span><span class="op">[</span><span class="va">i</span>, <span class="st">'prop_score'</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">out_come</span><span class="op">[[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span></span>
<span><span class="op">}</span></span></code></pre></div>
<div class="sourceCode" id="cb27"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">statements</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Type"</span>, <span class="st">"predicted_labels"</span>, <span class="st">"prop_score"</span><span class="op">)</span><span class="op">]</span></span>
<span><span class="co">#&gt;                                        Type predicted_labels        prop_score</span></span>
<span><span class="co">#&gt; 1                Dramatic Appeal to Emotion                1 0.998062312602997</span></span>
<span><span class="co">#&gt; 2      Exaggerated Praise for a Local Issue                1 0.985962450504303</span></span>
<span><span class="co">#&gt; 3 Over-Simplified Solution to Complex Issue                1 0.967254757881165</span></span>
<span><span class="co">#&gt; 4             Personal Anecdote Over Policy                1 0.998513281345367</span></span>
<span><span class="co">#&gt; 5               Blaming Political Opponents                1 0.999097466468811</span></span></code></pre></div>
</div>
<p><br></p>
<p>Secondly, to facilitate more efficient use for social science research, {<code>flairR</code>} expands {<code>flairNLP/flair</code>}â€™s core functionality for working with three major functions to extract features in a tidy and fast formatâ€“ <a href="https://cran.r-project.org/web/packages/data.table/index.html" class="external-link">data.table</a> in R.</p>
</div>
<div class="section level4">
<h4 id="performing-nlp-tasks-in-r">
<strong>Performing NLP Tasks in R</strong><a class="anchor" aria-label="anchor" href="#performing-nlp-tasks-in-r"></a>
</h4>
<div style="text-align: justify">
<p>The expanded features (and examples) can be found:</p>
<ul>
<li><a href="https://davidycliao.github.io/flaiR/articles/get_pos.html"><strong>part-of-speech tagging</strong></a></li>
<li><a href="https://davidycliao.github.io/flaiR/articles/get_entities.html"><strong>named entity recognition</strong></a></li>
<li><a href="https://davidycliao.github.io/flaiR/articles/get_sentiments.html"><strong>transformer-based sentiment analysis</strong></a></li>
</ul>
<p>In addition, to handle the load on RAM when dealing with larger corpus, {<code>flairR</code>} supports batch processing to handle texts in batches, which is especially useful when dealing with large datasets, to optimize memory usage and performance. The implementation of batch processing can also utilize GPU acceleration for faster computations.</p>
</div>
</div>
</div>
<div class="section level2">
<h2 id="contribution-and-open-source">Contribution and Open Source<a class="anchor" aria-label="anchor" href="#contribution-and-open-source"></a>
</h2>
<div style="text-align: justify">
<p><code>{flaiR}</code> is maintained and developed by <a href="https://davidycliao.github.io" class="external-link">David Liao</a> and friends. R developers who want to contribute to {<code>flaiR</code>} are welcome â€“ {<code>flaiR</code>} is an open source project. I warmly invite R users who share similar interests to join in contributing to this package. Please feel free to shoot me an email to collaborate on the task. Contributions â€“ whether they be comments, code suggestions, tutorial examples, or forking the repository â€“ are greatly appreciated. Please note that the <code>flaiR</code> is released with the <a href="https://github.com/davidycliao/flaiR/blob/master/CONDUCT.md" class="external-link">Contributor Code of Conduct</a>. By contributing to this project, you agree to abide by its terms.</p>
<p>The primary communication channel for R users can be found <a href="https://github.com/davidycliao/flaiR/discussions" class="external-link">here</a>. Please feel free to share your insights on the <a href="https://github.com/davidycliao/flaiR/discussions" class="external-link">Discussion</a> page and report any issues related to the R interface in the <a href="https://github.com/davidycliao/flaiR/issues" class="external-link">Issue</a> section. If the issue pertains to the actual implementation of Flair in Python, please submit a pull request to the offical <a href="https://github.com/flairnlp/flair" class="external-link">flair NLP</a>.</p>
</div>
<p><br></p>
</div>

  </main><aside class="col-md-3"><div class="links">
<h2 data-toc-skip>Links</h2>
<ul class="list-unstyled">
<li><a href="https://github.com/davidycliao/flaiR/" class="external-link">Browse source code</a></li>
<li><a href="https://github.com/davidycliao/flaiR/issues" class="external-link">Report a bug</a></li>
<li><a href="https://github.com/davidycliao/flaiR/discussions" class="external-link">Discussion</a></li>
<li><a href="https://flairnlp.github.io" class="external-link">flair in Python</a></li>
<li><a href="https://text-and-policy.com" class="external-link">Text and Policy Research Group @ UCD</a></li>
<li><a href="https://www.ucd.ie/connected_politics/" class="external-link">The Connected_Politics Lab @ UCD</a></li>
<li><a href="https://projectlacan.wordpress.com/team/" class="external-link">LACAN: Legislators, Accountability and Collective Agency</a></li>
<li><a href="https://dataverse.harvard.edu/dataset.xhtml?persistentId=doi:10.7910/DVN/L4OAKN" class="external-link">ParlSpeech: Legislative Speeches in the Key Parliamentary Democracies</a></li>
<li><a href="https://pureportal.strath.ac.uk/en/datasets/parlee-plenary-speeches-v2-data-set-annotated-full-text-of-151-mi" class="external-link">ParlEE: Sentence-level Speeches of Six EU Legislative Chambers</a></li>
</ul>
</div>

<div class="license">
<h2 data-toc-skip>License</h2>
<ul class="list-unstyled">
<li>
<a href="https://opensource.org/licenses/mit-license.php" class="external-link">MIT</a> + file <a href="LICENSE-text.html">LICENSE</a>
</li>
</ul>
</div>


<div class="citation">
<h2 data-toc-skip>Citation</h2>
<ul class="list-unstyled">
<li><a href="authors.html#citation">Citing flaiR</a></li>
</ul>
</div>

<div class="developers">
<h2 data-toc-skip>Developers</h2>
<ul class="list-unstyled">
<li>
<a href="https://davidycliao.github.io" class="external-link">David Liao</a> <br><small class="roles"> Maintainer, author </small>  </li>
<li>Akbik Alan <br><small class="roles"> Author, contributor </small>  </li>
<li>Blythe Duncan <br><small class="roles"> Author, contributor </small>  </li>
<li>Vollgraf Roland <br><small class="roles"> Author, contributor </small>  </li>
</ul>
</div>



  </aside>
</div>


   </div>
  <footer><div class="container">
  <div class="pkgdown-footer-left">
  <p></p>
<p>Developed by <a href="https://davidycliao.github.io" class="external-link">David Liao</a>, Akbik Alan, Blythe Duncan, Vollgraf Roland.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

  </div></footer>
</body>
</html>
