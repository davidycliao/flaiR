<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Tutorial • flaiR</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/Source_Sans_Pro-0.4.9/font.css" rel="stylesheet">
<link href="../deps/Source_Code_Pro-0.4.9/font.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Tutorial">
<!-- Global site tag (gtag.js) - Google Analytics --><script async src="https://www.googletagmanager.com/gtag/js?id=G-3ZG40PPG98"></script><script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-3ZG40PPG98');
</script><script defer data-domain="{YOUR DOMAIN},all.tidyverse.org" src="https://plausible.io/js/plausible.js"></script>
</head>
<body>
    <a href="#container" class="visually-hidden-focusable">Skip to content</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-none" data-bs-theme="inverse" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">flaiR</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="Released version">0.0.7</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../index.html"><span class="fa fa-home"></span></a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-quick-start" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true"><span class="fa fa-rocket"></span> Quick Start</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-quick-start">
<li><a class="dropdown-item" href="../articles/quickstart.html#nlp-tasks">NLP Tasks</a></li>
    <li><a class="dropdown-item" href="../articles/quickstart.html#class-and-ojbect">Class and Ojbect</a></li>
    <li><a class="dropdown-item" href="../articles/quickstart.html#more-details-about-installation">More Details about Installation</a></li>
  </ul>
</li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-tutorial" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true"><span class="fa fa-project-diagram"></span> Tutorial</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-tutorial">
<li><a class="dropdown-item" href="../articles/tutorial.html#introduction">Introduction</a></li>
    <li><a class="dropdown-item" href="../articles/tutorial.html#sentence-and-token">Sentence and Token</a></li>
    <li><a class="dropdown-item" href="../articles/tutorial.html#sequence-taggings">Sequence Taggings</a></li>
    <li><a class="dropdown-item" href="../articles/tutorial.html#performing-ner-tasks">Performing NER Tasks</a></li>
    <li><a class="dropdown-item" href="../articles/tutorial.html#embedding">Embeddings</a></li>
    <li><a class="dropdown-item" href="../articles/tutorial.html#training-a-binary-classifier">Training a Binary Classifier</a></li>
    <li><a class="dropdown-item" href="../articles/tutorial.html#training-rnns">Training RNNs</a></li>
    <li><a class="dropdown-item" href="../articles/tutorial.html#finetune-transformers">Finetune Transformers </a></li>
    <li><a class="dropdown-item" href="../articles/tutorial.html#extending-contexts-embedding-regression">Extending conText</a></li>
  </ul>
</li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-reference" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true"><span class="fa fa-file-code-o"></span> Reference</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-reference">
<li><a class="dropdown-item" href="../reference/index.html">All Function Reference</a></li>
  </ul>
</li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-news" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true"><span class="fa fa-newspaper-o"></span> News</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-news">
<li><a class="dropdown-item" href="../news/index.html#flair-006-2023-10-29">0.0.6</a></li>
    <li><a class="dropdown-item" href="../news/index.html#flair-005-2023-10-01">0.0.5</a></li>
    <li><a class="dropdown-item" href="../news/index.html#flair-003-2023-09-10">0.0.3</a></li>
    <li><a class="dropdown-item" href="../news/index.html#flair-001-development-version">0.0.1</a></li>
  </ul>
</li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/davidycliao/flaiR"><span class="fa fa-github fa-lg"></span> GitHub</a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article" id="container">



<link href="tutorial_files/htmltools-fill-0.5.8.1/fill.css" rel="stylesheet">
<script src="tutorial_files/htmlwidgets-1.6.4/htmlwidgets.js"></script><script src="tutorial_files/plotly-binding-4.10.4/plotly.js"></script><script src="tutorial_files/typedarray-0.1/typedarray.min.js"></script><link href="tutorial_files/crosstalk-1.2.1/css/crosstalk.min.css" rel="stylesheet">
<script src="tutorial_files/crosstalk-1.2.1/js/crosstalk.min.js"></script><link href="tutorial_files/plotly-htmlwidgets-css-2.11.1/plotly-htmlwidgets.css" rel="stylesheet">
<script src="tutorial_files/plotly-main-2.11.1/plotly-latest.min.js"></script><div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Tutorial</h1>
                        <h4 data-toc-skip class="author">Yen-Chieh Liao
| Sohini Timbadia | Stefan Müller</h4>
            <address class="author_afil">
      University of Birmingham &amp; University College
Dublin<br><small class="dont-index">Source: <a href="https://github.com/davidycliao/flaiR/blob/HEAD/vignettes/tutorial.Rmd" class="external-link"><code>vignettes/tutorial.Rmd</code></a></small>
      <div class="d-none name"><code>tutorial.Rmd</code></div>
    </address>
</div>

    
    
<div class="section level2">
<h2 id="the-overview">The Overview<a class="anchor" aria-label="anchor" href="#the-overview"></a>
</h2>
<div style="text-align: justify;">
<p><strong>Flair NLP</strong> is an open-source library for Natural
Language Processing (NLP) developed by <a href="https://github.com/zalandoresearch/" class="external-link">Zalando Research</a>. Known
for its state-of-the-art solutions, such as contextual string embeddings
for NLP tasks like Named Entity Recognition (NER), Part-of-Speech
tagging (POS), and more, it has garnered the attention of the NLP
community for its ease of use and powerful functionalities.</p>
<p>In addition, Flair NLP offers pre-trained models for various
languages and tasks, and is compatible with fine-tuned transformers
hosted on Hugging Face.</p>
</div>
<ul>
<li><p><a href="#tutorial.html#sentence-and-token"><strong>Sentence and
Token Object</strong></a></p></li>
<li><p><a href="#tutorial.html#sequence-taggings"><strong>Sequence
Taggings</strong></a></p></li>
<li><p><a href="#tutorial.html#flair-embedding"><strong>Embedding in
flaiR</strong></a></p></li>
<li><p><a href="#tutorial.html#performing-ner-tasks"><strong>Performing
NER Tasks</strong></a></p></li>
<li><p><a href="#tutorial.html#training-a-binary-classifier-in-flair"><strong>Training
a Binary Classifier in flaiR</strong></a></p></li>
<li><p><a href="#tutorial.html#training-rnns"><strong>Training
RNNa</strong></a></p></li>
<li><p><a href="#tutorial.html#finetune-transformers"><strong>Finetune
BERT</strong></a></p></li>
<li><p><a href="#tutorial.html#extending-contexts-embedding-regression"><strong>Extending
conText’s Embedding Regression</strong></a></p></li>
</ul>
<hr>
</div>
<div class="section level2">
<h2 id="sentence-and-token">Sentence and Token<a class="anchor" aria-label="anchor" href="#sentence-and-token"></a>
</h2>
<p>Sentence and Token are fundamental classes.</p>
<div class="section level3">
<h3 id="sentence">
<strong>Sentence</strong><a class="anchor" aria-label="anchor" href="#sentence"></a>
</h3>
<div style="text-align: justify;">
<p>A Sentence in Flair is an object that contains a sequence of Token
objects, and it can be annotated with labels, such as named entities,
part-of-speech tags, and more. It also can store embeddings for the
sentence as a whole and different kinds of linguistic annotations.</p>
<p>Here’s a simple example of how you create a Sentence:</p>
</div>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Creating a Sentence object</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://davidycliao.github.io/flaiR">flaiR</a></span><span class="op">)</span></span>
<span><span class="va">string</span> <span class="op">&lt;-</span> <span class="st">"What I see in UCD today, what I have seen of UCD in its impact on my own life and the life of Ireland."</span></span>
<span><span class="va">Sentence</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/flair_data.html">flair_data</a></span><span class="op">(</span><span class="op">)</span><span class="op">$</span><span class="va">Sentence</span></span>
<span><span class="va">sentence</span> <span class="op">&lt;-</span> <span class="fu">Sentence</span><span class="op">(</span><span class="va">string</span><span class="op">)</span></span></code></pre></div>
<p><code>Sentence[26]</code> means that there are a total of 26 tokens
in the sentence.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">sentence</span><span class="op">)</span></span>
<span><span class="co">#&gt; Sentence[26]: "What I see in UCD today, what I have seen of UCD in its impact on my own life and the life of Ireland."</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="token">
<strong>Token</strong><a class="anchor" aria-label="anchor" href="#token"></a>
</h3>
<div style="text-align: justify;">
<p>When you use Flair to handle text data,<a class="footnote-ref" tabindex="0" data-bs-toggle="popover" data-bs-content="&lt;p&gt;Flair is built on PyTorch, which is a library in
Python.&lt;/p&gt;"><sup>1</sup></a> <code>Sentence</code>
and <code>Token</code> objects often play central roles in many use
cases. When you create a Sentence object, it automatically tokenizes the
text, removing the need to create the Token object manually.</p>
<p>Unlike R, which indexes from 1, Python indexes from 0. Therefore,
when using a for loop, I use <code>seq_along(sentence) - 1</code>. The
output should be something like:</p>
</div>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># The Sentence object has automatically created and contains multiple Token objects</span></span>
<span><span class="co"># We can iterate through the Sentence object to view each Token</span></span>
<span></span>
<span><span class="kw">for</span> <span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq_along</a></span><span class="op">(</span><span class="va">sentence</span><span class="op">)</span><span class="op">-</span><span class="fl">1</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">sentence</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span><span class="co">#&gt; Token[0]: "What"</span></span>
<span><span class="co">#&gt; Token[1]: "I"</span></span>
<span><span class="co">#&gt; Token[2]: "see"</span></span>
<span><span class="co">#&gt; Token[3]: "in"</span></span>
<span><span class="co">#&gt; Token[4]: "UCD"</span></span>
<span><span class="co">#&gt; Token[5]: "today"</span></span>
<span><span class="co">#&gt; Token[6]: ","</span></span>
<span><span class="co">#&gt; Token[7]: "what"</span></span>
<span><span class="co">#&gt; Token[8]: "I"</span></span>
<span><span class="co">#&gt; Token[9]: "have"</span></span>
<span><span class="co">#&gt; Token[10]: "seen"</span></span>
<span><span class="co">#&gt; Token[11]: "of"</span></span>
<span><span class="co">#&gt; Token[12]: "UCD"</span></span>
<span><span class="co">#&gt; Token[13]: "in"</span></span>
<span><span class="co">#&gt; Token[14]: "its"</span></span>
<span><span class="co">#&gt; Token[15]: "impact"</span></span>
<span><span class="co">#&gt; Token[16]: "on"</span></span>
<span><span class="co">#&gt; Token[17]: "my"</span></span>
<span><span class="co">#&gt; Token[18]: "own"</span></span>
<span><span class="co">#&gt; Token[19]: "life"</span></span>
<span><span class="co">#&gt; Token[20]: "and"</span></span>
<span><span class="co">#&gt; Token[21]: "the"</span></span>
<span><span class="co">#&gt; Token[22]: "life"</span></span>
<span><span class="co">#&gt; Token[23]: "of"</span></span>
<span><span class="co">#&gt; Token[24]: "Ireland"</span></span>
<span><span class="co">#&gt; Token[25]: "."</span></span></code></pre></div>
<p>Or you can directly use <code>$tokens</code> method to print all
tokens.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">sentence</span><span class="op">$</span><span class="va">tokens</span><span class="op">)</span></span>
<span><span class="co">#&gt; [[1]]</span></span>
<span><span class="co">#&gt; Token[0]: "What"</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; [[2]]</span></span>
<span><span class="co">#&gt; Token[1]: "I"</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; [[3]]</span></span>
<span><span class="co">#&gt; Token[2]: "see"</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; [[4]]</span></span>
<span><span class="co">#&gt; Token[3]: "in"</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; [[5]]</span></span>
<span><span class="co">#&gt; Token[4]: "UCD"</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; [[6]]</span></span>
<span><span class="co">#&gt; Token[5]: "today"</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; [[7]]</span></span>
<span><span class="co">#&gt; Token[6]: ","</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; [[8]]</span></span>
<span><span class="co">#&gt; Token[7]: "what"</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; [[9]]</span></span>
<span><span class="co">#&gt; Token[8]: "I"</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; [[10]]</span></span>
<span><span class="co">#&gt; Token[9]: "have"</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; [[11]]</span></span>
<span><span class="co">#&gt; Token[10]: "seen"</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; [[12]]</span></span>
<span><span class="co">#&gt; Token[11]: "of"</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; [[13]]</span></span>
<span><span class="co">#&gt; Token[12]: "UCD"</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; [[14]]</span></span>
<span><span class="co">#&gt; Token[13]: "in"</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; [[15]]</span></span>
<span><span class="co">#&gt; Token[14]: "its"</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; [[16]]</span></span>
<span><span class="co">#&gt; Token[15]: "impact"</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; [[17]]</span></span>
<span><span class="co">#&gt; Token[16]: "on"</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; [[18]]</span></span>
<span><span class="co">#&gt; Token[17]: "my"</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; [[19]]</span></span>
<span><span class="co">#&gt; Token[18]: "own"</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; [[20]]</span></span>
<span><span class="co">#&gt; Token[19]: "life"</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; [[21]]</span></span>
<span><span class="co">#&gt; Token[20]: "and"</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; [[22]]</span></span>
<span><span class="co">#&gt; Token[21]: "the"</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; [[23]]</span></span>
<span><span class="co">#&gt; Token[22]: "life"</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; [[24]]</span></span>
<span><span class="co">#&gt; Token[23]: "of"</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; [[25]]</span></span>
<span><span class="co">#&gt; Token[24]: "Ireland"</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; [[26]]</span></span>
<span><span class="co">#&gt; Token[25]: "."</span></span></code></pre></div>
<p><strong>Retrieve the Token</strong></p>
<div style="text-align: justify;">
<p>To comprehend the string representation format of the Sentence
object, tagging at least one token is adequate. Python’s
<code>get_token(n)</code> method allows us to retrieve the Token object
for a particular token. Additionally, we can use
<strong><code>[]</code></strong> to index a specific token.</p>
</div>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># method in Python</span></span>
<span><span class="va">sentence</span><span class="op">$</span><span class="fu">get_token</span><span class="op">(</span><span class="fl">5</span><span class="op">)</span></span>
<span><span class="co">#&gt; Token[4]: "UCD"</span></span></code></pre></div>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># indexing in R </span></span>
<span><span class="va">sentence</span><span class="op">[</span><span class="fl">6</span><span class="op">]</span></span>
<span><span class="co">#&gt; Token[6]: ","</span></span></code></pre></div>
<div style="text-align: justify;">
<p>Each word (and punctuation) in the text is treated as an individual
Token object. These Token objects store text information and other
possible linguistic information (such as part-of-speech tags or named
entity tags) and embedding (if you used a model to generate them).</p>
<p>While you do not need to create Token objects manually, understanding
how to manage them is useful in situations where you might want to
fine-tune the tokenization process. For example, you can control the
exactness of tokenization by manually creating Token objects from a
Sentence object.</p>
<p>This makes Flair very flexible when handling text data since the
automatic tokenization feature can be used for rapid development, while
also allowing users to fine-tune their tokenization.</p>
</div>
<p><strong>Annotate POS tag and NER tag</strong></p>
<div style="text-align: justify;">
<p>The <code>add_label(label_type, value)</code> method can be employed
to assign a label to the token. In Universal POS tags, if
<code>sentence[10]</code> is ‘see’, ‘seen’ might be tagged as
<code>VERB</code>, indicating it is a past participle form of a
verb.</p>
</div>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">sentence</span><span class="op">[</span><span class="fl">10</span><span class="op">]</span><span class="op">$</span><span class="fu">add_label</span><span class="op">(</span><span class="st">'manual-pos'</span>, <span class="st">'VERB'</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">sentence</span><span class="op">[</span><span class="fl">10</span><span class="op">]</span><span class="op">)</span></span>
<span><span class="co">#&gt; Token[10]: "seen" → VERB (1.0000)</span></span></code></pre></div>
<div style="text-align: justify;">
<p>We can also add a NER (Named Entity Recognition) tag to
<code>sentence[4]</code>, “UCD”, identifying it as a university in
Dublin.</p>
</div>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">sentence</span><span class="op">[</span><span class="fl">4</span><span class="op">]</span><span class="op">$</span><span class="fu">add_label</span><span class="op">(</span><span class="st">'ner'</span>, <span class="st">'ORG'</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">sentence</span><span class="op">[</span><span class="fl">4</span><span class="op">]</span><span class="op">)</span></span>
<span><span class="co">#&gt; Token[4]: "UCD" → ORG (1.0000)</span></span></code></pre></div>
<div style="text-align: justify;">
<p>If we print the sentence object, <code>Sentence[50]</code> provides
information for 50 tokens → [‘in’/ORG, ‘seen’/VERB], thus displaying two
tagging pieces of information.</p>
</div>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">sentence</span><span class="op">)</span></span>
<span><span class="co">#&gt; Sentence[26]: "What I see in UCD today, what I have seen of UCD in its impact on my own life and the life of Ireland." → ["UCD"/ORG, "seen"/VERB]</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="corpus">
<strong>Corpus</strong><a class="anchor" aria-label="anchor" href="#corpus"></a>
</h3>
<p>The Corpus object in Flair is a fundamental data structure that
represents a dataset containing text samples, usually comprising of a
training set, a development set (or validation set), and a test set.
It’s designed to work smoothly with Flair’s models for tasks like named
entity recognition, text classification, and more.</p>
<p><strong>Attributes:</strong></p>
<ul>
<li>
<code>train</code>: A list of sentences (List[Sentence]) that form
the training dataset.</li>
<li>
<code>dev</code> (or development): A list of sentences
(List[Sentence]) that form the development (or validation) dataset.</li>
<li>
<code>test</code>: A list of sentences (List[Sentence]) that form
the test dataset.</li>
</ul>
<p><strong>Important Methods:</strong></p>
<ul>
<li>
<code>downsample</code>: This method allows you to downsample
(reduce) the number of sentences in the train, dev, and test
splits.</li>
<li>
<code>obtain_statistics</code>: This method gives a quick overview
of the statistics of the corpus, including the number of sentences and
the distribution of labels.</li>
<li>
<code>make_vocab_dictionary</code>: Used to create a vocabulary
dictionary from the corpus.</li>
</ul>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://davidycliao.github.io/flaiR">flaiR</a></span><span class="op">)</span></span>
<span><span class="va">Corpus</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/flair_data.html">flair_data</a></span><span class="op">(</span><span class="op">)</span><span class="op">$</span><span class="va">Corpus</span></span>
<span><span class="va">Sentence</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/flair_data.html">flair_data</a></span><span class="op">(</span><span class="op">)</span><span class="op">$</span><span class="va">Sentence</span></span></code></pre></div>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Create some example sentences</span></span>
<span><span class="va">train</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="fu">Sentence</span><span class="op">(</span><span class="st">'This is a training example.'</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">dev</span> <span class="op">&lt;-</span>  <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="fu">Sentence</span><span class="op">(</span><span class="st">'This is a validation example.'</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">test</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="fu">Sentence</span><span class="op">(</span><span class="st">'This is a test example.'</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Create a corpus using the custom data splits</span></span>
<span><span class="va">corp</span> <span class="op">&lt;-</span>  <span class="fu">Corpus</span><span class="op">(</span>train <span class="op">=</span> <span class="va">train</span>, dev <span class="op">=</span> <span class="va">dev</span>, test <span class="op">=</span> <span class="va">test</span><span class="op">)</span></span></code></pre></div>
<div style="text-align: justify;">
<p><code>$obtain_statistics()</code> method of the Corpus object in the
Flair library provides an overview of the dataset statistics. The method
returns a <a href="https://www.w3schools.com/python/python_dictionaries.asp" class="external-link">Python
dictionary</a> with details about the training, validation
(development), and test datasets that make up the corpus. In R, you can
use the jsonlite package to format JSON.</p>
</div>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://jeroen.r-universe.dev/jsonlite" class="external-link">jsonlite</a></span><span class="op">)</span></span>
<span><span class="va">data</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/jsonlite/man/fromJSON.html" class="external-link">fromJSON</a></span><span class="op">(</span><span class="va">corp</span><span class="op">$</span><span class="fu">obtain_statistics</span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">formatted_str</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/jsonlite/man/fromJSON.html" class="external-link">toJSON</a></span><span class="op">(</span><span class="va">data</span>, pretty<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">formatted_str</span><span class="op">)</span></span>
<span><span class="co">#&gt; {</span></span>
<span><span class="co">#&gt;   "TRAIN": {</span></span>
<span><span class="co">#&gt;     "dataset": ["TRAIN"],</span></span>
<span><span class="co">#&gt;     "total_number_of_documents": [1],</span></span>
<span><span class="co">#&gt;     "number_of_documents_per_class": {},</span></span>
<span><span class="co">#&gt;     "number_of_tokens_per_tag": {},</span></span>
<span><span class="co">#&gt;     "number_of_tokens": {</span></span>
<span><span class="co">#&gt;       "total": [6],</span></span>
<span><span class="co">#&gt;       "min": [6],</span></span>
<span><span class="co">#&gt;       "max": [6],</span></span>
<span><span class="co">#&gt;       "avg": [6]</span></span>
<span><span class="co">#&gt;     }</span></span>
<span><span class="co">#&gt;   },</span></span>
<span><span class="co">#&gt;   "TEST": {</span></span>
<span><span class="co">#&gt;     "dataset": ["TEST"],</span></span>
<span><span class="co">#&gt;     "total_number_of_documents": [1],</span></span>
<span><span class="co">#&gt;     "number_of_documents_per_class": {},</span></span>
<span><span class="co">#&gt;     "number_of_tokens_per_tag": {},</span></span>
<span><span class="co">#&gt;     "number_of_tokens": {</span></span>
<span><span class="co">#&gt;       "total": [6],</span></span>
<span><span class="co">#&gt;       "min": [6],</span></span>
<span><span class="co">#&gt;       "max": [6],</span></span>
<span><span class="co">#&gt;       "avg": [6]</span></span>
<span><span class="co">#&gt;     }</span></span>
<span><span class="co">#&gt;   },</span></span>
<span><span class="co">#&gt;   "DEV": {</span></span>
<span><span class="co">#&gt;     "dataset": ["DEV"],</span></span>
<span><span class="co">#&gt;     "total_number_of_documents": [1],</span></span>
<span><span class="co">#&gt;     "number_of_documents_per_class": {},</span></span>
<span><span class="co">#&gt;     "number_of_tokens_per_tag": {},</span></span>
<span><span class="co">#&gt;     "number_of_tokens": {</span></span>
<span><span class="co">#&gt;       "total": [6],</span></span>
<span><span class="co">#&gt;       "min": [6],</span></span>
<span><span class="co">#&gt;       "max": [6],</span></span>
<span><span class="co">#&gt;       "avg": [6]</span></span>
<span><span class="co">#&gt;     }</span></span>
<span><span class="co">#&gt;   }</span></span>
<span><span class="co">#&gt; }</span></span></code></pre></div>
<p><strong>In R</strong></p>
<div style="text-align: justify;">
<p>Below, we use data from the article <a href="https://www.google.com/url?sa=t&amp;rct=j&amp;q=&amp;esrc=s&amp;source=web&amp;cd=&amp;ved=2ahUKEwjz_bS3p5KCAxWEWEEAHcuVAi4QFnoECA8QAQ&amp;url=https%3A%2F%2Fwww.journals.uchicago.edu%2Fdoi%2Ffull%2F10.1086%2F715165&amp;usg=AOvVaw3f_J3sXTrym2ZR64pF3ZtN&amp;opi=89978449" class="external-link"><em>The
Temporal Focus of Campaign Communication</em></a> by <a href="https://muellerstefan.net" class="external-link">Stefan Muller</a>, published in the
<em>Journal of Politics</em> in 2020, as an example.</p>
<p>First, we vectorize the <code>cc_muller$text</code> using the
Sentence function to transform it into a list object. Then, we reformat
<code>cc_muller$class_pro_retro</code> as a factor. It’s essential to
note that R handles numerical values differently than Python. In R,
numerical values are represented with a floating point, so it’s
advisable to convert them into factors or strings. Lastly, we employ the
map function from the purrr package to assign labels to each sentence
corpus using the <code>$add_label</code> method.</p>
</div>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://purrr.tidyverse.org/" class="external-link">purrr</a></span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Attaching package: 'purrr'</span></span>
<span><span class="co">#&gt; The following object is masked from 'package:jsonlite':</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;     flatten</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="va">cc_muller</span><span class="op">)</span></span>
<span><span class="co"># The `Sentence` object tokenizes text </span></span>
<span><span class="va">text</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span> <span class="va">cc_muller</span><span class="op">$</span><span class="va">text</span>, <span class="va">Sentence</span><span class="op">)</span></span>
<span><span class="co"># split sentence object to train and test. </span></span>
<span><span class="va">labels</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">as.factor</a></span><span class="op">(</span><span class="va">cc_muller</span><span class="op">$</span><span class="va">class_pro_retro</span><span class="op">)</span></span>
<span><span class="co"># `$add_label` method assigns the corresponding coded type to each Sentence corpus.</span></span>
<span><span class="va">text</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://purrr.tidyverse.org/reference/map2.html" class="external-link">map2</a></span><span class="op">(</span><span class="va">text</span>, <span class="va">labels</span>, <span class="op">~</span> <span class="va">.x</span><span class="op">$</span><span class="fu">add_label</span><span class="op">(</span><span class="st">"classification"</span>, <span class="va">.y</span><span class="op">)</span>, .progress <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
<p>To perform a train-test split using base R, we can follow these
steps:</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">2046</span><span class="op">)</span></span>
<span><span class="va">sample</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sample.html" class="external-link">sample</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="cn">TRUE</span>, <span class="cn">FALSE</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">text</span><span class="op">)</span>, replace<span class="op">=</span><span class="cn">TRUE</span>, prob<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.8</span>, <span class="fl">0.2</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">train</span>  <span class="op">&lt;-</span> <span class="va">text</span><span class="op">[</span><span class="va">sample</span><span class="op">]</span></span>
<span><span class="va">test</span>   <span class="op">&lt;-</span> <span class="va">text</span><span class="op">[</span><span class="op">!</span><span class="va">sample</span><span class="op">]</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/sprintf.html" class="external-link">sprintf</a></span><span class="op">(</span><span class="st">"Corpus object sizes - Train: %d |  Test: %d"</span>, <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">train</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">test</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "Corpus object sizes - Train: 4710 |  Test: 1148"</span></span></code></pre></div>
<div style="text-align: justify;">
<p>If you don’t provide a dev set, flaiR will not force you to carve out
a portion of your test set to serve as a dev set. However, in some cases
when only the train and test sets are provided without a dev set, flaiR
might automatically take a fraction of the train set (e.g., 10%) to use
as a dev set (<a href="https://github.com/flairNLP/flair/issues/2259#issuecomment-830040253" class="external-link">#2259</a>).
This is to offer a mechanism for model selection and to prevent the
model from overfitting on the train set.</p>
<p>In the “Corpus” function, there is a random selection of the “dev”
dataset. To ensure reproducibility, we need to set the seed in the flaiR
framework. We can accomplish this by calling the top-level module
“flair” from {flaiR} and using <code>$set_seed(1964L)</code> to set the
seed.</p>
</div>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">flair</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/import_flair.html">import_flair</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="va">flair</span><span class="op">$</span><span class="fu">set_seed</span><span class="op">(</span><span class="fl">1964L</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">corp</span> <span class="op">&lt;-</span> <span class="fu">Corpus</span><span class="op">(</span>train<span class="op">=</span><span class="va">train</span>, </span>
<span>                 <span class="co"># dev=test,</span></span>
<span>                 test<span class="op">=</span><span class="va">test</span><span class="op">)</span></span>
<span><span class="co">#&gt; 2024-12-28 16:29:48,410 No dev split found. Using 10% (i.e. 471 samples) of the train split as dev data</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/sprintf.html" class="external-link">sprintf</a></span><span class="op">(</span><span class="st">"Corpus object sizes - Train: %d | Test: %d | Dev: %d"</span>, </span>
<span>        <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">corp</span><span class="op">$</span><span class="va">train</span><span class="op">)</span>, </span>
<span>        <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">corp</span><span class="op">$</span><span class="va">test</span><span class="op">)</span>,</span>
<span>        <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">corp</span><span class="op">$</span><span class="va">dev</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "Corpus object sizes - Train: 4239 | Test: 1148 | Dev: 471"</span></span></code></pre></div>
<div style="text-align: justify;">
<p>In the later sections, there will be more similar processing using
the <code>Corpus</code>. Following that, we will focus on advanced NLP
applications.</p>
</div>
<hr>
</div>
</div>
<div class="section level2">
<h2 id="sequence-taggings">Sequence Taggings<a class="anchor" aria-label="anchor" href="#sequence-taggings"></a>
</h2>
<div class="section level3">
<h3 id="tag-entities-in-text">Tag Entities in Text<a class="anchor" aria-label="anchor" href="#tag-entities-in-text"></a>
</h3>
<div style="text-align: justify;">
<p>Let’s run named entity recognition over the following example
sentence: “I love Berlin and New York”. To do this, all you need to do
is make a Sentence object for this text, load a pre-trained model and
use it to predict tags for the object.</p>
</div>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># attach flaiR in R</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://davidycliao.github.io/flaiR">flaiR</a></span><span class="op">)</span></span>
<span></span>
<span><span class="co"># make a sentence</span></span>
<span></span>
<span><span class="va">Sentence</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/flair_data.html">flair_data</a></span><span class="op">(</span><span class="op">)</span><span class="op">$</span><span class="va">Sentence</span></span>
<span><span class="va">sentence</span> <span class="op">&lt;-</span> <span class="fu">Sentence</span><span class="op">(</span><span class="st">'I love Berlin and New York.'</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># load the NER tagger</span></span>
<span><span class="va">Classifier</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/flair_nn.html">flair_nn</a></span><span class="op">(</span><span class="op">)</span><span class="op">$</span><span class="va">Classifier</span></span>
<span><span class="va">tagger</span> <span class="op">&lt;-</span> <span class="va">Classifier</span><span class="op">$</span><span class="fu">load</span><span class="op">(</span><span class="st">'ner'</span><span class="op">)</span></span>
<span><span class="co">#&gt; 2024-12-28 16:29:49,642 SequenceTagger predicts: Dictionary with 20 tags: &lt;unk&gt;, O, S-ORG, S-MISC, B-PER, E-PER, S-LOC, B-ORG, E-ORG, I-PER, S-PER, B-MISC, I-MISC, E-MISC, I-ORG, B-LOC, E-LOC, I-LOC, &lt;START&gt;, &lt;STOP&gt;</span></span>
<span></span>
<span><span class="co"># run NER over sentence</span></span>
<span><span class="va">tagger</span><span class="op">$</span><span class="fu">predict</span><span class="op">(</span><span class="va">sentence</span><span class="op">)</span></span></code></pre></div>
<p>To print all annotations:</p>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># print the sentence with all annotations</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">sentence</span><span class="op">)</span></span>
<span><span class="co">#&gt; Sentence[7]: "I love Berlin and New York." → ["Berlin"/LOC, "New York"/LOC]</span></span></code></pre></div>
<div style="text-align: justify;">
<p>Use a for loop to print out each POS tag. It’s important to note that
Python is indexed from 0. Therefore, in an R environment, we must use
<code>seq_along(sentence$get_labels()) - 1</code>.</p>
</div>
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw">for</span> <span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq_along</a></span><span class="op">(</span><span class="va">sentence</span><span class="op">$</span><span class="fu">get_labels</span><span class="op">(</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>      <span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">sentence</span><span class="op">$</span><span class="fu">get_labels</span><span class="op">(</span><span class="op">)</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span><span class="op">)</span></span>
<span>  <span class="op">}</span></span>
<span><span class="co">#&gt; 'Span[2:3]: "Berlin"'/'LOC' (0.9812)</span></span>
<span><span class="co">#&gt; 'Span[4:6]: "New York"'/'LOC' (0.9957)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="tag-part-of-speech">Tag Part-of-Speech<a class="anchor" aria-label="anchor" href="#tag-part-of-speech"></a>
</h3>
<div style="text-align: justify;">
<p>We use <code>flaiR/POS-english</code> for POS tagging in the standard
models on Hugging Face.</p>
</div>
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># attach flaiR in R</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://davidycliao.github.io/flaiR">flaiR</a></span><span class="op">)</span></span>
<span></span>
<span><span class="co"># make a sentence</span></span>
<span><span class="va">Sentence</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/flair_data.html">flair_data</a></span><span class="op">(</span><span class="op">)</span><span class="op">$</span><span class="va">Sentence</span></span>
<span><span class="va">sentence</span> <span class="op">&lt;-</span> <span class="fu">Sentence</span><span class="op">(</span><span class="st">'I love Berlin and New York.'</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># load the NER tagger</span></span>
<span><span class="va">Classifier</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/flair_nn.html">flair_nn</a></span><span class="op">(</span><span class="op">)</span><span class="op">$</span><span class="va">Classifier</span></span>
<span><span class="va">tagger</span> <span class="op">&lt;-</span> <span class="va">Classifier</span><span class="op">$</span><span class="fu">load</span><span class="op">(</span><span class="st">'pos'</span><span class="op">)</span></span>
<span><span class="co">#&gt; 2024-12-28 16:29:50,628 SequenceTagger predicts: Dictionary with 53 tags: &lt;unk&gt;, O, UH, ,, VBD, PRP, VB, PRP$, NN, RB, ., DT, JJ, VBP, VBG, IN, CD, NNS, NNP, WRB, VBZ, WDT, CC, TO, MD, VBN, WP, :, RP, EX, JJR, FW, XX, HYPH, POS, RBR, JJS, PDT, NNPS, RBS, AFX, WP$, -LRB-, -RRB-, ``, '', LS, $, SYM, ADD</span></span></code></pre></div>
<p><em>Penn Treebank POS Tags Reference</em></p>
<table class="table">
<thead><tr class="header">
<th>Tag</th>
<th>Description</th>
<th>Example</th>
</tr></thead>
<tbody>
<tr class="odd">
<td>DT</td>
<td>Determiner</td>
<td>the, a, these</td>
</tr>
<tr class="even">
<td>NN</td>
<td>Noun, singular</td>
<td>cat, tree</td>
</tr>
<tr class="odd">
<td>NNS</td>
<td>Noun, plural</td>
<td>cats, trees</td>
</tr>
<tr class="even">
<td>NNP</td>
<td>Proper noun, singular</td>
<td>John, London</td>
</tr>
<tr class="odd">
<td>NNPS</td>
<td>Proper noun, plural</td>
<td>Americans</td>
</tr>
<tr class="even">
<td>VB</td>
<td>Verb, base form</td>
<td>take</td>
</tr>
<tr class="odd">
<td>VBD</td>
<td>Verb, past tense</td>
<td>took</td>
</tr>
<tr class="even">
<td>VBG</td>
<td>Verb, gerund/present participle</td>
<td>taking</td>
</tr>
<tr class="odd">
<td>VBN</td>
<td>Verb, past participle</td>
<td>taken</td>
</tr>
<tr class="even">
<td>VBP</td>
<td>Verb, non-3rd person singular present</td>
<td>take</td>
</tr>
<tr class="odd">
<td>VBZ</td>
<td>Verb, 3rd person singular present</td>
<td>takes</td>
</tr>
<tr class="even">
<td>JJ</td>
<td>Adjective</td>
<td>big</td>
</tr>
<tr class="odd">
<td>RB</td>
<td>Adverb</td>
<td>quickly</td>
</tr>
<tr class="even">
<td>O</td>
<td>Other</td>
<td>-</td>
</tr>
<tr class="odd">
<td>,</td>
<td>Comma</td>
<td>,</td>
</tr>
<tr class="even">
<td>.</td>
<td>Period</td>
<td>.</td>
</tr>
<tr class="odd">
<td>:</td>
<td>Colon</td>
<td>:</td>
</tr>
<tr class="even">
<td>-LRB-</td>
<td>Left bracket</td>
<td>(</td>
</tr>
<tr class="odd">
<td>-RRB-</td>
<td>Right bracket</td>
<td>)</td>
</tr>
<tr class="even">
<td>``</td>
<td>Opening quotation</td>
<td>”</td>
</tr>
<tr class="odd">
<td>’’</td>
<td>Closing quotation</td>
<td>”</td>
</tr>
<tr class="even">
<td>HYPH</td>
<td>Hyphen</td>
<td>-</td>
</tr>
<tr class="odd">
<td>CD</td>
<td>Cardinal number</td>
<td>1, 2, 3</td>
</tr>
<tr class="even">
<td>IN</td>
<td>Preposition</td>
<td>in, on, at</td>
</tr>
<tr class="odd">
<td>PRP</td>
<td>Personal pronoun</td>
<td>I, you, he</td>
</tr>
<tr class="even">
<td>PRP$</td>
<td>Possessive pronoun</td>
<td>my, your</td>
</tr>
<tr class="odd">
<td>UH</td>
<td>Interjection</td>
<td>oh, wow</td>
</tr>
<tr class="even">
<td>FW</td>
<td>Foreign word</td>
<td>café</td>
</tr>
<tr class="odd">
<td>SYM</td>
<td>Symbol</td>
<td>+, %</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb23"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># run NER over sentence</span></span>
<span><span class="va">tagger</span><span class="op">$</span><span class="fu">predict</span><span class="op">(</span><span class="va">sentence</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb24"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># print the sentence with all annotations</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">sentence</span><span class="op">)</span></span>
<span><span class="co">#&gt; Sentence[7]: "I love Berlin and New York." → ["I"/PRP, "love"/VBP, "Berlin"/NNP, "and"/CC, "New"/NNP, "York"/NNP, "."/.]</span></span></code></pre></div>
<p>Use a for loop to print out each POS tag.</p>
<div class="sourceCode" id="cb25"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw">for</span> <span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq_along</a></span><span class="op">(</span><span class="va">sentence</span><span class="op">$</span><span class="fu">get_labels</span><span class="op">(</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>      <span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">sentence</span><span class="op">$</span><span class="fu">get_labels</span><span class="op">(</span><span class="op">)</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span><span class="op">)</span></span>
<span>  <span class="op">}</span></span>
<span><span class="co">#&gt; 'Token[0]: "I"'/'PRP' (1.0)</span></span>
<span><span class="co">#&gt; 'Token[1]: "love"'/'VBP' (1.0)</span></span>
<span><span class="co">#&gt; 'Token[2]: "Berlin"'/'NNP' (0.9999)</span></span>
<span><span class="co">#&gt; 'Token[3]: "and"'/'CC' (1.0)</span></span>
<span><span class="co">#&gt; 'Token[4]: "New"'/'NNP' (1.0)</span></span>
<span><span class="co">#&gt; 'Token[5]: "York"'/'NNP' (1.0)</span></span>
<span><span class="co">#&gt; 'Token[6]: "."'/'.' (1.0)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="detect-sentiment">Detect Sentiment<a class="anchor" aria-label="anchor" href="#detect-sentiment"></a>
</h3>
<div style="text-align: justify;">
<p>Let’s run sentiment analysis over the same sentence to determine
whether it is POSITIVE or NEGATIVE.</p>
<p>You can do this with essentially the same code as above. Instead of
loading the ‘ner’ model, you now load the <code>'sentiment'</code>
model:</p>
</div>
<div class="sourceCode" id="cb26"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># attach flaiR in R</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://davidycliao.github.io/flaiR">flaiR</a></span><span class="op">)</span></span>
<span></span>
<span><span class="co"># make a sentence</span></span>
<span><span class="va">Sentence</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/flair_data.html">flair_data</a></span><span class="op">(</span><span class="op">)</span><span class="op">$</span><span class="va">Sentence</span></span>
<span><span class="va">sentence</span> <span class="op">&lt;-</span> <span class="fu">Sentence</span><span class="op">(</span><span class="st">'I love Berlin and New York.'</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># load the Classifier tagger from flair.nn module</span></span>
<span><span class="va">Classifier</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/flair_nn.html">flair_nn</a></span><span class="op">(</span><span class="op">)</span><span class="op">$</span><span class="va">Classifier</span></span>
<span><span class="va">tagger</span> <span class="op">&lt;-</span> <span class="va">Classifier</span><span class="op">$</span><span class="fu">load</span><span class="op">(</span><span class="st">'sentiment'</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># run sentiment analysis over sentence</span></span>
<span><span class="va">tagger</span><span class="op">$</span><span class="fu">predict</span><span class="op">(</span><span class="va">sentence</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb27"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># print the sentence with all annotations</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">sentence</span><span class="op">)</span></span>
<span><span class="co">#&gt; Sentence[7]: "I love Berlin and New York." → POSITIVE (0.9982)</span></span></code></pre></div>
<hr>
</div>
<div class="section level3">
<h3 id="dealing-with-dataframe">Dealing with Dataframe<a class="anchor" aria-label="anchor" href="#dealing-with-dataframe"></a>
</h3>
<div class="section level4">
<h4 id="parts-of-speech-tagging-across-full-dataframe">Parts-of-Speech Tagging Across Full DataFrame<a class="anchor" aria-label="anchor" href="#parts-of-speech-tagging-across-full-dataframe"></a>
</h4>
<div style="text-align: justify;">
<p>You can apply Part-of-Speech (POS) tagging across an entire DataFrame
using Flair’s pre-trained models. Let’s walk through an example using
the pos-fast model. You can apply Part-of-Speech (POS) tagging across an
entire DataFrame using Flair’s pre-trained models. Let’s walk through an
example using the pos-fast model. First, let’s load our required
packages and sample data:</p>
</div>
<div class="sourceCode" id="cb28"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://davidycliao.github.io/flaiR">flaiR</a></span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="va">uk_immigration</span><span class="op">)</span></span>
<span><span class="va">uk_immigration</span> <span class="op">&lt;-</span> <span class="va">uk_immigration</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">2</span>,<span class="op">]</span></span></code></pre></div>
<div style="text-align: justify;">
<p>For POS tagging, we’ll use Flair’s pre-trained model. The pos-fast
model offers a good balance between speed and accuracy. For more
pre-trained models, check out Flair’s documentation at Flair POS Tagging
Documentation. There are two ways to load the POS tagger:</p>
</div>
<ul>
<li>Load with tag dictionary display (default):</li>
</ul>
<div class="sourceCode" id="cb29"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">tagger_pos</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/load_tagger_pos.html">load_tagger_pos</a></span><span class="op">(</span><span class="st">"pos-fast"</span><span class="op">)</span></span>
<span><span class="co">#&gt; Loading POS tagger model: pos-fast</span></span>
<span><span class="co">#&gt; 2024-12-28 16:29:54,052 SequenceTagger predicts: Dictionary with 53 tags: &lt;unk&gt;, O, UH, ,, VBD, PRP, VB, PRP$, NN, RB, ., DT, JJ, VBP, VBG, IN, CD, NNS, NNP, WRB, VBZ, WDT, CC, TO, MD, VBN, WP, :, RP, EX, JJR, FW, XX, HYPH, POS, RBR, JJS, PDT, NNPS, RBS, AFX, WP$, -LRB-, -RRB-, ``, '', LS, $, SYM, ADD</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; POS Tagger Dictionary:</span></span>
<span><span class="co">#&gt; ========================================</span></span>
<span><span class="co">#&gt; Total tags: 53</span></span>
<span><span class="co">#&gt; ----------------------------------------</span></span>
<span><span class="co">#&gt; Special:       &lt;unk&gt;, O, &lt;START&gt;, &lt;STOP&gt; </span></span>
<span><span class="co">#&gt; Nouns:         PRP, PRP$, NN, NNS, NNP, WP, EX, NNPS, WP$ </span></span>
<span><span class="co">#&gt; Verbs:         VBD, VB, VBP, VBG, VBZ, MD, VBN </span></span>
<span><span class="co">#&gt; Adjectives:    JJ, JJR, POS, JJS </span></span>
<span><span class="co">#&gt; Adverbs:       RB, WRB, RBR, RBS </span></span>
<span><span class="co">#&gt; Determiners:   DT, WDT, PDT </span></span>
<span><span class="co">#&gt; Prepositions:  IN, TO </span></span>
<span><span class="co">#&gt; Conjunctions:  CC </span></span>
<span><span class="co">#&gt; Numbers:       CD </span></span>
<span><span class="co">#&gt; Punctuation:   &lt;unk&gt;, ,, ., :, HYPH, -LRB-, -RRB-, ``, '', $, NFP, &lt;START&gt;, &lt;STOP&gt; </span></span>
<span><span class="co">#&gt; Others:        UH, FW, XX, LS, $, SYM, ADD </span></span>
<span><span class="co">#&gt; ----------------------------------------</span></span>
<span><span class="co">#&gt; Common POS Tag Meanings:</span></span>
<span><span class="co">#&gt; NN*: Nouns (NNP: Proper, NNS: Plural)</span></span>
<span><span class="co">#&gt; VB*: Verbs (VBD: Past, VBG: Gerund)</span></span>
<span><span class="co">#&gt; JJ*: Adjectives (JJR: Comparative)</span></span>
<span><span class="co">#&gt; RB*: Adverbs</span></span>
<span><span class="co">#&gt; PRP: Pronouns, DT: Determiners</span></span>
<span><span class="co">#&gt; IN: Prepositions, CC: Conjunctions</span></span>
<span><span class="co">#&gt; ========================================</span></span></code></pre></div>
<p>This will show you all available POS tags grouped by categories
(nouns, verbs, adjectives, etc.).</p>
<ul>
<li>Load without tag display for a cleaner output:</li>
</ul>
<div class="sourceCode" id="cb30"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">pos_tagger</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/load_tagger_pos.html">load_tagger_pos</a></span><span class="op">(</span><span class="st">"pos-fast"</span>, show_tags <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="co">#&gt; Loading POS tagger model: pos-fast</span></span>
<span><span class="co">#&gt; 2024-12-28 16:29:54,501 SequenceTagger predicts: Dictionary with 53 tags: &lt;unk&gt;, O, UH, ,, VBD, PRP, VB, PRP$, NN, RB, ., DT, JJ, VBP, VBG, IN, CD, NNS, NNP, WRB, VBZ, WDT, CC, TO, MD, VBN, WP, :, RP, EX, JJR, FW, XX, HYPH, POS, RBR, JJS, PDT, NNPS, RBS, AFX, WP$, -LRB-, -RRB-, ``, '', LS, $, SYM, ADD</span></span></code></pre></div>
<p>Now we can process our texts:</p>
<div class="sourceCode" id="cb31"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">results</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/get_pos.html">get_pos</a></span><span class="op">(</span>texts <span class="op">=</span> <span class="va">uk_immigration</span><span class="op">$</span><span class="va">text</span>,</span>
<span>                   doc_ids <span class="op">=</span> <span class="va">uk_immigration</span><span class="op">$</span><span class="va">speaker</span>,</span>
<span>                   show.text_id <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>                   tagger <span class="op">=</span> <span class="va">pos_tagger</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">results</span>, n <span class="op">=</span> <span class="fl">10</span><span class="op">)</span></span>
<span><span class="co">#&gt;               doc_id token_id</span></span>
<span><span class="co">#&gt;               &lt;char&gt;    &lt;num&gt;</span></span>
<span><span class="co">#&gt;  1: Philip Hollobone        0</span></span>
<span><span class="co">#&gt;  2: Philip Hollobone        1</span></span>
<span><span class="co">#&gt;  3: Philip Hollobone        2</span></span>
<span><span class="co">#&gt;  4: Philip Hollobone        3</span></span>
<span><span class="co">#&gt;  5: Philip Hollobone        4</span></span>
<span><span class="co">#&gt;  6: Philip Hollobone        5</span></span>
<span><span class="co">#&gt;  7: Philip Hollobone        6</span></span>
<span><span class="co">#&gt;  8: Philip Hollobone        7</span></span>
<span><span class="co">#&gt;  9: Philip Hollobone        8</span></span>
<span><span class="co">#&gt; 10: Philip Hollobone        9</span></span>
<span><span class="co">#&gt;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   text_id</span></span>
<span><span class="co">#&gt;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    &lt;char&gt;</span></span>
<span><span class="co">#&gt;  1: I thank Mr. Speaker for giving me permission to hold this debate today. I welcome the Minister-I very much appreciate the contact from his office prior to today-and the Conservative and Liberal Democrat Front Benchers to the debate. I also welcome my hon. Friends on the Back Benches. Immigration is the most important issue for my constituents. I get more complaints, comments and suggestions about immigration than about anything else. In the Kettering constituency, the number of immigrants is actually very low. There is a well-settled Sikh community in the middle of Kettering town itself, which has been in Kettering for some 40 or 50 years and is very much part of the local community and of the fabric of local life. There are other very small migrant groups in my constituency, but it is predominantly made up of indigenous British people. However, there is huge concern among my constituents about the level of immigration into our country. I believe that I am right in saying that, in recent years, net immigration into the United Kingdom is the largest wave of immigration that our country has ever known and, proportionately, is probably the biggest wave of immigration since the Norman conquest. My contention is that our country simply cannot cope with immigration on that scale-to coin a phrase, we simply cannot go on like this. It is about time that mainstream politicians started airing the views of their constituents, because for too long people have muttered under their breath that they are concerned about immigration. They have been frightened to speak out about it because they are frightened of being accused of being racist. My contention is that immigration is not a racist issue; it is a question of numbers. I personally could not care tuppence about the ethnicity of the immigrants concerned, the colour of their skin or the language that they speak. What I am concerned about is the very large numbers of new arrivals to our country. My contention is that the United Kingdom simply cannot cope with them.</span></span>
<span><span class="co">#&gt;  2: I thank Mr. Speaker for giving me permission to hold this debate today. I welcome the Minister-I very much appreciate the contact from his office prior to today-and the Conservative and Liberal Democrat Front Benchers to the debate. I also welcome my hon. Friends on the Back Benches. Immigration is the most important issue for my constituents. I get more complaints, comments and suggestions about immigration than about anything else. In the Kettering constituency, the number of immigrants is actually very low. There is a well-settled Sikh community in the middle of Kettering town itself, which has been in Kettering for some 40 or 50 years and is very much part of the local community and of the fabric of local life. There are other very small migrant groups in my constituency, but it is predominantly made up of indigenous British people. However, there is huge concern among my constituents about the level of immigration into our country. I believe that I am right in saying that, in recent years, net immigration into the United Kingdom is the largest wave of immigration that our country has ever known and, proportionately, is probably the biggest wave of immigration since the Norman conquest. My contention is that our country simply cannot cope with immigration on that scale-to coin a phrase, we simply cannot go on like this. It is about time that mainstream politicians started airing the views of their constituents, because for too long people have muttered under their breath that they are concerned about immigration. They have been frightened to speak out about it because they are frightened of being accused of being racist. My contention is that immigration is not a racist issue; it is a question of numbers. I personally could not care tuppence about the ethnicity of the immigrants concerned, the colour of their skin or the language that they speak. What I am concerned about is the very large numbers of new arrivals to our country. My contention is that the United Kingdom simply cannot cope with them.</span></span>
<span><span class="co">#&gt;  3: I thank Mr. Speaker for giving me permission to hold this debate today. I welcome the Minister-I very much appreciate the contact from his office prior to today-and the Conservative and Liberal Democrat Front Benchers to the debate. I also welcome my hon. Friends on the Back Benches. Immigration is the most important issue for my constituents. I get more complaints, comments and suggestions about immigration than about anything else. In the Kettering constituency, the number of immigrants is actually very low. There is a well-settled Sikh community in the middle of Kettering town itself, which has been in Kettering for some 40 or 50 years and is very much part of the local community and of the fabric of local life. There are other very small migrant groups in my constituency, but it is predominantly made up of indigenous British people. However, there is huge concern among my constituents about the level of immigration into our country. I believe that I am right in saying that, in recent years, net immigration into the United Kingdom is the largest wave of immigration that our country has ever known and, proportionately, is probably the biggest wave of immigration since the Norman conquest. My contention is that our country simply cannot cope with immigration on that scale-to coin a phrase, we simply cannot go on like this. It is about time that mainstream politicians started airing the views of their constituents, because for too long people have muttered under their breath that they are concerned about immigration. They have been frightened to speak out about it because they are frightened of being accused of being racist. My contention is that immigration is not a racist issue; it is a question of numbers. I personally could not care tuppence about the ethnicity of the immigrants concerned, the colour of their skin or the language that they speak. What I am concerned about is the very large numbers of new arrivals to our country. My contention is that the United Kingdom simply cannot cope with them.</span></span>
<span><span class="co">#&gt;  4: I thank Mr. Speaker for giving me permission to hold this debate today. I welcome the Minister-I very much appreciate the contact from his office prior to today-and the Conservative and Liberal Democrat Front Benchers to the debate. I also welcome my hon. Friends on the Back Benches. Immigration is the most important issue for my constituents. I get more complaints, comments and suggestions about immigration than about anything else. In the Kettering constituency, the number of immigrants is actually very low. There is a well-settled Sikh community in the middle of Kettering town itself, which has been in Kettering for some 40 or 50 years and is very much part of the local community and of the fabric of local life. There are other very small migrant groups in my constituency, but it is predominantly made up of indigenous British people. However, there is huge concern among my constituents about the level of immigration into our country. I believe that I am right in saying that, in recent years, net immigration into the United Kingdom is the largest wave of immigration that our country has ever known and, proportionately, is probably the biggest wave of immigration since the Norman conquest. My contention is that our country simply cannot cope with immigration on that scale-to coin a phrase, we simply cannot go on like this. It is about time that mainstream politicians started airing the views of their constituents, because for too long people have muttered under their breath that they are concerned about immigration. They have been frightened to speak out about it because they are frightened of being accused of being racist. My contention is that immigration is not a racist issue; it is a question of numbers. I personally could not care tuppence about the ethnicity of the immigrants concerned, the colour of their skin or the language that they speak. What I am concerned about is the very large numbers of new arrivals to our country. My contention is that the United Kingdom simply cannot cope with them.</span></span>
<span><span class="co">#&gt;  5: I thank Mr. Speaker for giving me permission to hold this debate today. I welcome the Minister-I very much appreciate the contact from his office prior to today-and the Conservative and Liberal Democrat Front Benchers to the debate. I also welcome my hon. Friends on the Back Benches. Immigration is the most important issue for my constituents. I get more complaints, comments and suggestions about immigration than about anything else. In the Kettering constituency, the number of immigrants is actually very low. There is a well-settled Sikh community in the middle of Kettering town itself, which has been in Kettering for some 40 or 50 years and is very much part of the local community and of the fabric of local life. There are other very small migrant groups in my constituency, but it is predominantly made up of indigenous British people. However, there is huge concern among my constituents about the level of immigration into our country. I believe that I am right in saying that, in recent years, net immigration into the United Kingdom is the largest wave of immigration that our country has ever known and, proportionately, is probably the biggest wave of immigration since the Norman conquest. My contention is that our country simply cannot cope with immigration on that scale-to coin a phrase, we simply cannot go on like this. It is about time that mainstream politicians started airing the views of their constituents, because for too long people have muttered under their breath that they are concerned about immigration. They have been frightened to speak out about it because they are frightened of being accused of being racist. My contention is that immigration is not a racist issue; it is a question of numbers. I personally could not care tuppence about the ethnicity of the immigrants concerned, the colour of their skin or the language that they speak. What I am concerned about is the very large numbers of new arrivals to our country. My contention is that the United Kingdom simply cannot cope with them.</span></span>
<span><span class="co">#&gt;  6: I thank Mr. Speaker for giving me permission to hold this debate today. I welcome the Minister-I very much appreciate the contact from his office prior to today-and the Conservative and Liberal Democrat Front Benchers to the debate. I also welcome my hon. Friends on the Back Benches. Immigration is the most important issue for my constituents. I get more complaints, comments and suggestions about immigration than about anything else. In the Kettering constituency, the number of immigrants is actually very low. There is a well-settled Sikh community in the middle of Kettering town itself, which has been in Kettering for some 40 or 50 years and is very much part of the local community and of the fabric of local life. There are other very small migrant groups in my constituency, but it is predominantly made up of indigenous British people. However, there is huge concern among my constituents about the level of immigration into our country. I believe that I am right in saying that, in recent years, net immigration into the United Kingdom is the largest wave of immigration that our country has ever known and, proportionately, is probably the biggest wave of immigration since the Norman conquest. My contention is that our country simply cannot cope with immigration on that scale-to coin a phrase, we simply cannot go on like this. It is about time that mainstream politicians started airing the views of their constituents, because for too long people have muttered under their breath that they are concerned about immigration. They have been frightened to speak out about it because they are frightened of being accused of being racist. My contention is that immigration is not a racist issue; it is a question of numbers. I personally could not care tuppence about the ethnicity of the immigrants concerned, the colour of their skin or the language that they speak. What I am concerned about is the very large numbers of new arrivals to our country. My contention is that the United Kingdom simply cannot cope with them.</span></span>
<span><span class="co">#&gt;  7: I thank Mr. Speaker for giving me permission to hold this debate today. I welcome the Minister-I very much appreciate the contact from his office prior to today-and the Conservative and Liberal Democrat Front Benchers to the debate. I also welcome my hon. Friends on the Back Benches. Immigration is the most important issue for my constituents. I get more complaints, comments and suggestions about immigration than about anything else. In the Kettering constituency, the number of immigrants is actually very low. There is a well-settled Sikh community in the middle of Kettering town itself, which has been in Kettering for some 40 or 50 years and is very much part of the local community and of the fabric of local life. There are other very small migrant groups in my constituency, but it is predominantly made up of indigenous British people. However, there is huge concern among my constituents about the level of immigration into our country. I believe that I am right in saying that, in recent years, net immigration into the United Kingdom is the largest wave of immigration that our country has ever known and, proportionately, is probably the biggest wave of immigration since the Norman conquest. My contention is that our country simply cannot cope with immigration on that scale-to coin a phrase, we simply cannot go on like this. It is about time that mainstream politicians started airing the views of their constituents, because for too long people have muttered under their breath that they are concerned about immigration. They have been frightened to speak out about it because they are frightened of being accused of being racist. My contention is that immigration is not a racist issue; it is a question of numbers. I personally could not care tuppence about the ethnicity of the immigrants concerned, the colour of their skin or the language that they speak. What I am concerned about is the very large numbers of new arrivals to our country. My contention is that the United Kingdom simply cannot cope with them.</span></span>
<span><span class="co">#&gt;  8: I thank Mr. Speaker for giving me permission to hold this debate today. I welcome the Minister-I very much appreciate the contact from his office prior to today-and the Conservative and Liberal Democrat Front Benchers to the debate. I also welcome my hon. Friends on the Back Benches. Immigration is the most important issue for my constituents. I get more complaints, comments and suggestions about immigration than about anything else. In the Kettering constituency, the number of immigrants is actually very low. There is a well-settled Sikh community in the middle of Kettering town itself, which has been in Kettering for some 40 or 50 years and is very much part of the local community and of the fabric of local life. There are other very small migrant groups in my constituency, but it is predominantly made up of indigenous British people. However, there is huge concern among my constituents about the level of immigration into our country. I believe that I am right in saying that, in recent years, net immigration into the United Kingdom is the largest wave of immigration that our country has ever known and, proportionately, is probably the biggest wave of immigration since the Norman conquest. My contention is that our country simply cannot cope with immigration on that scale-to coin a phrase, we simply cannot go on like this. It is about time that mainstream politicians started airing the views of their constituents, because for too long people have muttered under their breath that they are concerned about immigration. They have been frightened to speak out about it because they are frightened of being accused of being racist. My contention is that immigration is not a racist issue; it is a question of numbers. I personally could not care tuppence about the ethnicity of the immigrants concerned, the colour of their skin or the language that they speak. What I am concerned about is the very large numbers of new arrivals to our country. My contention is that the United Kingdom simply cannot cope with them.</span></span>
<span><span class="co">#&gt;  9: I thank Mr. Speaker for giving me permission to hold this debate today. I welcome the Minister-I very much appreciate the contact from his office prior to today-and the Conservative and Liberal Democrat Front Benchers to the debate. I also welcome my hon. Friends on the Back Benches. Immigration is the most important issue for my constituents. I get more complaints, comments and suggestions about immigration than about anything else. In the Kettering constituency, the number of immigrants is actually very low. There is a well-settled Sikh community in the middle of Kettering town itself, which has been in Kettering for some 40 or 50 years and is very much part of the local community and of the fabric of local life. There are other very small migrant groups in my constituency, but it is predominantly made up of indigenous British people. However, there is huge concern among my constituents about the level of immigration into our country. I believe that I am right in saying that, in recent years, net immigration into the United Kingdom is the largest wave of immigration that our country has ever known and, proportionately, is probably the biggest wave of immigration since the Norman conquest. My contention is that our country simply cannot cope with immigration on that scale-to coin a phrase, we simply cannot go on like this. It is about time that mainstream politicians started airing the views of their constituents, because for too long people have muttered under their breath that they are concerned about immigration. They have been frightened to speak out about it because they are frightened of being accused of being racist. My contention is that immigration is not a racist issue; it is a question of numbers. I personally could not care tuppence about the ethnicity of the immigrants concerned, the colour of their skin or the language that they speak. What I am concerned about is the very large numbers of new arrivals to our country. My contention is that the United Kingdom simply cannot cope with them.</span></span>
<span><span class="co">#&gt; 10: I thank Mr. Speaker for giving me permission to hold this debate today. I welcome the Minister-I very much appreciate the contact from his office prior to today-and the Conservative and Liberal Democrat Front Benchers to the debate. I also welcome my hon. Friends on the Back Benches. Immigration is the most important issue for my constituents. I get more complaints, comments and suggestions about immigration than about anything else. In the Kettering constituency, the number of immigrants is actually very low. There is a well-settled Sikh community in the middle of Kettering town itself, which has been in Kettering for some 40 or 50 years and is very much part of the local community and of the fabric of local life. There are other very small migrant groups in my constituency, but it is predominantly made up of indigenous British people. However, there is huge concern among my constituents about the level of immigration into our country. I believe that I am right in saying that, in recent years, net immigration into the United Kingdom is the largest wave of immigration that our country has ever known and, proportionately, is probably the biggest wave of immigration since the Norman conquest. My contention is that our country simply cannot cope with immigration on that scale-to coin a phrase, we simply cannot go on like this. It is about time that mainstream politicians started airing the views of their constituents, because for too long people have muttered under their breath that they are concerned about immigration. They have been frightened to speak out about it because they are frightened of being accused of being racist. My contention is that immigration is not a racist issue; it is a question of numbers. I personally could not care tuppence about the ethnicity of the immigrants concerned, the colour of their skin or the language that they speak. What I am concerned about is the very large numbers of new arrivals to our country. My contention is that the United Kingdom simply cannot cope with them.</span></span>
<span><span class="co">#&gt;          token    tag  score</span></span>
<span><span class="co">#&gt;         &lt;char&gt; &lt;char&gt;  &lt;num&gt;</span></span>
<span><span class="co">#&gt;  1:          I    PRP 1.0000</span></span>
<span><span class="co">#&gt;  2:      thank    VBP 0.9992</span></span>
<span><span class="co">#&gt;  3:        Mr.    NNP 1.0000</span></span>
<span><span class="co">#&gt;  4:    Speaker    NNP 1.0000</span></span>
<span><span class="co">#&gt;  5:        for     IN 1.0000</span></span>
<span><span class="co">#&gt;  6:     giving    VBG 1.0000</span></span>
<span><span class="co">#&gt;  7:         me    PRP 1.0000</span></span>
<span><span class="co">#&gt;  8: permission     NN 0.9999</span></span>
<span><span class="co">#&gt;  9:         to     TO 0.9999</span></span>
<span><span class="co">#&gt; 10:       hold     VB 1.0000</span></span></code></pre></div>
</div>
<div class="section level4">
<h4 id="tagging-entities-across-full-dataframe">Tagging Entities Across Full DataFrame<a class="anchor" aria-label="anchor" href="#tagging-entities-across-full-dataframe"></a>
</h4>
<div style="text-align: justify;">
<p>This section focuses on performing Named Entity Recognition (NER) on
data stored in a dataframe format. My goal is to identify and tag named
entities within text that is organized in a structured dataframe.</p>
<p>I load the flaiR package and use the built-in uk_immigration dataset.
For demonstration purposes, I’m only taking the first two rows. This
dataset contains discussions about immigration in the UK.</p>
<p>Load the pre-trained model <code>ner</code>. For more pre-trained
models, see <a href="https://flairnlp.github.io/docs/tutorial-basics/tagging-entities" class="external-link uri">https://flairnlp.github.io/docs/tutorial-basics/tagging-entities</a>.</p>
</div>
<div class="sourceCode" id="cb32"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://davidycliao.github.io/flaiR">flaiR</a></span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="va">uk_immigration</span><span class="op">)</span></span>
<span><span class="va">uk_immigration</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">uk_immigration</span>, n <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span></code></pre></div>
<div style="text-align: justify;">
<p>Next, I load the latest model hosted and maintained on Hugging Face
by the Flair NLP team. For more Flair NER models, you can visit the
official Flair NLP page on Hugging Face (<a href="https://huggingface.co/flair" class="external-link uri">https://huggingface.co/flair</a>).</p>
</div>
<div class="sourceCode" id="cb33"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Load model without displaying tags</span></span>
<span><span class="co"># tagger &lt;- load_tagger_ner("flair/ner-english-large", show_tags = FALSE)</span></span>
<span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://davidycliao.github.io/flaiR">flaiR</a></span><span class="op">)</span></span>
<span><span class="va">tagger_ner</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/load_tagger_ner.html">load_tagger_ner</a></span><span class="op">(</span><span class="st">"flair/ner-english-ontonotes"</span><span class="op">)</span></span>
<span><span class="co">#&gt; 2024-12-28 16:29:58,864 SequenceTagger predicts: Dictionary with 75 tags: O, S-PERSON, B-PERSON, E-PERSON, I-PERSON, S-GPE, B-GPE, E-GPE, I-GPE, S-ORG, B-ORG, E-ORG, I-ORG, S-DATE, B-DATE, E-DATE, I-DATE, S-CARDINAL, B-CARDINAL, E-CARDINAL, I-CARDINAL, S-NORP, B-NORP, E-NORP, I-NORP, S-MONEY, B-MONEY, E-MONEY, I-MONEY, S-PERCENT, B-PERCENT, E-PERCENT, I-PERCENT, S-ORDINAL, B-ORDINAL, E-ORDINAL, I-ORDINAL, S-LOC, B-LOC, E-LOC, I-LOC, S-TIME, B-TIME, E-TIME, I-TIME, S-WORK_OF_ART, B-WORK_OF_ART, E-WORK_OF_ART, I-WORK_OF_ART, S-FAC</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; NER Tagger Dictionary:</span></span>
<span><span class="co">#&gt; ========================================</span></span>
<span><span class="co">#&gt; Total tags: 75</span></span>
<span><span class="co">#&gt; Model: flair/ner-english-ontonotes</span></span>
<span><span class="co">#&gt; ----------------------------------------</span></span>
<span><span class="co">#&gt; Special        : O, &lt;START&gt;, &lt;STOP&gt;</span></span>
<span><span class="co">#&gt; Person         : S-PERSON, B-PERSON, E-PERSON, I-PERSON</span></span>
<span><span class="co">#&gt; Organization   : S-ORG, B-ORG, E-ORG, I-ORG</span></span>
<span><span class="co">#&gt; Location       : S-GPE, B-GPE, E-GPE, I-GPE, S-LOC, B-LOC, E-LOC, I-LOC</span></span>
<span><span class="co">#&gt; Time           : S-DATE, B-DATE, E-DATE, I-DATE, S-TIME, B-TIME, E-TIME, I-TIME</span></span>
<span><span class="co">#&gt; Numbers        : S-CARDINAL, B-CARDINAL, E-CARDINAL, I-CARDINAL, S-MONEY, B-MONEY, E-MONEY, I-MONEY, S-PERCENT, B-PERCENT, E-PERCENT, I-PERCENT, S-ORDINAL, B-ORDINAL, E-ORDINAL, I-ORDINAL</span></span>
<span><span class="co">#&gt; Groups         : S-NORP, B-NORP, E-NORP, I-NORP</span></span>
<span><span class="co">#&gt; Facilities     : S-FAC, B-FAC, E-FAC, I-FAC</span></span>
<span><span class="co">#&gt; Products       : S-PRODUCT, B-PRODUCT, E-PRODUCT, I-PRODUCT</span></span>
<span><span class="co">#&gt; Events         : S-EVENT, B-EVENT, E-EVENT, I-EVENT</span></span>
<span><span class="co">#&gt; Art            : S-WORK_OF_ART, B-WORK_OF_ART, E-WORK_OF_ART, I-WORK_OF_ART</span></span>
<span><span class="co">#&gt; Languages      : S-LANGUAGE, B-LANGUAGE, E-LANGUAGE, I-LANGUAGE</span></span>
<span><span class="co">#&gt; Laws           : S-LAW, B-LAW, E-LAW, I-LAW</span></span>
<span><span class="co">#&gt; ----------------------------------------</span></span>
<span><span class="co">#&gt; Tag scheme: BIOES</span></span>
<span><span class="co">#&gt; B-: Beginning of multi-token entity</span></span>
<span><span class="co">#&gt; I-: Inside of multi-token entity</span></span>
<span><span class="co">#&gt; O: Outside (not part of any entity)</span></span>
<span><span class="co">#&gt; E-: End of multi-token entity</span></span>
<span><span class="co">#&gt; S-: Single token entity</span></span>
<span><span class="co">#&gt; ========================================</span></span></code></pre></div>
<div style="text-align: justify;">
<p>I load a pre-trained NER model. Since I’m using a Mac M1/M2, I set
the model to run on the MPS device for faster processing. If I want to
use other pre-trained models, I can check the Flair documentation
website for available options.</p>
</div>
<p>Now I’m ready to process the text:</p>
<div class="sourceCode" id="cb34"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">results</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/get_entities.html">get_entities</a></span><span class="op">(</span>texts <span class="op">=</span> <span class="va">uk_immigration</span><span class="op">$</span><span class="va">text</span>,</span>
<span>                        doc_ids <span class="op">=</span> <span class="va">uk_immigration</span><span class="op">$</span><span class="va">speaker</span>,</span>
<span>                        tagger <span class="op">=</span> <span class="va">tagger_ner</span>,</span>
<span>                        batch_size <span class="op">=</span> <span class="fl">2</span>,</span>
<span>                        verbose <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="co">#&gt; CPU is used.</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">results</span>, n <span class="op">=</span> <span class="fl">10</span><span class="op">)</span></span>
<span><span class="co">#&gt;               doc_id                          entity    tag     score</span></span>
<span><span class="co">#&gt;               &lt;char&gt;                          &lt;char&gt; &lt;char&gt;     &lt;num&gt;</span></span>
<span><span class="co">#&gt;  1: Philip Hollobone                           today   DATE 0.9843611</span></span>
<span><span class="co">#&gt;  2: Philip Hollobone                    Conservative   NORP 0.9976857</span></span>
<span><span class="co">#&gt;  3: Philip Hollobone Liberal Democrat Front Benchers    ORG 0.7668496</span></span>
<span><span class="co">#&gt;  4: Philip Hollobone                       Kettering    GPE 0.9885775</span></span>
<span><span class="co">#&gt;  5: Philip Hollobone                            Sikh   NORP 0.9939976</span></span>
<span><span class="co">#&gt;  6: Philip Hollobone                       Kettering    GPE 0.9955219</span></span>
<span><span class="co">#&gt;  7: Philip Hollobone                       Kettering    GPE 0.9948048</span></span>
<span><span class="co">#&gt;  8: Philip Hollobone             some 40 or 50 years   DATE 0.8059650</span></span>
<span><span class="co">#&gt;  9: Philip Hollobone                         British   NORP 0.9986911</span></span>
<span><span class="co">#&gt; 10: Philip Hollobone                    recent years   DATE 0.8596770</span></span></code></pre></div>
<hr>
</div>
</div>
</div>
<div class="section level2">
<h2 id="embedding">Embedding<a class="anchor" aria-label="anchor" href="#embedding"></a>
</h2>
<div style="text-align: justify;">
<p>Flair is a very popular natural language processing library,
providing a variety of embedding methods for text representation. Flair
Embeddings is a word embedding framework developed by <a href="https://engineering.zalando.com/posts/2018/11/zalando-research-releases-flair.html" class="external-link">Zalando</a>.
It focuses on word-level representation and can capture contextual
information of words, allowing the same word to have different
embeddings in different contexts. Unlike traditional word embeddings
(such as Word2Vec or GloVe), Flair can dynamically generate word
embeddings based on context and has achieved excellent results in
various NLP tasks. Below are some key points about Flair Embeddings:</p>
</div>
<p><strong>Context-Aware</strong></p>
<div style="text-align: justify;">
<p>Flair is a dynamic word embedding technique that can understand the
meaning of words based on context. In contrast, static word embeddings,
such as Word2Vec or GloVe, provide a fixed embedding for each word
without considering its context in a sentence.</p>
<p>Therefore, context-sensitive embedding techniques, such as Flair, can
capture the meaning of words in specific sentences more accurately, thus
enhancing the performance of language models in various tasks.</p>
</div>
<p><strong>Example:</strong></p>
<div style="text-align: justify;">
<p>Consider the following two English sentences:</p>
<ul>
<li>“I am interested in the bank of the river.”</li>
<li>“I need to go to the bank to withdraw money.”</li>
</ul>
<p>Here, the word “bank” has two different meanings. In the first
sentence, it refers to the edge or shore of a river. In the second
sentence, it refers to a financial institution.</p>
<p>For static embeddings, the word “bank” might have an embedding that
lies somewhere between these two meanings because it doesn’t consider
context. But for dynamic embeddings like Flair, “bank” in the first
sentence will have an embedding related to rivers, and in the second
sentence, it will have an embedding related to finance.</p>
</div>
<div class="sourceCode" id="cb35"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Initialize Flair embeddings</span></span>
<span><span class="va">FlairEmbeddings</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/flair_embeddings.html">flair_embeddings</a></span><span class="op">(</span><span class="op">)</span><span class="op">$</span><span class="va">FlairEmbeddings</span></span>
<span><span class="va">Sentence</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/flair_data.html">flair_data</a></span><span class="op">(</span><span class="op">)</span><span class="op">$</span><span class="va">Sentence</span></span>
<span><span class="va">flair_embedding_forward</span> <span class="op">&lt;-</span> <span class="fu">FlairEmbeddings</span><span class="op">(</span><span class="st">'news-forward'</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Define the two sentences</span></span>
<span><span class="va">sentence1</span> <span class="op">&lt;-</span>  <span class="fu">Sentence</span><span class="op">(</span><span class="st">"I am interested in the bank of the river."</span><span class="op">)</span></span>
<span><span class="va">sentence2</span> <span class="op">&lt;-</span>  <span class="fu">Sentence</span><span class="op">(</span><span class="st">"I need to go to the bank to withdraw money."</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Get the embeddings</span></span>
<span></span>
<span><span class="va">flair_embedding_forward</span><span class="op">$</span><span class="fu">embed</span><span class="op">(</span><span class="va">sentence1</span><span class="op">)</span></span>
<span><span class="co">#&gt; [[1]]</span></span>
<span><span class="co">#&gt; Sentence[10]: "I am interested in the bank of the river."</span></span>
<span><span class="va">flair_embedding_forward</span><span class="op">$</span><span class="fu">embed</span><span class="op">(</span><span class="va">sentence2</span><span class="op">)</span></span>
<span><span class="co">#&gt; [[1]]</span></span>
<span><span class="co">#&gt; Sentence[11]: "I need to go to the bank to withdraw money."</span></span>
<span></span>
<span><span class="co"># Extract the embedding for "bank" from the sentences</span></span>
<span><span class="va">bank_embedding_sentence1</span> <span class="op">=</span> <span class="va">sentence1</span><span class="op">[</span><span class="fl">5</span><span class="op">]</span><span class="op">$</span><span class="va">embedding</span>  <span class="co"># "bank" is the seventh word</span></span>
<span><span class="va">bank_embedding_sentence2</span> <span class="op">=</span> <span class="va">sentence2</span><span class="op">[</span><span class="fl">6</span><span class="op">]</span><span class="op">$</span><span class="va">embedding</span>  <span class="co"># "bank" is the sixth word</span></span></code></pre></div>
<div style="text-align: justify;">
<p>Same word, similar vector representation, but essentially different.
In this way, you can see how the dynamic embeddings for “bank” in the
two sentences differ based on context. Although we printed the
embeddings here, in reality, they would be high-dimensional vectors, so
you might see a lot of numbers. If you want a more intuitive view of the
differences, you could compute the cosine similarity or other metrics
between the two embeddings.</p>
<p>This is just a simple demonstration. In practice, you can also
combine multiple embedding techniques, such as
<code>WordEmbeddings</code> and <code>FlairEmbeddings</code>, to get
richer word vectors.</p>
</div>
<div class="sourceCode" id="cb36"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">lsa</span><span class="op">)</span></span>
<span><span class="co">#&gt; Loading required package: SnowballC</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/lsa/man/cosine.html" class="external-link">cosine</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span> <span class="va">bank_embedding_sentence1</span><span class="op">$</span><span class="fu">numpy</span><span class="op">(</span><span class="op">)</span><span class="op">)</span>, </span>
<span>       <span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span> <span class="va">bank_embedding_sentence2</span><span class="op">$</span><span class="fu">numpy</span><span class="op">(</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt;           [,1]</span></span>
<span><span class="co">#&gt; [1,] 0.7329551</span></span></code></pre></div>
<p><strong>Character-Based</strong></p>
<div style="text-align: justify;">
<p>Flair uses a character-level language model, meaning it can generate
embeddings for rare words or even misspelled words. This is an important
feature because it allows the model to understand and process words that
have never appeared in the training data. Flair uses a bidirectional
LSTM (Long Short-Term Memory) network that operates at a character
level. This allows it to feed individual characters into the LSTM
instead of words.</p>
</div>
<p><strong>Multilingual Support</strong></p>
<div style="text-align: justify;">
<p>Flair provides various pre-trained character-level language models,
supporting contextual word embeddings for multiple languages. It allows
you to easily combine different word embeddings (e.g., Flair Embeddings,
Word2Vec, GloVe, etc.) to create powerful stacked embeddings.</p>
</div>
<div class="section level3">
<h3 id="classic-wordembeddings">Classic Wordembeddings<a class="anchor" aria-label="anchor" href="#classic-wordembeddings"></a>
</h3>
<div style="text-align: justify;">
<p>In Flair, the simplest form of embeddings that still contains
semantic information about the word are called classic word embeddings.
These embeddings are pre-trained and non-contextual.</p>
<p>Let’s retrieve a few word embeddings and use FastText embeddings with
the following code. To do so, we simply instantiate a WordEmbeddings
class by passing in the ID of the embedding of our choice. Then, we
simply wrap our text into a Sentence object, and call the
<code>embed(sentence)</code> method on our WordEmbeddings class.</p>
</div>
<div class="sourceCode" id="cb37"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">WordEmbeddings</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/flair_embeddings.html">flair_embeddings</a></span><span class="op">(</span><span class="op">)</span><span class="op">$</span><span class="va">WordEmbeddings</span></span>
<span><span class="va">Sentence</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/flair_data.html">flair_data</a></span><span class="op">(</span><span class="op">)</span><span class="op">$</span><span class="va">Sentence</span></span>
<span><span class="va">embedding</span> <span class="op">&lt;-</span> <span class="fu">WordEmbeddings</span><span class="op">(</span><span class="st">'crawl'</span><span class="op">)</span></span>
<span><span class="va">sentence</span> <span class="op">&lt;-</span> <span class="fu">Sentence</span><span class="op">(</span><span class="st">"one two three one"</span><span class="op">)</span> </span>
<span><span class="va">embedding</span><span class="op">$</span><span class="fu">embed</span><span class="op">(</span><span class="va">sentence</span><span class="op">)</span> </span>
<span><span class="co">#&gt; [[1]]</span></span>
<span><span class="co">#&gt; Sentence[4]: "one two three one"</span></span>
<span></span>
<span><span class="kw">for</span> <span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq_along</a></span><span class="op">(</span><span class="va">sentence</span><span class="op">$</span><span class="va">tokens</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">sentence</span><span class="op">$</span><span class="va">tokens</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">embedding</span><span class="op">)</span>, n <span class="op">=</span><span class="fl">5</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span><span class="co">#&gt; tensor([-0.0535, -0.0368, -0.2851, -0.0381, -0.0486,  0.2383])</span></span>
<span><span class="co">#&gt; tensor([ 0.0282, -0.0786, -0.1236,  0.1756, -0.1199,  0.0964])</span></span>
<span><span class="co">#&gt; tensor([-0.0920, -0.0690, -0.1475,  0.2313, -0.0872,  0.0799])</span></span>
<span><span class="co">#&gt; tensor([-0.0535, -0.0368, -0.2851, -0.0381, -0.0486,  0.2383])</span></span></code></pre></div>
<div style="text-align: justify;">
<p>Flair supports a range of classic word embeddings, each offering
unique features and application scopes. Below is an overview, detailing
the ID required to load each embedding and its corresponding
language.</p>
</div>
<table class="table">
<thead><tr class="header">
<th>Embedding Type</th>
<th>ID</th>
<th>Language</th>
</tr></thead>
<tbody>
<tr class="odd">
<td>GloVe</td>
<td>glove</td>
<td>English</td>
</tr>
<tr class="even">
<td>Komninos</td>
<td>extvec</td>
<td>English</td>
</tr>
<tr class="odd">
<td>Twitter</td>
<td>twitter</td>
<td>English</td>
</tr>
<tr class="even">
<td>Turian (small)</td>
<td>turian</td>
<td>English</td>
</tr>
<tr class="odd">
<td>FastText (crawl)</td>
<td>crawl</td>
<td>English</td>
</tr>
<tr class="even">
<td>FastText (news &amp; Wikipedia)</td>
<td>ar</td>
<td>Arabic</td>
</tr>
<tr class="odd">
<td>FastText (news &amp; Wikipedia)</td>
<td>bg</td>
<td>Bulgarian</td>
</tr>
<tr class="even">
<td>FastText (news &amp; Wikipedia)</td>
<td>ca</td>
<td>Catalan</td>
</tr>
<tr class="odd">
<td>FastText (news &amp; Wikipedia)</td>
<td>cz</td>
<td>Czech</td>
</tr>
<tr class="even">
<td>FastText (news &amp; Wikipedia)</td>
<td>da</td>
<td>Danish</td>
</tr>
<tr class="odd">
<td>FastText (news &amp; Wikipedia)</td>
<td>de</td>
<td>German</td>
</tr>
<tr class="even">
<td>FastText (news &amp; Wikipedia)</td>
<td>es</td>
<td>Spanish</td>
</tr>
<tr class="odd">
<td>FastText (news &amp; Wikipedia)</td>
<td>en</td>
<td>English</td>
</tr>
<tr class="even">
<td>FastText (news &amp; Wikipedia)</td>
<td>eu</td>
<td>Basque</td>
</tr>
<tr class="odd">
<td>FastText (news &amp; Wikipedia)</td>
<td>fa</td>
<td>Persian</td>
</tr>
<tr class="even">
<td>FastText (news &amp; Wikipedia)</td>
<td>fi</td>
<td>Finnish</td>
</tr>
<tr class="odd">
<td>FastText (news &amp; Wikipedia)</td>
<td>fr</td>
<td>French</td>
</tr>
<tr class="even">
<td>FastText (news &amp; Wikipedia)</td>
<td>he</td>
<td>Hebrew</td>
</tr>
<tr class="odd">
<td>FastText (news &amp; Wikipedia)</td>
<td>hi</td>
<td>Hindi</td>
</tr>
<tr class="even">
<td>FastText (news &amp; Wikipedia)</td>
<td>hr</td>
<td>Croatian</td>
</tr>
<tr class="odd">
<td>FastText (news &amp; Wikipedia)</td>
<td>id</td>
<td>Indonesian</td>
</tr>
<tr class="even">
<td>FastText (news &amp; Wikipedia)</td>
<td>it</td>
<td>Italian</td>
</tr>
<tr class="odd">
<td>FastText (news &amp; Wikipedia)</td>
<td>ja</td>
<td>Japanese</td>
</tr>
<tr class="even">
<td>FastText (news &amp; Wikipedia)</td>
<td>ko</td>
<td>Korean</td>
</tr>
<tr class="odd">
<td>FastText (news &amp; Wikipedia)</td>
<td>nl</td>
<td>Dutch</td>
</tr>
<tr class="even">
<td>FastText (news &amp; Wikipedia)</td>
<td>no</td>
<td>Norwegian</td>
</tr>
<tr class="odd">
<td>FastText (news &amp; Wikipedia)</td>
<td>pl</td>
<td>Polish</td>
</tr>
<tr class="even">
<td>FastText (news &amp; Wikipedia)</td>
<td>pt</td>
<td>Portuguese</td>
</tr>
<tr class="odd">
<td>FastText (news &amp; Wikipedia)</td>
<td>ro</td>
<td>Romanian</td>
</tr>
<tr class="even">
<td>FastText (news &amp; Wikipedia)</td>
<td>ru</td>
<td>Russian</td>
</tr>
<tr class="odd">
<td>FastText (news &amp; Wikipedia)</td>
<td>si</td>
<td>Slovenian</td>
</tr>
<tr class="even">
<td>FastText (news &amp; Wikipedia)</td>
<td>sk</td>
<td>Slovak</td>
</tr>
<tr class="odd">
<td>FastText (news &amp; Wikipedia)</td>
<td>sr</td>
<td>Serbian</td>
</tr>
<tr class="even">
<td>FastText (news &amp; Wikipedia)</td>
<td>sv</td>
<td>Swedish</td>
</tr>
<tr class="odd">
<td>FastText (news &amp; Wikipedia)</td>
<td>tr</td>
<td>Turkish</td>
</tr>
<tr class="even">
<td>FastText (news &amp; Wikipedia)</td>
<td>zh</td>
<td>Chinese</td>
</tr>
</tbody>
</table>
</div>
<div class="section level3">
<h3 id="contexual-embeddings">Contexual Embeddings<a class="anchor" aria-label="anchor" href="#contexual-embeddings"></a>
</h3>
<div style="text-align: justify;">
<p>The idea behind contextual string embeddings is that each word
embedding should be defined by not only its syntactic-semantic meaning
but also the context it appears in. What this means is that each word
will have a different embedding for every context it appears in. Each
pre-trained Flair model offers a <strong>forward</strong> version and a
<strong>backward</strong> version. Let’s assume you are processing a
language that, just like this text, uses the left-to-right script. The
forward version takes into account the context that happens before the
word – on the left-hand side. The backward version works in the opposite
direction. It takes into account the context after the word – on the
right-hand side of the word. If this is true, then two same words that
appear at the beginning of two different sentences should have identical
forward embeddings, because their context is null. Let’s test this
out:</p>
<p>Because we are using a forward model, it only takes into account the
context that occurs before a word. Additionally, since our word has no
context on the left-hand side of its position in the sentence, the two
embeddings are identical, and the code assumes they are identical,
indeed output is <strong>True</strong>.</p>
</div>
<div class="sourceCode" id="cb38"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">FlairEmbeddings</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/flair_embeddings.html">flair_embeddings</a></span><span class="op">(</span><span class="op">)</span><span class="op">$</span><span class="va">FlairEmbeddings</span></span>
<span><span class="va">embedding</span> <span class="op">&lt;-</span> <span class="fu">FlairEmbeddings</span><span class="op">(</span><span class="st">'news-forward'</span><span class="op">)</span></span>
<span><span class="va">s1</span> <span class="op">&lt;-</span> <span class="fu">Sentence</span><span class="op">(</span><span class="st">"nice shirt"</span><span class="op">)</span> </span>
<span><span class="va">s2</span> <span class="op">&lt;-</span> <span class="fu">Sentence</span><span class="op">(</span><span class="st">"nice pants"</span><span class="op">)</span> </span>
<span></span>
<span><span class="va">embedding</span><span class="op">$</span><span class="fu">embed</span><span class="op">(</span><span class="va">s1</span><span class="op">)</span> </span>
<span><span class="co">#&gt; [[1]]</span></span>
<span><span class="co">#&gt; Sentence[2]: "nice shirt"</span></span>
<span><span class="va">embedding</span><span class="op">$</span><span class="fu">embed</span><span class="op">(</span><span class="va">s2</span><span class="op">)</span> </span>
<span><span class="co">#&gt; [[1]]</span></span>
<span><span class="co">#&gt; Sentence[2]: "nice pants"</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">" s1 sentence:"</span>, <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="va">s1</span><span class="op">[</span><span class="fl">0</span><span class="op">]</span>, sep <span class="op">=</span> <span class="st">""</span><span class="op">)</span>, <span class="st">"\n"</span>, <span class="st">"s2 sentence:"</span>, <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="va">s2</span><span class="op">[</span><span class="fl">0</span><span class="op">]</span>, sep <span class="op">=</span> <span class="st">""</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt;  s1 sentence: Token[0]: "nice" </span></span>
<span><span class="co">#&gt;  s2 sentence: Token[0]: "nice"</span></span></code></pre></div>
<div style="text-align: justify;">
<p>We test whether the sum of the two 2048 embeddings of
<code>nice</code> is equal to 2048. If it is true, it indicates that the
embedding results are consistent, which should theoretically be the
case.</p>
</div>
<div class="sourceCode" id="cb39"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">s1</span><span class="op">[</span><span class="fl">0</span><span class="op">]</span><span class="op">$</span><span class="va">embedding</span><span class="op">$</span><span class="fu">numpy</span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="op">==</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">s1</span><span class="op">[</span><span class="fl">0</span><span class="op">]</span><span class="op">$</span><span class="va">embedding</span><span class="op">$</span><span class="fu">numpy</span><span class="op">(</span><span class="op">)</span> <span class="op">==</span>  <span class="va">s2</span><span class="op">[</span><span class="fl">0</span><span class="op">]</span><span class="op">$</span><span class="va">embedding</span><span class="op">$</span><span class="fu">numpy</span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] TRUE</span></span></code></pre></div>
<p>Now we separately add a few more words, <code>very</code> and
<code>pretty</code>, into two sentence objects.</p>
<div class="sourceCode" id="cb40"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">s1</span> <span class="op">&lt;-</span> <span class="fu">Sentence</span><span class="op">(</span><span class="st">"very nice shirt"</span><span class="op">)</span> </span>
<span><span class="va">s2</span> <span class="op">&lt;-</span> <span class="fu">Sentence</span><span class="op">(</span><span class="st">"pretty nice pants"</span><span class="op">)</span> </span>
<span></span>
<span><span class="va">embedding</span><span class="op">$</span><span class="fu">embed</span><span class="op">(</span><span class="va">s1</span><span class="op">)</span> </span>
<span><span class="co">#&gt; [[1]]</span></span>
<span><span class="co">#&gt; Sentence[3]: "very nice shirt"</span></span>
<span><span class="va">embedding</span><span class="op">$</span><span class="fu">embed</span><span class="op">(</span><span class="va">s2</span><span class="op">)</span> </span>
<span><span class="co">#&gt; [[1]]</span></span>
<span><span class="co">#&gt; Sentence[3]: "pretty nice pants"</span></span></code></pre></div>
<p>The two sets of embeddings are not identical because the words are
different, so it returns <strong>FALSE</strong>.</p>
<div class="sourceCode" id="cb41"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">s1</span><span class="op">[</span><span class="fl">0</span><span class="op">]</span><span class="op">$</span><span class="va">embedding</span><span class="op">$</span><span class="fu">numpy</span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="op">==</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">s1</span><span class="op">[</span><span class="fl">0</span><span class="op">]</span><span class="op">$</span><span class="va">embedding</span><span class="op">$</span><span class="fu">numpy</span><span class="op">(</span><span class="op">)</span> <span class="op">==</span>  <span class="va">s2</span><span class="op">[</span><span class="fl">0</span><span class="op">]</span><span class="op">$</span><span class="va">embedding</span><span class="op">$</span><span class="fu">numpy</span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] FALSE</span></span></code></pre></div>
<div style="text-align: justify;">
<p>The measure of similarity between two vectors in an inner product
space is known as cosine similarity. The formula for calculating cosine
similarity between two vectors, such as vectors A and B, is as
follows:</p>
<p><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>C</mi><mi>o</mi><mi>s</mi><mi>i</mi><mi>n</mi><mi>e</mi><mi>S</mi><mi>i</mi><mi>m</mi><mi>i</mi><mi>l</mi><mi>a</mi><mi>r</mi><mi>i</mi><mi>t</mi><mi>y</mi><mo>=</mo><mfrac><mrow><msub><mo>∑</mo><mi>i</mi></msub><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>A</mi><mi>i</mi></msub><mo>⋅</mo><msub><mi>B</mi><mi>i</mi></msub><mo stretchy="true" form="postfix">)</mo></mrow></mrow><mrow><msqrt><mrow><msub><mo>∑</mo><mi>i</mi></msub><mrow><mo stretchy="true" form="prefix">(</mo><msubsup><mi>A</mi><mi>i</mi><mn>2</mn></msubsup><mo stretchy="true" form="postfix">)</mo></mrow></mrow></msqrt><mo>⋅</mo><msqrt><mrow><msub><mo>∑</mo><mi>i</mi></msub><mrow><mo stretchy="true" form="prefix">(</mo><msubsup><mi>B</mi><mi>i</mi><mn>2</mn></msubsup><mo stretchy="true" form="postfix">)</mo></mrow></mrow></msqrt></mrow></mfrac></mrow><annotation encoding="application/x-tex">Cosine Similarity = \frac{\sum_{i} (A_i \cdot B_i)}{\sqrt{\sum_{i} (A_i^2)} \cdot \sqrt{\sum_{i} (B_i^2)}}</annotation></semantics></math></p>
</div>
<div class="sourceCode" id="cb42"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">lsa</span><span class="op">)</span></span>
<span><span class="va">vector1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="va">s1</span><span class="op">[</span><span class="fl">0</span><span class="op">]</span><span class="op">$</span><span class="va">embedding</span><span class="op">$</span><span class="fu">numpy</span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">vector2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="va">s2</span><span class="op">[</span><span class="fl">0</span><span class="op">]</span><span class="op">$</span><span class="va">embedding</span><span class="op">$</span><span class="fu">numpy</span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p>We can observe that the similarity between the two words is 0.55.</p>
<div class="sourceCode" id="cb43"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">cosine_similarity</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/lsa/man/cosine.html" class="external-link">cosine</a></span><span class="op">(</span><span class="va">vector1</span>, <span class="va">vector2</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">cosine_similarity</span><span class="op">)</span></span>
<span><span class="co">#&gt;           [,1]</span></span>
<span><span class="co">#&gt; [1,] 0.5571664</span></span></code></pre></div>
<hr>
</div>
<div class="section level3">
<h3 id="extracting-embeddings-from-bert">Extracting Embeddings from BERT<a class="anchor" aria-label="anchor" href="#extracting-embeddings-from-bert"></a>
</h3>
<div style="text-align: justify;">
<p>First, we utilize the <code>TransformerWordEmbeddings</code> function
to download BERT, and more transformer models can also be found on <a href="https://huggingface.co/flair" class="external-link">Flair NLP’s Hugging Face</a>.</p>
</div>
<div class="sourceCode" id="cb44"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://davidycliao.github.io/flaiR">flaiR</a></span><span class="op">)</span></span>
<span><span class="va">TransformerWordEmbeddings</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/flair_embeddings.html">flair_embeddings</a></span><span class="op">(</span><span class="op">)</span><span class="op">$</span><span class="fu">TransformerWordEmbeddings</span><span class="op">(</span><span class="st">"bert-base-uncased"</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb45"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">embedding</span> <span class="op">&lt;-</span> <span class="va">TransformerWordEmbeddings</span><span class="op">$</span><span class="fu">embed</span><span class="op">(</span><span class="va">sentence</span><span class="op">)</span></span></code></pre></div>
<p>Next, we traverse each token in the sentence and print them.</p>
<div class="sourceCode" id="cb46"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Iterate through each token in the sentence, printing them. </span></span>
<span><span class="co"># Utilize reticulate::py_str(token) to view each token, given that the sentence is a Python object.</span></span>
<span><span class="kw">for</span> <span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq_along</a></span><span class="op">(</span><span class="va">sentence</span><span class="op">$</span><span class="va">tokens</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"Token: "</span>, <span class="fu">reticulate</span><span class="fu">::</span><span class="fu"><a href="https://rstudio.github.io/reticulate/reference/py_str.html" class="external-link">py_str</a></span><span class="op">(</span><span class="va">sentence</span><span class="op">$</span><span class="va">tokens</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span><span class="op">)</span>, <span class="st">"\n"</span><span class="op">)</span></span>
<span>  <span class="co"># Access the embedding of the token, converting it to an R object, </span></span>
<span>  <span class="co"># and print the first 10 elements of the vector.</span></span>
<span>  <span class="va">token_embedding</span> <span class="op">&lt;-</span> <span class="va">sentence</span><span class="op">$</span><span class="va">tokens</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">embedding</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">token_embedding</span>, <span class="fl">10</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span><span class="co">#&gt; Token:  Token[0]: "one" </span></span>
<span><span class="co">#&gt; tensor([-0.0535, -0.0368, -0.2851, -0.0381, -0.0486,  0.2383, -0.1200,  0.2620,</span></span>
<span><span class="co">#&gt;         -0.0575,  0.0228])</span></span>
<span><span class="co">#&gt; Token:  Token[1]: "two" </span></span>
<span><span class="co">#&gt; tensor([ 0.0282, -0.0786, -0.1236,  0.1756, -0.1199,  0.0964, -0.1327,  0.4449,</span></span>
<span><span class="co">#&gt;         -0.0264, -0.1168])</span></span>
<span><span class="co">#&gt; Token:  Token[2]: "three" </span></span>
<span><span class="co">#&gt; tensor([-0.0920, -0.0690, -0.1475,  0.2313, -0.0872,  0.0799, -0.0901,  0.4403,</span></span>
<span><span class="co">#&gt;         -0.0103, -0.1494])</span></span>
<span><span class="co">#&gt; Token:  Token[3]: "one" </span></span>
<span><span class="co">#&gt; tensor([-0.0535, -0.0368, -0.2851, -0.0381, -0.0486,  0.2383, -0.1200,  0.2620,</span></span>
<span><span class="co">#&gt;         -0.0575,  0.0228])</span></span></code></pre></div>
<hr>
</div>
<div class="section level3">
<h3 id="visialized-embeddings">Visialized Embeddings<a class="anchor" aria-label="anchor" href="#visialized-embeddings"></a>
</h3>
<div class="section level4">
<h4 id="word-embeddings-glove">Word Embeddings (GloVe)<a class="anchor" aria-label="anchor" href="#word-embeddings-glove"></a>
</h4>
<ul>
<li><p>GloVe embeddings are Pytorch vectors of dimensionality
100.</p></li>
<li><p>For English, Flair provides a few more options. Here, you can use
<code>en-glove</code> and <code>en-extvec</code> with the
<strong>WordEmbeddings</strong> class.</p></li>
</ul>
<div class="sourceCode" id="cb47"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Initialize Text Processing Tools ---------------------------</span></span>
<span><span class="co"># Import Sentence class for text operations</span></span>
<span><span class="va">Sentence</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/flair_data.html">flair_data</a></span><span class="op">(</span><span class="op">)</span><span class="op">$</span><span class="va">Sentence</span></span>
<span></span>
<span><span class="co"># Configure GloVe Embeddings --------------------------------</span></span>
<span><span class="co"># Load WordEmbeddings class and initialize GloVe model</span></span>
<span><span class="va">WordEmbeddings</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/flair_embeddings.html">flair_embeddings</a></span><span class="op">(</span><span class="op">)</span><span class="op">$</span><span class="va">WordEmbeddings</span></span>
<span><span class="va">embedding</span> <span class="op">&lt;-</span> <span class="fu">WordEmbeddings</span><span class="op">(</span><span class="st">"glove"</span><span class="op">)</span> </span>
<span></span>
<span><span class="co"># Text Processing and Embedding -----------------------------</span></span>
<span><span class="co"># Create sentence with semantic relationship pairs</span></span>
<span><span class="va">sentence</span> <span class="op">&lt;-</span> <span class="fu">Sentence</span><span class="op">(</span><span class="st">"King Queen man woman Paris London apple orange Taiwan Dublin Bamberg"</span><span class="op">)</span> </span>
<span></span>
<span><span class="co"># Apply GloVe embeddings to the sentence</span></span>
<span><span class="va">embedding</span><span class="op">$</span><span class="fu">embed</span><span class="op">(</span><span class="va">sentence</span><span class="op">)</span></span>
<span><span class="co">#&gt; [[1]]</span></span>
<span><span class="co">#&gt; Sentence[11]: "King Queen man woman Paris London apple orange Taiwan Dublin Bamberg"</span></span>
<span></span>
<span><span class="co"># Extract embeddings into matrix format</span></span>
<span><span class="va">sen_df</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/process_embeddings.html">process_embeddings</a></span><span class="op">(</span><span class="va">sentence</span>, </span>
<span>                          verbose <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="co">#&gt; Extracting token embeddings...</span></span>
<span><span class="co">#&gt; Converting embeddings to matrix format...Processing completed in 0.004 seconds</span></span>
<span><span class="co">#&gt; Generated embedding matrix with 11 tokens and 100 dimensions</span></span>
<span></span>
<span><span class="co"># Dimensionality Reduction ---------------------------------</span></span>
<span><span class="co"># Set random seed for reproducibility</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">123</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Apply PCA to reduce dimensions to 3 components</span></span>
<span><span class="va">pca_result</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/prcomp.html" class="external-link">prcomp</a></span><span class="op">(</span><span class="va">sen_df</span>, center <span class="op">=</span> <span class="cn">TRUE</span>, scale. <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Extract first three principal components</span></span>
<span><span class="va">word_embeddings_matrix</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html" class="external-link">as.data.frame</a></span><span class="op">(</span><span class="va">pca_result</span><span class="op">$</span><span class="va">x</span><span class="op">[</span>,<span class="fl">1</span><span class="op">:</span><span class="fl">3</span><span class="op">]</span><span class="op">)</span></span>
<span><span class="va">word_embeddings_matrix</span></span>
<span><span class="co">#&gt;                PC1       PC2         PC3</span></span>
<span><span class="co">#&gt; King    -2.9120910  1.285200 -1.95053854</span></span>
<span><span class="co">#&gt; Queen   -2.2413804  2.266714 -1.09020972</span></span>
<span><span class="co">#&gt; man     -5.6381902  2.984461  3.55462010</span></span>
<span><span class="co">#&gt; woman   -6.4891003  2.458607  3.56693660</span></span>
<span><span class="co">#&gt; Paris    3.0702212  5.039061 -2.65962020</span></span>
<span><span class="co">#&gt; London   5.3196216  4.368433 -2.60726627</span></span>
<span><span class="co">#&gt; apple    0.3362535 -8.679358 -0.44752722</span></span>
<span><span class="co">#&gt; orange  -0.0485467 -4.404101  0.77151480</span></span>
<span><span class="co">#&gt; Taiwan  -2.7993829 -4.149287 -6.33296039</span></span>
<span><span class="co">#&gt; Dublin   5.8994096  1.063291 -0.09271925</span></span>
<span><span class="co">#&gt; Bamberg  5.5031854 -2.233020  7.28777009</span></span></code></pre></div>
<div class="section level5">
<h5 id="d-plot">2D Plot<a class="anchor" aria-label="anchor" href="#d-plot"></a>
</h5>
<div class="sourceCode" id="cb48"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org" class="external-link">ggplot2</a></span><span class="op">)</span></span>
<span><span class="co">#&gt; Error in get(paste0(generic, ".", class), envir = get_method_env()) : </span></span>
<span><span class="co">#&gt;   object 'type_sum.accel' not found</span></span>
<span><span class="va">glove_plot2D</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">word_embeddings_matrix</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">PC1</span>, y <span class="op">=</span> <span class="va">PC2</span>, color <span class="op">=</span> <span class="va">PC3</span>, </span>
<span>                                             label <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">rownames</a></span><span class="op">(</span><span class="va">word_embeddings_matrix</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html" class="external-link">geom_point</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">3</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_text.html" class="external-link">geom_text</a></span><span class="op">(</span>vjust <span class="op">=</span> <span class="fl">1.5</span>, hjust <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span> <span class="op">+</span>  </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_gradient.html" class="external-link">scale_color_gradient</a></span><span class="op">(</span>low <span class="op">=</span> <span class="st">"blue"</span>, high <span class="op">=</span> <span class="st">"red"</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_minimal</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span>  </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>title <span class="op">=</span> <span class="st">""</span>, x <span class="op">=</span> <span class="st">"PC1"</span>, y <span class="op">=</span> <span class="st">"PC2"</span>, color <span class="op">=</span> <span class="st">"PC3"</span><span class="op">)</span> </span>
<span>  <span class="co"># guides(color = "none")  </span></span>
<span><span class="va">glove_plot2D</span></span></code></pre></div>
<p><img src="tutorial_files/figure-html/unnamed-chunk-50-1.png" width="95%"></p>
</div>
<div class="section level5">
<h5 id="d-plot-1">3D Plot<a class="anchor" aria-label="anchor" href="#d-plot-1"></a>
</h5>
<p><a href="https://plotly.com/r/" class="external-link">plotly</a> in R API: <a href="https://plotly.com/r/" class="external-link uri">https://plotly.com/r/</a></p>
<div class="sourceCode" id="cb49"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://plotly-r.com" class="external-link">plotly</a></span><span class="op">)</span></span>
<span><span class="va">glove_plot3D</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/plotly/man/plot_ly.html" class="external-link">plot_ly</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">word_embeddings_matrix</span>, </span>
<span>                  x <span class="op">=</span> <span class="op">~</span><span class="va">PC1</span>, y <span class="op">=</span> <span class="op">~</span><span class="va">PC2</span>, z <span class="op">=</span> <span class="op">~</span><span class="va">PC3</span>, </span>
<span>                  type <span class="op">=</span> <span class="st">"scatter3d"</span>, mode <span class="op">=</span> <span class="st">"markers"</span>,</span>
<span>                  marker <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">5</span><span class="op">)</span>, </span>
<span>                  text <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">rownames</a></span><span class="op">(</span><span class="va">word_embeddings_matrix</span><span class="op">)</span>, hoverinfo <span class="op">=</span> <span class="st">'text'</span><span class="op">)</span></span>
<span></span>
<span><span class="va">glove_plot3D</span></span></code></pre></div>
<div class="plotly html-widget html-fill-item" id="htmlwidget-ac96cb3ee4656e2e9ec3" style="width:95%;height:432.632880098888px;"></div>
<script type="application/json" data-for="htmlwidget-ac96cb3ee4656e2e9ec3">{"x":{"visdat":{"d21ca7b40b5":["function () ","plotlyVisDat"]},"cur_data":"d21ca7b40b5","attrs":{"d21ca7b40b5":{"x":{},"y":{},"z":{},"mode":"markers","marker":{"size":5},"text":["King","Queen","man","woman","Paris","London","apple","orange","Taiwan","Dublin","Bamberg"],"hoverinfo":"text","alpha_stroke":1,"sizes":[10,100],"spans":[1,20],"type":"scatter3d"}},"layout":{"margin":{"b":40,"l":60,"t":25,"r":10},"scene":{"xaxis":{"title":"PC1"},"yaxis":{"title":"PC2"},"zaxis":{"title":"PC3"}},"hovermode":"closest","showlegend":false},"source":"A","config":{"modeBarButtonsToAdd":["hoverclosest","hovercompare"],"showSendToCloud":false},"data":[{"x":[-2.9120909537095603,-2.2413803786431767,-5.6381902126446377,-6.489100263080025,3.0702212168953986,5.3196216302548889,0.33625352733862268,-0.048546700064410864,-2.7993829314866114,5.8994096251956245,5.503185439943886],"y":[1.2851996577231659,2.2667143730326891,2.9844609788519225,2.4586065811283584,5.0390609708283636,4.3684329527277832,-8.6793584684395366,-4.404100922374389,-4.149287004719004,1.0632913485136049,-2.2330204672729552],"z":[-1.9505385365242927,-1.0902097244737821,3.5546200951647635,3.5669365986108126,-2.6596201976138238,-2.6072662735213945,-0.44752721605925688,0.7715148004016178,-6.3329603909196477,-0.09271924783335489,7.2877700927683549],"mode":"markers","marker":{"color":"rgba(31,119,180,1)","size":5,"line":{"color":"rgba(31,119,180,1)"}},"text":["King","Queen","man","woman","Paris","London","apple","orange","Taiwan","Dublin","Bamberg"],"hoverinfo":["text","text","text","text","text","text","text","text","text","text","text"],"type":"scatter3d","error_y":{"color":"rgba(31,119,180,1)"},"error_x":{"color":"rgba(31,119,180,1)"},"line":{"color":"rgba(31,119,180,1)"},"frame":null}],"highlight":{"on":"plotly_click","persistent":false,"dynamic":false,"selectize":false,"opacityDim":0.20000000000000001,"selected":{"opacity":1},"debounce":0},"shinyEvents":["plotly_hover","plotly_click","plotly_selected","plotly_relayout","plotly_brushed","plotly_brushing","plotly_clickannotation","plotly_doubleclick","plotly_deselect","plotly_afterplot","plotly_sunburstclick"],"base_url":"https://plot.ly"},"evals":[],"jsHooks":[]}</script>
</div>
</div>
<div class="section level4">
<h4 id="stack-embeddings-method-glove-backforwad-flairembeddings-or-more">Stack Embeddings Method (GloVe + Back/forwad FlairEmbeddings or
More)<a class="anchor" aria-label="anchor" href="#stack-embeddings-method-glove-backforwad-flairembeddings-or-more"></a>
</h4>
<div class="sourceCode" id="cb50"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Initialize Embeddings -----------------------------</span></span>
<span><span class="co"># Load embedding types from flaiR</span></span>
<span><span class="va">WordEmbeddings</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/flair_embeddings.html">flair_embeddings</a></span><span class="op">(</span><span class="op">)</span><span class="op">$</span><span class="va">WordEmbeddings</span></span>
<span><span class="va">FlairEmbeddings</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/flair_embeddings.html">flair_embeddings</a></span><span class="op">(</span><span class="op">)</span><span class="op">$</span><span class="va">FlairEmbeddings</span></span>
<span><span class="va">StackedEmbeddings</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/flair_embeddings.html">flair_embeddings</a></span><span class="op">(</span><span class="op">)</span><span class="op">$</span><span class="va">StackedEmbeddings</span></span>
<span></span>
<span><span class="co"># Configure Embeddings ----------------------------</span></span>
<span><span class="co"># Initialize GloVe word embeddings</span></span>
<span><span class="va">glove_embedding</span> <span class="op">&lt;-</span> <span class="fu">WordEmbeddings</span><span class="op">(</span><span class="st">'glove'</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Initialize Flair contextual embeddings</span></span>
<span><span class="va">flair_embedding_forward</span> <span class="op">&lt;-</span> <span class="fu">FlairEmbeddings</span><span class="op">(</span><span class="st">'news-forward'</span><span class="op">)</span></span>
<span><span class="va">flair_embedding_backward</span> <span class="op">&lt;-</span> <span class="fu">FlairEmbeddings</span><span class="op">(</span><span class="st">'news-backward'</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Initialize GloVe for individual use</span></span>
<span><span class="va">embedding</span> <span class="op">&lt;-</span> <span class="fu">WordEmbeddings</span><span class="op">(</span><span class="st">"glove"</span><span class="op">)</span> </span>
<span></span>
<span><span class="co"># Create stacked embeddings combining GloVe and bidirectional Flair</span></span>
<span><span class="va">stacked_embeddings</span> <span class="op">&lt;-</span> <span class="fu">StackedEmbeddings</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">glove_embedding</span>,</span>
<span>                                         <span class="va">flair_embedding_forward</span>,</span>
<span>                                         <span class="va">flair_embedding_backward</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Text Processing --------------------------------</span></span>
<span><span class="co"># Load Sentence class from flaiR</span></span>
<span><span class="va">Sentence</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/flair_data.html">flair_data</a></span><span class="op">(</span><span class="op">)</span><span class="op">$</span><span class="va">Sentence</span></span>
<span></span>
<span><span class="co"># Create test sentence with semantic relationships</span></span>
<span><span class="va">sentence</span> <span class="op">&lt;-</span> <span class="fu">Sentence</span><span class="op">(</span><span class="st">"King Queen man woman Paris London apple orange Taiwan Dublin Bamberg"</span><span class="op">)</span> </span>
<span></span>
<span><span class="co"># Apply embeddings and extract features ----------</span></span>
<span><span class="co"># Embed text using stacked embeddings</span></span>
<span><span class="va">stacked_embeddings</span><span class="op">$</span><span class="fu">embed</span><span class="op">(</span><span class="va">sentence</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Extract embeddings matrix with processing details</span></span>
<span><span class="va">sen_df</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/process_embeddings.html">process_embeddings</a></span><span class="op">(</span><span class="va">sentence</span>, </span>
<span>                           verbose <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="co">#&gt; Extracting token embeddings...</span></span>
<span><span class="co">#&gt; Converting embeddings to matrix format...Processing completed in 0.004 seconds</span></span>
<span><span class="co">#&gt; Generated embedding matrix with 11 tokens and 4196 dimensions</span></span>
<span></span>
<span><span class="co"># Dimensionality Reduction -----------------------</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">123</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Perform PCA for visualization</span></span>
<span><span class="va">pca_result</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/prcomp.html" class="external-link">prcomp</a></span><span class="op">(</span><span class="va">sen_df</span>, center <span class="op">=</span> <span class="cn">TRUE</span>, scale. <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Extract first three principal components</span></span>
<span><span class="va">word_embeddings_matrix</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html" class="external-link">as.data.frame</a></span><span class="op">(</span><span class="va">pca_result</span><span class="op">$</span><span class="va">x</span><span class="op">[</span>,<span class="fl">1</span><span class="op">:</span><span class="fl">3</span><span class="op">]</span><span class="op">)</span></span>
<span><span class="va">word_embeddings_matrix</span></span>
<span><span class="co">#&gt;                PC1         PC2         PC3</span></span>
<span><span class="co">#&gt; King     -8.607474  67.2291112  32.4862807</span></span>
<span><span class="co">#&gt; Queen     1.757707  12.0477210 -26.8302480</span></span>
<span><span class="co">#&gt; man      70.603191  -6.6184707  13.1651688</span></span>
<span><span class="co">#&gt; woman    22.532043  -8.1126267  -0.9073998</span></span>
<span><span class="co">#&gt; Paris   -11.395619  -0.3051693 -17.5197067</span></span>
<span><span class="co">#&gt; London   -8.709174  -2.7450626 -14.1780531</span></span>
<span><span class="co">#&gt; apple    -8.739477 -15.7725211  -6.3796349</span></span>
<span><span class="co">#&gt; orange  -25.178329 -38.8501308  51.4907636</span></span>
<span><span class="co">#&gt; Taiwan   -9.132397  -5.0252091 -11.0918877</span></span>
<span><span class="co">#&gt; Dublin  -10.925014  -3.3407329 -10.1367729</span></span>
<span><span class="co">#&gt; Bamberg -12.205457   1.4930909 -10.0985100</span></span></code></pre></div>
<div class="sourceCode" id="cb51"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># 2D Plot</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org" class="external-link">ggplot2</a></span><span class="op">)</span></span>
<span></span>
<span><span class="va">stacked_plot2D</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">word_embeddings_matrix</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">PC1</span>, y <span class="op">=</span> <span class="va">PC2</span>, color <span class="op">=</span> <span class="va">PC3</span>, </span>
<span>                                             label <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">rownames</a></span><span class="op">(</span><span class="va">word_embeddings_matrix</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html" class="external-link">geom_point</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">2</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_text.html" class="external-link">geom_text</a></span><span class="op">(</span>vjust <span class="op">=</span> <span class="fl">1.5</span>, hjust <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span> <span class="op">+</span>  </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_gradient.html" class="external-link">scale_color_gradient</a></span><span class="op">(</span>low <span class="op">=</span> <span class="st">"blue"</span>, high <span class="op">=</span> <span class="st">"red"</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_minimal</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span>  </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>title <span class="op">=</span> <span class="st">""</span>, x <span class="op">=</span> <span class="st">"PC1"</span>, y <span class="op">=</span> <span class="st">"PC2"</span>, color <span class="op">=</span> <span class="st">"PC3"</span><span class="op">)</span> </span>
<span></span>
<span><span class="va">stacked_plot2D</span></span></code></pre></div>
<p><img src="tutorial_files/figure-html/unnamed-chunk-53-1.png" width="95%"></p>
</div>
<div class="section level4">
<h4 id="transformer-embeddings-bert-or-more">Transformer Embeddings (BERT or More)<a class="anchor" aria-label="anchor" href="#transformer-embeddings-bert-or-more"></a>
</h4>
<div class="sourceCode" id="cb52"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Load Required Package ----------------------------</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://davidycliao.github.io/flaiR">flaiR</a></span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Initialize BERT and Text Processing --------------</span></span>
<span><span class="co"># Import Sentence class for text operations</span></span>
<span><span class="va">Sentence</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/flair_data.html">flair_data</a></span><span class="op">(</span><span class="op">)</span><span class="op">$</span><span class="va">Sentence</span></span>
<span></span>
<span><span class="co"># Initialize BERT model (base uncased version)</span></span>
<span><span class="va">TransformerWordEmbeddings</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/flair_embeddings.html">flair_embeddings</a></span><span class="op">(</span><span class="op">)</span><span class="op">$</span><span class="fu">TransformerWordEmbeddings</span><span class="op">(</span><span class="st">"bert-base-uncased"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Text Processing and Embedding --------------------</span></span>
<span><span class="co"># Create sentence with semantic relationship pairs</span></span>
<span><span class="va">sentence</span> <span class="op">&lt;-</span> <span class="fu">Sentence</span><span class="op">(</span><span class="st">"King Queen man woman Paris London apple orange Taiwan Dublin Bamberg"</span><span class="op">)</span> </span>
<span></span>
<span><span class="co"># Apply BERT embeddings to the sentence</span></span>
<span><span class="va">TransformerWordEmbeddings</span><span class="op">$</span><span class="fu">embed</span><span class="op">(</span><span class="va">sentence</span><span class="op">)</span></span>
<span><span class="co">#&gt; [[1]]</span></span>
<span><span class="co">#&gt; Sentence[11]: "King Queen man woman Paris London apple orange Taiwan Dublin Bamberg"</span></span>
<span></span>
<span><span class="co"># Extract embeddings into matrix format</span></span>
<span><span class="va">sen_df</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/process_embeddings.html">process_embeddings</a></span><span class="op">(</span><span class="va">sentence</span>, verbose <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="co">#&gt; Extracting token embeddings...</span></span>
<span><span class="co">#&gt; Converting embeddings to matrix format...Processing completed in 0.003 seconds</span></span>
<span><span class="co">#&gt; Generated embedding matrix with 11 tokens and 768 dimensions</span></span>
<span></span>
<span><span class="co"># Dimensionality Reduction ------------------------</span></span>
<span><span class="co"># Set random seed for reproducibility</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">123</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Apply PCA to reduce dimensions to 3 components</span></span>
<span><span class="va">pca_result</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/prcomp.html" class="external-link">prcomp</a></span><span class="op">(</span><span class="va">sen_df</span>, center <span class="op">=</span> <span class="cn">TRUE</span>, scale. <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Extract first three principal components</span></span>
<span><span class="va">word_embeddings_matrix</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html" class="external-link">as.data.frame</a></span><span class="op">(</span><span class="va">pca_result</span><span class="op">$</span><span class="va">x</span><span class="op">[</span>,<span class="fl">1</span><span class="op">:</span><span class="fl">3</span><span class="op">]</span><span class="op">)</span></span>
<span><span class="va">word_embeddings_matrix</span></span>
<span><span class="co">#&gt;                 PC1        PC2        PC3</span></span>
<span><span class="co">#&gt; King    -11.6842347   4.264808  -2.539324</span></span>
<span><span class="co">#&gt; Queen   -18.6452298  13.278101  -9.781921</span></span>
<span><span class="co">#&gt; man     -18.3565835  10.571228  -1.609781</span></span>
<span><span class="co">#&gt; woman   -10.6397328  -2.072400   2.264161</span></span>
<span><span class="co">#&gt; Paris     6.9078801  -9.409341 -10.378025</span></span>
<span><span class="co">#&gt; London   10.7817432  -8.882279 -11.447068</span></span>
<span><span class="co">#&gt; apple    -0.6539988  -8.305127  12.104269</span></span>
<span><span class="co">#&gt; orange   -3.4409945  -4.756969  19.216404</span></span>
<span><span class="co">#&gt; Taiwan    4.5377624 -12.949620   4.782958</span></span>
<span><span class="co">#&gt; Dublin   13.4844947 -11.327335  -7.191557</span></span>
<span><span class="co">#&gt; Bamberg  27.7088939  29.588933   4.579885</span></span></code></pre></div>
<div class="sourceCode" id="cb53"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># 2D Plot</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org" class="external-link">ggplot2</a></span><span class="op">)</span></span>
<span></span>
<span><span class="va">bert_plot2D</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">word_embeddings_matrix</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">PC1</span>, y <span class="op">=</span> <span class="va">PC2</span>, color <span class="op">=</span> <span class="va">PC3</span>, </span>
<span>                                             label <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">rownames</a></span><span class="op">(</span><span class="va">word_embeddings_matrix</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html" class="external-link">geom_point</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">2</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_text.html" class="external-link">geom_text</a></span><span class="op">(</span>vjust <span class="op">=</span> <span class="fl">1.5</span>, hjust <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span> <span class="op">+</span>  </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_gradient.html" class="external-link">scale_color_gradient</a></span><span class="op">(</span>low <span class="op">=</span> <span class="st">"blue"</span>, high <span class="op">=</span> <span class="st">"red"</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_minimal</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span>  </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>title <span class="op">=</span> <span class="st">""</span>, x <span class="op">=</span> <span class="st">"PC1"</span>, y <span class="op">=</span> <span class="st">"PC2"</span>, color <span class="op">=</span> <span class="st">"PC3"</span><span class="op">)</span> </span>
<span>  <span class="co"># guides(color = "none") </span></span>
<span></span>
<span><span class="va">stacked_plot2D</span></span></code></pre></div>
<p><img src="tutorial_files/figure-html/unnamed-chunk-55-1.png" width="95%"></p>
</div>
<div class="section level4">
<h4 id="embedding-models-comparison">Embedding Models Comparison<a class="anchor" aria-label="anchor" href="#embedding-models-comparison"></a>
</h4>
<div class="sourceCode" id="cb54"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://rpkgs.datanovia.com/ggpubr/" class="external-link">ggpubr</a></span><span class="op">)</span></span>
<span></span>
<span><span class="va">figure</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rpkgs.datanovia.com/ggpubr/reference/ggarrange.html" class="external-link">ggarrange</a></span><span class="op">(</span><span class="va">glove_plot2D</span>, <span class="va">stacked_plot2D</span>, <span class="va">bert_plot2D</span>,</span>
<span>                   labels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Glove"</span>, <span class="st">"Stacked Embedding"</span>, <span class="st">"BERT"</span><span class="op">)</span>,</span>
<span>                   ncol <span class="op">=</span> <span class="fl">3</span>, nrow <span class="op">=</span> <span class="fl">1</span>,</span>
<span>                   common.legend <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>                   legend <span class="op">=</span> <span class="st">"bottom"</span>,</span>
<span>                   font.label <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">8</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">figure</span></span></code></pre></div>
<p><img src="tutorial_files/figure-html/unnamed-chunk-56-1.png" width="95%"></p>
<hr>
</div>
</div>
</div>
<div class="section level2">
<h2 id="training-a-binary-classifier">Training a Binary Classifier<a class="anchor" aria-label="anchor" href="#training-a-binary-classifier"></a>
</h2>
<p>In this section, we’ll train a sentiment analysis model that can
categorize text as either positive or negative. This case study is
adapted from pages 116 to 130 of Tadej Magajna’s book, ‘<a href="https://www.packtpub.com/product/natural-language-processing-with-flair/9781801072311" class="external-link">Natural
Language Processing with Flair</a>’. The process for training text
classifiers in Flair mirrors the process followed for sequence labeling
models. Specifically, the steps to train text classifiers are:</p>
<ul>
<li>Load a tagged corpus and compute the label dictionary map.</li>
<li>Prepare the document embeddings.</li>
<li>Initialize the <code>TextClassifier</code> class.</li>
<li>Train the model.</li>
</ul>
<div class="section level3">
<h3 id="loading-a-tagged-corpus">Loading a Tagged Corpus<a class="anchor" aria-label="anchor" href="#loading-a-tagged-corpus"></a>
</h3>
<div style="text-align: justify;">
<p>Training text classification models requires a set of text documents
(typically, sentences or paragraphs) where each document is associated
with one or more classification labels. To train our sentiment analysis
text classification model, we will be using the famous Internet Movie
Database (IMDb) dataset, which contains 50,000 movie reviews from IMDB,
where each review is labeled as either positive or negative. References
to this dataset are already baked into Flair, so loading the dataset
couldn’t be easier:</p>
</div>
<div class="sourceCode" id="cb55"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://davidycliao.github.io/flaiR">flaiR</a></span><span class="op">)</span></span>
<span><span class="co"># load IMDB from flair_datasets module</span></span>
<span><span class="va">Corpus</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/flair_data.html">flair_data</a></span><span class="op">(</span><span class="op">)</span><span class="op">$</span><span class="va">Corpus</span></span>
<span><span class="va">IMDB</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/flair_datasets.html">flair_datasets</a></span><span class="op">(</span><span class="op">)</span><span class="op">$</span><span class="va">IMDB</span></span></code></pre></div>
<div class="sourceCode" id="cb56"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># downsize to 0.05</span></span>
<span><span class="va">corpus</span> <span class="op">=</span> <span class="fu">IMDB</span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; 2024-12-28 16:30:20,009 Reading data from /Users/yenchiehliao/.flair/datasets/imdb_v4-rebalanced</span></span>
<span><span class="co">#&gt; 2024-12-28 16:30:20,009 Train: /Users/yenchiehliao/.flair/datasets/imdb_v4-rebalanced/train.txt</span></span>
<span><span class="co">#&gt; 2024-12-28 16:30:20,009 Dev: None</span></span>
<span><span class="co">#&gt; 2024-12-28 16:30:20,009 Test: None</span></span>
<span><span class="co">#&gt; 2024-12-28 16:30:20,523 No test split found. Using 10% (i.e. 5000 samples) of the train split as test data</span></span>
<span><span class="co">#&gt; 2024-12-28 16:30:20,533 No dev split found. Using 10% (i.e. 4500 samples) of the train split as dev data</span></span>
<span><span class="co">#&gt; 2024-12-28 16:30:20,533 Initialized corpus /Users/yenchiehliao/.flair/datasets/imdb_v4-rebalanced (label type name is 'sentiment')</span></span>
<span><span class="va">corpus</span><span class="op">$</span><span class="fu">downsample</span><span class="op">(</span><span class="fl">0.05</span><span class="op">)</span></span>
<span><span class="co">#&gt; &lt;flair.datasets.document_classification.IMDB object at 0x339d987d0&gt;</span></span></code></pre></div>
<p>Print the sizes in the corpus object as follows - test: %d | train:
%d | dev: %d”</p>
<div class="sourceCode" id="cb57"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">test_size</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">corpus</span><span class="op">$</span><span class="va">test</span><span class="op">)</span></span>
<span><span class="va">train_size</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">corpus</span><span class="op">$</span><span class="va">train</span><span class="op">)</span></span>
<span><span class="va">dev_size</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">corpus</span><span class="op">$</span><span class="va">dev</span><span class="op">)</span></span>
<span><span class="va">output</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sprintf.html" class="external-link">sprintf</a></span><span class="op">(</span><span class="st">"Corpus object sizes - Test: %d | Train: %d | Dev: %d"</span>, <span class="va">test_size</span>, <span class="va">train_size</span>, <span class="va">dev_size</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">output</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "Corpus object sizes - Test: 250 | Train: 2025 | Dev: 225"</span></span></code></pre></div>
<div class="sourceCode" id="cb58"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">lbl_type</span> <span class="op">=</span> <span class="st">'sentiment'</span></span>
<span><span class="va">label_dict</span> <span class="op">=</span> <span class="va">corpus</span><span class="op">$</span><span class="fu">make_label_dictionary</span><span class="op">(</span>label_type<span class="op">=</span><span class="va">lbl_type</span><span class="op">)</span></span>
<span><span class="co">#&gt; 2024-12-28 16:30:20,620 Computing label dictionary. Progress:</span></span>
<span><span class="co">#&gt; 2024-12-28 16:30:23,817 Dictionary created for label 'sentiment' with 2 values: POSITIVE (seen 1014 times), NEGATIVE (seen 1011 times)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="loading-the-embeddings">Loading the Embeddings<a class="anchor" aria-label="anchor" href="#loading-the-embeddings"></a>
</h3>
<div style="text-align: justify;">
<p>flaiR covers all the different types of document embeddings that we
can use. Here, we simply use <code>DocumentPoolEmbeddings</code>. They
require no training prior to training the classification model
itself:</p>
</div>
<div class="sourceCode" id="cb59"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">DocumentPoolEmbeddings</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/flair_embeddings.html">flair_embeddings</a></span><span class="op">(</span><span class="op">)</span><span class="op">$</span><span class="va">DocumentPoolEmbeddings</span></span>
<span><span class="va">WordEmbeddings</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/flair_embeddings.html">flair_embeddings</a></span><span class="op">(</span><span class="op">)</span><span class="op">$</span><span class="va">WordEmbeddings</span></span>
<span><span class="va">glove</span> <span class="op">=</span> <span class="fu">WordEmbeddings</span><span class="op">(</span><span class="st">'glove'</span><span class="op">)</span></span>
<span><span class="va">document_embeddings</span> <span class="op">=</span> <span class="fu">DocumentPoolEmbeddings</span><span class="op">(</span><span class="va">glove</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="initializing-the-textclassifier">Initializing the TextClassifier<a class="anchor" aria-label="anchor" href="#initializing-the-textclassifier"></a>
</h3>
<div class="sourceCode" id="cb60"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># initiate TextClassifier</span></span>
<span><span class="va">TextClassifier</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/flair_models.html">flair_models</a></span><span class="op">(</span><span class="op">)</span><span class="op">$</span><span class="va">TextClassifier</span></span>
<span><span class="va">classifier</span> <span class="op">&lt;-</span> <span class="fu">TextClassifier</span><span class="op">(</span><span class="va">document_embeddings</span>,</span>
<span>                             label_dictionary <span class="op">=</span> <span class="va">label_dict</span>,</span>
<span>                             label_type <span class="op">=</span> <span class="va">lbl_type</span><span class="op">)</span></span></code></pre></div>
<p><code>$to</code> allows you to set the device to use CPU, GPU, or
specific MPS devices on Mac (such as mps:0, mps:1, mps:2).</p>
<div class="sourceCode" id="cb61"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">classifier</span><span class="op">$</span><span class="fu">to</span><span class="op">(</span><span class="fu"><a href="../reference/flair_device.html">flair_device</a></span><span class="op">(</span><span class="st">"mps"</span><span class="op">)</span><span class="op">)</span> </span></code></pre></div>
<pre><code><span><span class="fu">TextClassifier</span><span class="op">(</span></span>
<span>  <span class="op">(</span><span class="va">embeddings</span><span class="op">)</span><span class="op">:</span> <span class="fu">DocumentPoolEmbeddings</span><span class="op">(</span></span>
<span>    fine_tune_mode<span class="op">=</span><span class="va">none</span>, pooling<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span></span>
<span>    <span class="op">(</span><span class="va">embeddings</span><span class="op">)</span><span class="op">:</span> <span class="fu">StackedEmbeddings</span><span class="op">(</span></span>
<span>      <span class="op">(</span><span class="va">list_embedding_0</span><span class="op">)</span><span class="op">:</span> <span class="fu">WordEmbeddings</span><span class="op">(</span></span>
<span>        <span class="st">'glove'</span></span>
<span>        <span class="op">(</span><span class="va">embedding</span><span class="op">)</span><span class="op">:</span> <span class="fu">Embedding</span><span class="op">(</span><span class="fl">400001</span>, <span class="fl">100</span><span class="op">)</span></span>
<span>      <span class="op">)</span></span>
<span>    <span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span>  <span class="op">(</span><span class="va">decoder</span><span class="op">)</span><span class="op">:</span> <span class="fu">Linear</span><span class="op">(</span>in_features<span class="op">=</span><span class="fl">100</span>, out_features<span class="op">=</span><span class="fl">3</span>, bias<span class="op">=</span><span class="va">True</span><span class="op">)</span></span>
<span>  <span class="op">(</span><span class="va">dropout</span><span class="op">)</span><span class="op">:</span> <span class="fu">Dropout</span><span class="op">(</span>p<span class="op">=</span><span class="fl">0.0</span>, inplace<span class="op">=</span><span class="va">False</span><span class="op">)</span></span>
<span>  <span class="op">(</span><span class="va">locked_dropout</span><span class="op">)</span><span class="op">:</span> <span class="fu">LockedDropout</span><span class="op">(</span>p<span class="op">=</span><span class="fl">0.0</span><span class="op">)</span></span>
<span>  <span class="op">(</span><span class="va">word_dropout</span><span class="op">)</span><span class="op">:</span> <span class="fu">WordDropout</span><span class="op">(</span>p<span class="op">=</span><span class="fl">0.0</span><span class="op">)</span></span>
<span>  <span class="op">(</span><span class="va">loss_function</span><span class="op">)</span><span class="op">:</span> <span class="fu">CrossEntropyLoss</span><span class="op">(</span><span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre>
</div>
<div class="section level3">
<h3 id="training-the-model">Training the Model<a class="anchor" aria-label="anchor" href="#training-the-model"></a>
</h3>
<p>Training the text classifier model involves two simple steps:</p>
<ul>
<li>Defining the model trainer class by passing in the classifier model
and the corpus</li>
<li>Setting off the training process passing in the required training
hyper-parameters.</li>
</ul>
<div style="text-align: justify;">
<p><strong>It is worth noting that the ‘L’ in numbers like 32L and 5L is
used in R to denote that the number is an integer. Without the ‘L’
suffix, numbers in R are treated as numeric, which are by default
double-precision floating-point numbers. In contrast, Python determines
the type based on the value of the number itself. Whole numbers (e.g., 5
or 32) are of type int, while numbers with decimal points (e.g., 5.0)
are of type float. Floating-point numbers in both languages are
representations of real numbers but can have some approximation due to
the way they are stored in memory.</strong></p>
</div>
<div class="sourceCode" id="cb63"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># initiate ModelTrainer</span></span>
<span><span class="va">ModelTrainer</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/flair_trainers.html">flair_trainers</a></span><span class="op">(</span><span class="op">)</span><span class="op">$</span><span class="va">ModelTrainer</span></span>
<span></span>
<span><span class="co"># fit the model</span></span>
<span><span class="va">trainer</span> <span class="op">&lt;-</span> <span class="fu">ModelTrainer</span><span class="op">(</span><span class="va">classifier</span>, <span class="va">corpus</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># start to train</span></span>
<span><span class="co"># note: the 'L' in 32L is used in R to denote that the number is an integer.</span></span>
<span><span class="va">trainer</span><span class="op">$</span><span class="fu">train</span><span class="op">(</span><span class="st">'classifier'</span>,</span>
<span>              learning_rate<span class="op">=</span><span class="fl">0.1</span>,</span>
<span>              mini_batch_size<span class="op">=</span><span class="fl">32L</span>,</span>
<span>              <span class="co"># specifies how embeddings are stored in RAM, ie."cpu", "cuda", "gpu", "mps".</span></span>
<span>              <span class="co"># embeddings_storage_mode = "mps",</span></span>
<span>              max_epochs<span class="op">=</span><span class="fl">10L</span><span class="op">)</span></span>
<span><span class="co">#&gt; 2024-12-28 16:30:25,722 ----------------------------------------------------------------------------------------------------</span></span>
<span><span class="co">#&gt; 2024-12-28 16:30:25,722 Model: "TextClassifier(</span></span>
<span><span class="co">#&gt;   (embeddings): DocumentPoolEmbeddings(</span></span>
<span><span class="co">#&gt;     fine_tune_mode=none, pooling=mean</span></span>
<span><span class="co">#&gt;     (embeddings): StackedEmbeddings(</span></span>
<span><span class="co">#&gt;       (list_embedding_0): WordEmbeddings(</span></span>
<span><span class="co">#&gt;         'glove'</span></span>
<span><span class="co">#&gt;         (embedding): Embedding(400001, 100)</span></span>
<span><span class="co">#&gt;       )</span></span>
<span><span class="co">#&gt;     )</span></span>
<span><span class="co">#&gt;   )</span></span>
<span><span class="co">#&gt;   (decoder): Linear(in_features=100, out_features=2, bias=True)</span></span>
<span><span class="co">#&gt;   (dropout): Dropout(p=0.0, inplace=False)</span></span>
<span><span class="co">#&gt;   (locked_dropout): LockedDropout(p=0.0)</span></span>
<span><span class="co">#&gt;   (word_dropout): WordDropout(p=0.0)</span></span>
<span><span class="co">#&gt;   (loss_function): CrossEntropyLoss()</span></span>
<span><span class="co">#&gt;   (weights): None</span></span>
<span><span class="co">#&gt;   (weight_tensor) None</span></span>
<span><span class="co">#&gt; )"</span></span>
<span><span class="co">#&gt; 2024-12-28 16:30:25,722 ----------------------------------------------------------------------------------------------------</span></span>
<span><span class="co">#&gt; 2024-12-28 16:30:25,722 Corpus: 2025 train + 225 dev + 250 test sentences</span></span>
<span><span class="co">#&gt; 2024-12-28 16:30:25,722 ----------------------------------------------------------------------------------------------------</span></span>
<span><span class="co">#&gt; 2024-12-28 16:30:25,722 Train:  2025 sentences</span></span>
<span><span class="co">#&gt; 2024-12-28 16:30:25,722         (train_with_dev=False, train_with_test=False)</span></span>
<span><span class="co">#&gt; 2024-12-28 16:30:25,722 ----------------------------------------------------------------------------------------------------</span></span>
<span><span class="co">#&gt; 2024-12-28 16:30:25,722 Training Params:</span></span>
<span><span class="co">#&gt; 2024-12-28 16:30:25,723  - learning_rate: "0.1" </span></span>
<span><span class="co">#&gt; 2024-12-28 16:30:25,723  - mini_batch_size: "32"</span></span>
<span><span class="co">#&gt; 2024-12-28 16:30:25,723  - max_epochs: "10"</span></span>
<span><span class="co">#&gt; 2024-12-28 16:30:25,723  - shuffle: "True"</span></span>
<span><span class="co">#&gt; 2024-12-28 16:30:25,723 ----------------------------------------------------------------------------------------------------</span></span>
<span><span class="co">#&gt; 2024-12-28 16:30:25,723 Plugins:</span></span>
<span><span class="co">#&gt; 2024-12-28 16:30:25,723  - AnnealOnPlateau | patience: '3', anneal_factor: '0.5', min_learning_rate: '0.0001'</span></span>
<span><span class="co">#&gt; 2024-12-28 16:30:25,723 ----------------------------------------------------------------------------------------------------</span></span>
<span><span class="co">#&gt; 2024-12-28 16:30:25,723 Final evaluation on model from best epoch (best-model.pt)</span></span>
<span><span class="co">#&gt; 2024-12-28 16:30:25,723  - metric: "('micro avg', 'f1-score')"</span></span>
<span><span class="co">#&gt; 2024-12-28 16:30:25,723 ----------------------------------------------------------------------------------------------------</span></span>
<span><span class="co">#&gt; 2024-12-28 16:30:25,723 Computation:</span></span>
<span><span class="co">#&gt; 2024-12-28 16:30:25,723  - compute on device: cpu</span></span>
<span><span class="co">#&gt; 2024-12-28 16:30:25,723  - embedding storage: cpu</span></span>
<span><span class="co">#&gt; 2024-12-28 16:30:25,723 ----------------------------------------------------------------------------------------------------</span></span>
<span><span class="co">#&gt; 2024-12-28 16:30:25,723 Model training base path: "classifier"</span></span>
<span><span class="co">#&gt; 2024-12-28 16:30:25,723 ----------------------------------------------------------------------------------------------------</span></span>
<span><span class="co">#&gt; 2024-12-28 16:30:25,723 ----------------------------------------------------------------------------------------------------</span></span>
<span><span class="co">#&gt; 2024-12-28 16:30:26,436 epoch 1 - iter 6/64 - loss 1.08459203 - time (sec): 0.71 - samples/sec: 269.46 - lr: 0.100000 - momentum: 0.000000</span></span>
<span><span class="co">#&gt; 2024-12-28 16:30:27,167 epoch 1 - iter 12/64 - loss 1.07419472 - time (sec): 1.44 - samples/sec: 266.05 - lr: 0.100000 - momentum: 0.000000</span></span>
<span><span class="co">#&gt; 2024-12-28 16:30:27,960 epoch 1 - iter 18/64 - loss 1.04684123 - time (sec): 2.24 - samples/sec: 257.47 - lr: 0.100000 - momentum: 0.000000</span></span>
<span><span class="co">#&gt; 2024-12-28 16:30:28,597 epoch 1 - iter 24/64 - loss 1.02129807 - time (sec): 2.87 - samples/sec: 267.27 - lr: 0.100000 - momentum: 0.000000</span></span>
<span><span class="co">#&gt; 2024-12-28 16:30:29,291 epoch 1 - iter 30/64 - loss 0.99138649 - time (sec): 3.57 - samples/sec: 269.07 - lr: 0.100000 - momentum: 0.000000</span></span>
<span><span class="co">#&gt; 2024-12-28 16:30:29,978 epoch 1 - iter 36/64 - loss 0.97801477 - time (sec): 4.25 - samples/sec: 270.76 - lr: 0.100000 - momentum: 0.000000</span></span>
<span><span class="co">#&gt; 2024-12-28 16:30:30,870 epoch 1 - iter 42/64 - loss 0.96740411 - time (sec): 5.15 - samples/sec: 261.13 - lr: 0.100000 - momentum: 0.000000</span></span>
<span><span class="co">#&gt; 2024-12-28 16:30:31,568 epoch 1 - iter 48/64 - loss 0.96869479 - time (sec): 5.84 - samples/sec: 262.80 - lr: 0.100000 - momentum: 0.000000</span></span>
<span><span class="co">#&gt; 2024-12-28 16:30:32,261 epoch 1 - iter 54/64 - loss 0.96146011 - time (sec): 6.54 - samples/sec: 264.31 - lr: 0.100000 - momentum: 0.000000</span></span>
<span><span class="co">#&gt; 2024-12-28 16:30:32,948 epoch 1 - iter 60/64 - loss 0.94964474 - time (sec): 7.22 - samples/sec: 265.75 - lr: 0.100000 - momentum: 0.000000</span></span>
<span><span class="co">#&gt; 2024-12-28 16:30:33,368 ----------------------------------------------------------------------------------------------------</span></span>
<span><span class="co">#&gt; 2024-12-28 16:30:33,368 EPOCH 1 done: loss 0.9512 - lr: 0.100000</span></span>
<span><span class="co">#&gt; 2024-12-28 16:30:34,470 DEV : loss 0.7587453722953796 - f1-score (micro avg)  0.5467</span></span>
<span><span class="co">#&gt; 2024-12-28 16:30:34,828  - 0 epochs without improvement</span></span>
<span><span class="co">#&gt; 2024-12-28 16:30:34,833 saving best model</span></span>
<span><span class="co">#&gt; 2024-12-28 16:30:35,198 ----------------------------------------------------------------------------------------------------</span></span>
<span><span class="co">#&gt; 2024-12-28 16:30:35,983 epoch 2 - iter 6/64 - loss 0.91960125 - time (sec): 0.78 - samples/sec: 244.59 - lr: 0.100000 - momentum: 0.000000</span></span>
<span><span class="co">#&gt; 2024-12-28 16:30:36,665 epoch 2 - iter 12/64 - loss 0.90101201 - time (sec): 1.47 - samples/sec: 261.82 - lr: 0.100000 - momentum: 0.000000</span></span>
<span><span class="co">#&gt; 2024-12-28 16:30:37,350 epoch 2 - iter 18/64 - loss 0.89713474 - time (sec): 2.15 - samples/sec: 267.70 - lr: 0.100000 - momentum: 0.000000</span></span>
<span><span class="co">#&gt; 2024-12-28 16:30:38,244 epoch 2 - iter 24/64 - loss 0.89578880 - time (sec): 3.05 - samples/sec: 252.21 - lr: 0.100000 - momentum: 0.000000</span></span>
<span><span class="co">#&gt; 2024-12-28 16:30:38,893 epoch 2 - iter 30/64 - loss 0.89339162 - time (sec): 3.69 - samples/sec: 259.82 - lr: 0.100000 - momentum: 0.000000</span></span>
<span><span class="co">#&gt; 2024-12-28 16:30:39,621 epoch 2 - iter 36/64 - loss 0.89556786 - time (sec): 4.42 - samples/sec: 260.46 - lr: 0.100000 - momentum: 0.000000</span></span>
<span><span class="co">#&gt; 2024-12-28 16:30:40,313 epoch 2 - iter 42/64 - loss 0.89395156 - time (sec): 5.11 - samples/sec: 262.78 - lr: 0.100000 - momentum: 0.000000</span></span>
<span><span class="co">#&gt; 2024-12-28 16:30:40,986 epoch 2 - iter 48/64 - loss 0.89015336 - time (sec): 5.79 - samples/sec: 265.40 - lr: 0.100000 - momentum: 0.000000</span></span>
<span><span class="co">#&gt; 2024-12-28 16:30:41,836 epoch 2 - iter 54/64 - loss 0.89367774 - time (sec): 6.64 - samples/sec: 260.35 - lr: 0.100000 - momentum: 0.000000</span></span>
<span><span class="co">#&gt; 2024-12-28 16:30:42,520 epoch 2 - iter 60/64 - loss 0.90374267 - time (sec): 7.32 - samples/sec: 262.23 - lr: 0.100000 - momentum: 0.000000</span></span>
<span><span class="co">#&gt; 2024-12-28 16:30:43,007 ----------------------------------------------------------------------------------------------------</span></span>
<span><span class="co">#&gt; 2024-12-28 16:30:43,007 EPOCH 2 done: loss 0.9070 - lr: 0.100000</span></span>
<span><span class="co">#&gt; 2024-12-28 16:30:43,893 DEV : loss 0.7486857771873474 - f1-score (micro avg)  0.5467</span></span>
<span><span class="co">#&gt; 2024-12-28 16:30:44,249  - 0 epochs without improvement</span></span>
<span><span class="co">#&gt; 2024-12-28 16:30:44,251 ----------------------------------------------------------------------------------------------------</span></span>
<span><span class="co">#&gt; 2024-12-28 16:30:45,236 epoch 3 - iter 6/64 - loss 0.92937680 - time (sec): 0.99 - samples/sec: 194.84 - lr: 0.100000 - momentum: 0.000000</span></span>
<span><span class="co">#&gt; 2024-12-28 16:30:45,917 epoch 3 - iter 12/64 - loss 0.86683016 - time (sec): 1.67 - samples/sec: 230.45 - lr: 0.100000 - momentum: 0.000000</span></span>
<span><span class="co">#&gt; 2024-12-28 16:30:46,623 epoch 3 - iter 18/64 - loss 0.88819791 - time (sec): 2.37 - samples/sec: 242.78 - lr: 0.100000 - momentum: 0.000000</span></span>
<span><span class="co">#&gt; 2024-12-28 16:30:47,299 epoch 3 - iter 24/64 - loss 0.88882817 - time (sec): 3.05 - samples/sec: 251.94 - lr: 0.100000 - momentum: 0.000000</span></span>
<span><span class="co">#&gt; 2024-12-28 16:30:48,180 epoch 3 - iter 30/64 - loss 0.86709908 - time (sec): 3.93 - samples/sec: 244.31 - lr: 0.100000 - momentum: 0.000000</span></span>
<span><span class="co">#&gt; 2024-12-28 16:30:48,871 epoch 3 - iter 36/64 - loss 0.85612038 - time (sec): 4.62 - samples/sec: 249.35 - lr: 0.100000 - momentum: 0.000000</span></span>
<span><span class="co">#&gt; 2024-12-28 16:30:49,512 epoch 3 - iter 42/64 - loss 0.84902278 - time (sec): 5.26 - samples/sec: 255.47 - lr: 0.100000 - momentum: 0.000000</span></span>
<span><span class="co">#&gt; 2024-12-28 16:30:50,195 epoch 3 - iter 48/64 - loss 0.84777385 - time (sec): 5.94 - samples/sec: 258.43 - lr: 0.100000 - momentum: 0.000000</span></span>
<span><span class="co">#&gt; 2024-12-28 16:30:51,113 epoch 3 - iter 54/64 - loss 0.84652097 - time (sec): 6.86 - samples/sec: 251.82 - lr: 0.100000 - momentum: 0.000000</span></span>
<span><span class="co">#&gt; 2024-12-28 16:30:51,802 epoch 3 - iter 60/64 - loss 0.85225909 - time (sec): 7.55 - samples/sec: 254.26 - lr: 0.100000 - momentum: 0.000000</span></span>
<span><span class="co">#&gt; 2024-12-28 16:30:52,045 ----------------------------------------------------------------------------------------------------</span></span>
<span><span class="co">#&gt; 2024-12-28 16:30:52,045 EPOCH 3 done: loss 0.8512 - lr: 0.100000</span></span>
<span><span class="co">#&gt; 2024-12-28 16:30:53,122 DEV : loss 0.7488306164741516 - f1-score (micro avg)  0.5511</span></span>
<span><span class="co">#&gt; 2024-12-28 16:30:53,477  - 0 epochs without improvement</span></span>
<span><span class="co">#&gt; 2024-12-28 16:30:53,479 saving best model</span></span>
<span><span class="co">#&gt; 2024-12-28 16:30:53,777 ----------------------------------------------------------------------------------------------------</span></span>
<span><span class="co">#&gt; 2024-12-28 16:30:54,615 epoch 4 - iter 6/64 - loss 0.85672283 - time (sec): 0.84 - samples/sec: 229.41 - lr: 0.100000 - momentum: 0.000000</span></span>
<span><span class="co">#&gt; 2024-12-28 16:30:55,491 epoch 4 - iter 12/64 - loss 0.88262832 - time (sec): 1.71 - samples/sec: 224.13 - lr: 0.100000 - momentum: 0.000000</span></span>
<span><span class="co">#&gt; 2024-12-28 16:30:56,198 epoch 4 - iter 18/64 - loss 0.84319904 - time (sec): 2.42 - samples/sec: 237.97 - lr: 0.100000 - momentum: 0.000000</span></span>
<span><span class="co">#&gt; 2024-12-28 16:30:56,837 epoch 4 - iter 24/64 - loss 0.83780103 - time (sec): 3.06 - samples/sec: 251.07 - lr: 0.100000 - momentum: 0.000000</span></span>
<span><span class="co">#&gt; 2024-12-28 16:30:57,550 epoch 4 - iter 30/64 - loss 0.83947914 - time (sec): 3.77 - samples/sec: 254.47 - lr: 0.100000 - momentum: 0.000000</span></span>
<span><span class="co">#&gt; 2024-12-28 16:30:58,221 epoch 4 - iter 36/64 - loss 0.84127256 - time (sec): 4.44 - samples/sec: 259.25 - lr: 0.100000 - momentum: 0.000000</span></span>
<span><span class="co">#&gt; 2024-12-28 16:30:58,883 epoch 4 - iter 42/64 - loss 0.84066664 - time (sec): 5.11 - samples/sec: 263.26 - lr: 0.100000 - momentum: 0.000000</span></span>
<span><span class="co">#&gt; 2024-12-28 16:30:59,763 epoch 4 - iter 48/64 - loss 0.83932678 - time (sec): 5.99 - samples/sec: 256.61 - lr: 0.100000 - momentum: 0.000000</span></span>
<span><span class="co">#&gt; 2024-12-28 16:31:00,417 epoch 4 - iter 54/64 - loss 0.82937617 - time (sec): 6.64 - samples/sec: 260.26 - lr: 0.100000 - momentum: 0.000000</span></span>
<span><span class="co">#&gt; 2024-12-28 16:31:01,129 epoch 4 - iter 60/64 - loss 0.81899488 - time (sec): 7.35 - samples/sec: 261.18 - lr: 0.100000 - momentum: 0.000000</span></span>
<span><span class="co">#&gt; 2024-12-28 16:31:01,616 ----------------------------------------------------------------------------------------------------</span></span>
<span><span class="co">#&gt; 2024-12-28 16:31:01,617 EPOCH 4 done: loss 0.8121 - lr: 0.100000</span></span>
<span><span class="co">#&gt; 2024-12-28 16:31:02,511 DEV : loss 0.7374546527862549 - f1-score (micro avg)  0.56</span></span>
<span><span class="co">#&gt; 2024-12-28 16:31:03,133  - 0 epochs without improvement</span></span>
<span><span class="co">#&gt; 2024-12-28 16:31:03,136 saving best model</span></span>
<span><span class="co">#&gt; 2024-12-28 16:31:03,409 ----------------------------------------------------------------------------------------------------</span></span>
<span><span class="co">#&gt; 2024-12-28 16:31:04,141 epoch 5 - iter 6/64 - loss 0.79928617 - time (sec): 0.73 - samples/sec: 262.38 - lr: 0.100000 - momentum: 0.000000</span></span>
<span><span class="co">#&gt; 2024-12-28 16:31:04,829 epoch 5 - iter 12/64 - loss 0.83579728 - time (sec): 1.42 - samples/sec: 270.56 - lr: 0.100000 - momentum: 0.000000</span></span>
<span><span class="co">#&gt; 2024-12-28 16:31:05,724 epoch 5 - iter 18/64 - loss 0.84022551 - time (sec): 2.31 - samples/sec: 248.87 - lr: 0.100000 - momentum: 0.000000</span></span>
<span><span class="co">#&gt; 2024-12-28 16:31:06,434 epoch 5 - iter 24/64 - loss 0.84806457 - time (sec): 3.02 - samples/sec: 253.94 - lr: 0.100000 - momentum: 0.000000</span></span>
<span><span class="co">#&gt; 2024-12-28 16:31:07,079 epoch 5 - iter 30/64 - loss 0.83440536 - time (sec): 3.67 - samples/sec: 261.61 - lr: 0.100000 - momentum: 0.000000</span></span>
<span><span class="co">#&gt; 2024-12-28 16:31:07,717 epoch 5 - iter 36/64 - loss 0.82897562 - time (sec): 4.31 - samples/sec: 267.42 - lr: 0.100000 - momentum: 0.000000</span></span>
<span><span class="co">#&gt; 2024-12-28 16:31:08,397 epoch 5 - iter 42/64 - loss 0.82796976 - time (sec): 4.99 - samples/sec: 269.49 - lr: 0.100000 - momentum: 0.000000</span></span>
<span><span class="co">#&gt; 2024-12-28 16:31:09,089 epoch 5 - iter 48/64 - loss 0.82571961 - time (sec): 5.68 - samples/sec: 270.44 - lr: 0.100000 - momentum: 0.000000</span></span>
<span><span class="co">#&gt; 2024-12-28 16:31:10,004 epoch 5 - iter 54/64 - loss 0.81606957 - time (sec): 6.59 - samples/sec: 262.03 - lr: 0.100000 - momentum: 0.000000</span></span>
<span><span class="co">#&gt; 2024-12-28 16:31:10,733 epoch 5 - iter 60/64 - loss 0.81674025 - time (sec): 7.32 - samples/sec: 262.18 - lr: 0.100000 - momentum: 0.000000</span></span>
<span><span class="co">#&gt; 2024-12-28 16:31:11,216 ----------------------------------------------------------------------------------------------------</span></span>
<span><span class="co">#&gt; 2024-12-28 16:31:11,217 EPOCH 5 done: loss 0.8194 - lr: 0.100000</span></span>
<span><span class="co">#&gt; 2024-12-28 16:31:12,103 DEV : loss 0.7368236184120178 - f1-score (micro avg)  0.5556</span></span>
<span><span class="co">#&gt; 2024-12-28 16:31:12,459  - 1 epochs without improvement</span></span>
<span><span class="co">#&gt; 2024-12-28 16:31:12,461 ----------------------------------------------------------------------------------------------------</span></span>
<span><span class="co">#&gt; 2024-12-28 16:31:13,502 epoch 6 - iter 6/64 - loss 0.83813090 - time (sec): 1.04 - samples/sec: 184.51 - lr: 0.100000 - momentum: 0.000000</span></span>
<span><span class="co">#&gt; 2024-12-28 16:31:14,145 epoch 6 - iter 12/64 - loss 0.86620142 - time (sec): 1.68 - samples/sec: 228.06 - lr: 0.100000 - momentum: 0.000000</span></span>
<span><span class="co">#&gt; 2024-12-28 16:31:14,901 epoch 6 - iter 18/64 - loss 0.86076559 - time (sec): 2.44 - samples/sec: 236.12 - lr: 0.100000 - momentum: 0.000000</span></span>
<span><span class="co">#&gt; 2024-12-28 16:31:15,805 epoch 6 - iter 24/64 - loss 0.85938053 - time (sec): 3.34 - samples/sec: 229.64 - lr: 0.100000 - momentum: 0.000000</span></span>
<span><span class="co">#&gt; 2024-12-28 16:31:16,831 epoch 6 - iter 30/64 - loss 0.86251300 - time (sec): 4.37 - samples/sec: 219.66 - lr: 0.100000 - momentum: 0.000000</span></span>
<span><span class="co">#&gt; 2024-12-28 16:31:17,577 epoch 6 - iter 36/64 - loss 0.86272408 - time (sec): 5.12 - samples/sec: 225.18 - lr: 0.100000 - momentum: 0.000000</span></span>
<span><span class="co">#&gt; 2024-12-28 16:31:18,290 epoch 6 - iter 42/64 - loss 0.84527830 - time (sec): 5.83 - samples/sec: 230.56 - lr: 0.100000 - momentum: 0.000000</span></span>
<span><span class="co">#&gt; 2024-12-28 16:31:19,035 epoch 6 - iter 48/64 - loss 0.83892781 - time (sec): 6.57 - samples/sec: 233.64 - lr: 0.100000 - momentum: 0.000000</span></span>
<span><span class="co">#&gt; 2024-12-28 16:31:19,924 epoch 6 - iter 54/64 - loss 0.84780365 - time (sec): 7.46 - samples/sec: 231.53 - lr: 0.100000 - momentum: 0.000000</span></span>
<span><span class="co">#&gt; 2024-12-28 16:31:20,753 epoch 6 - iter 60/64 - loss 0.84297900 - time (sec): 8.29 - samples/sec: 231.54 - lr: 0.100000 - momentum: 0.000000</span></span>
<span><span class="co">#&gt; 2024-12-28 16:31:21,073 ----------------------------------------------------------------------------------------------------</span></span>
<span><span class="co">#&gt; 2024-12-28 16:31:21,073 EPOCH 6 done: loss 0.8407 - lr: 0.100000</span></span>
<span><span class="co">#&gt; 2024-12-28 16:31:22,174 DEV : loss 0.8526976704597473 - f1-score (micro avg)  0.5511</span></span>
<span><span class="co">#&gt; 2024-12-28 16:31:22,529  - 2 epochs without improvement</span></span>
<span><span class="co">#&gt; 2024-12-28 16:31:22,531 ----------------------------------------------------------------------------------------------------</span></span>
<span><span class="co">#&gt; 2024-12-28 16:31:23,569 epoch 7 - iter 6/64 - loss 0.81769504 - time (sec): 1.04 - samples/sec: 185.02 - lr: 0.100000 - momentum: 0.000000</span></span>
<span><span class="co">#&gt; 2024-12-28 16:31:24,260 epoch 7 - iter 12/64 - loss 0.82813701 - time (sec): 1.73 - samples/sec: 222.12 - lr: 0.100000 - momentum: 0.000000</span></span>
<span><span class="co">#&gt; 2024-12-28 16:31:24,939 epoch 7 - iter 18/64 - loss 0.82364116 - time (sec): 2.41 - samples/sec: 239.18 - lr: 0.100000 - momentum: 0.000000</span></span>
<span><span class="co">#&gt; 2024-12-28 16:31:25,686 epoch 7 - iter 24/64 - loss 0.81737228 - time (sec): 3.16 - samples/sec: 243.41 - lr: 0.100000 - momentum: 0.000000</span></span>
<span><span class="co">#&gt; 2024-12-28 16:31:26,507 epoch 7 - iter 30/64 - loss 0.82059191 - time (sec): 3.98 - samples/sec: 241.44 - lr: 0.100000 - momentum: 0.000000</span></span>
<span><span class="co">#&gt; 2024-12-28 16:31:27,483 epoch 7 - iter 36/64 - loss 0.82284810 - time (sec): 4.95 - samples/sec: 232.61 - lr: 0.100000 - momentum: 0.000000</span></span>
<span><span class="co">#&gt; 2024-12-28 16:31:28,200 epoch 7 - iter 42/64 - loss 0.82626161 - time (sec): 5.67 - samples/sec: 237.06 - lr: 0.100000 - momentum: 0.000000</span></span>
<span><span class="co">#&gt; 2024-12-28 16:31:28,933 epoch 7 - iter 48/64 - loss 0.83206440 - time (sec): 6.40 - samples/sec: 239.92 - lr: 0.100000 - momentum: 0.000000</span></span>
<span><span class="co">#&gt; 2024-12-28 16:31:29,835 epoch 7 - iter 54/64 - loss 0.83688665 - time (sec): 7.30 - samples/sec: 236.58 - lr: 0.100000 - momentum: 0.000000</span></span>
<span><span class="co">#&gt; 2024-12-28 16:31:30,447 epoch 7 - iter 60/64 - loss 0.83738772 - time (sec): 7.92 - samples/sec: 242.55 - lr: 0.100000 - momentum: 0.000000</span></span>
<span><span class="co">#&gt; 2024-12-28 16:31:30,741 ----------------------------------------------------------------------------------------------------</span></span>
<span><span class="co">#&gt; 2024-12-28 16:31:30,742 EPOCH 7 done: loss 0.8358 - lr: 0.100000</span></span>
<span><span class="co">#&gt; 2024-12-28 16:31:31,835 DEV : loss 0.8110374808311462 - f1-score (micro avg)  0.56</span></span>
<span><span class="co">#&gt; 2024-12-28 16:31:32,201  - 3 epochs without improvement</span></span>
<span><span class="co">#&gt; 2024-12-28 16:31:32,203 ----------------------------------------------------------------------------------------------------</span></span>
<span><span class="co">#&gt; 2024-12-28 16:31:33,167 epoch 8 - iter 6/64 - loss 0.79496889 - time (sec): 0.96 - samples/sec: 199.19 - lr: 0.100000 - momentum: 0.000000</span></span>
<span><span class="co">#&gt; 2024-12-28 16:31:33,830 epoch 8 - iter 12/64 - loss 0.81114881 - time (sec): 1.63 - samples/sec: 236.08 - lr: 0.100000 - momentum: 0.000000</span></span>
<span><span class="co">#&gt; 2024-12-28 16:31:34,566 epoch 8 - iter 18/64 - loss 0.78787502 - time (sec): 2.36 - samples/sec: 243.82 - lr: 0.100000 - momentum: 0.000000</span></span>
<span><span class="co">#&gt; 2024-12-28 16:31:35,284 epoch 8 - iter 24/64 - loss 0.79731997 - time (sec): 3.08 - samples/sec: 249.29 - lr: 0.100000 - momentum: 0.000000</span></span>
<span><span class="co">#&gt; 2024-12-28 16:31:36,155 epoch 8 - iter 30/64 - loss 0.80225620 - time (sec): 3.95 - samples/sec: 242.93 - lr: 0.100000 - momentum: 0.000000</span></span>
<span><span class="co">#&gt; 2024-12-28 16:31:36,856 epoch 8 - iter 36/64 - loss 0.79820058 - time (sec): 4.65 - samples/sec: 247.58 - lr: 0.100000 - momentum: 0.000000</span></span>
<span><span class="co">#&gt; 2024-12-28 16:31:37,554 epoch 8 - iter 42/64 - loss 0.79679501 - time (sec): 5.35 - samples/sec: 251.18 - lr: 0.100000 - momentum: 0.000000</span></span>
<span><span class="co">#&gt; 2024-12-28 16:31:38,215 epoch 8 - iter 48/64 - loss 0.81604839 - time (sec): 6.01 - samples/sec: 255.49 - lr: 0.100000 - momentum: 0.000000</span></span>
<span><span class="co">#&gt; 2024-12-28 16:31:39,098 epoch 8 - iter 54/64 - loss 0.81042262 - time (sec): 6.89 - samples/sec: 250.63 - lr: 0.100000 - momentum: 0.000000</span></span>
<span><span class="co">#&gt; 2024-12-28 16:31:39,823 epoch 8 - iter 60/64 - loss 0.81269981 - time (sec): 7.62 - samples/sec: 251.97 - lr: 0.100000 - momentum: 0.000000</span></span>
<span><span class="co">#&gt; 2024-12-28 16:31:40,084 ----------------------------------------------------------------------------------------------------</span></span>
<span><span class="co">#&gt; 2024-12-28 16:31:40,084 EPOCH 8 done: loss 0.8169 - lr: 0.100000</span></span>
<span><span class="co">#&gt; 2024-12-28 16:31:41,178 DEV : loss 1.023949384689331 - f1-score (micro avg)  0.4533</span></span>
<span><span class="co">#&gt; 2024-12-28 16:31:41,535  - 4 epochs without improvement (above 'patience')-&gt; annealing learning_rate to [0.05]</span></span>
<span><span class="co">#&gt; 2024-12-28 16:31:41,538 ----------------------------------------------------------------------------------------------------</span></span>
<span><span class="co">#&gt; 2024-12-28 16:31:42,329 epoch 9 - iter 6/64 - loss 0.68596897 - time (sec): 0.79 - samples/sec: 242.74 - lr: 0.050000 - momentum: 0.000000</span></span>
<span><span class="co">#&gt; 2024-12-28 16:31:43,228 epoch 9 - iter 12/64 - loss 0.66148960 - time (sec): 1.69 - samples/sec: 227.13 - lr: 0.050000 - momentum: 0.000000</span></span>
<span><span class="co">#&gt; 2024-12-28 16:31:43,931 epoch 9 - iter 18/64 - loss 0.64727487 - time (sec): 2.39 - samples/sec: 240.71 - lr: 0.050000 - momentum: 0.000000</span></span>
<span><span class="co">#&gt; 2024-12-28 16:31:44,612 epoch 9 - iter 24/64 - loss 0.65436486 - time (sec): 3.07 - samples/sec: 249.78 - lr: 0.050000 - momentum: 0.000000</span></span>
<span><span class="co">#&gt; 2024-12-28 16:31:45,302 epoch 9 - iter 30/64 - loss 0.65239881 - time (sec): 3.76 - samples/sec: 255.02 - lr: 0.050000 - momentum: 0.000000</span></span>
<span><span class="co">#&gt; 2024-12-28 16:31:46,142 epoch 9 - iter 36/64 - loss 0.64659175 - time (sec): 4.60 - samples/sec: 250.21 - lr: 0.050000 - momentum: 0.000000</span></span>
<span><span class="co">#&gt; 2024-12-28 16:31:46,788 epoch 9 - iter 42/64 - loss 0.64547688 - time (sec): 5.25 - samples/sec: 256.00 - lr: 0.050000 - momentum: 0.000000</span></span>
<span><span class="co">#&gt; 2024-12-28 16:31:47,496 epoch 9 - iter 48/64 - loss 0.65022464 - time (sec): 5.96 - samples/sec: 257.81 - lr: 0.050000 - momentum: 0.000000</span></span>
<span><span class="co">#&gt; 2024-12-28 16:31:48,168 epoch 9 - iter 54/64 - loss 0.64447289 - time (sec): 6.63 - samples/sec: 260.64 - lr: 0.050000 - momentum: 0.000000</span></span>
<span><span class="co">#&gt; 2024-12-28 16:31:49,078 epoch 9 - iter 60/64 - loss 0.63616289 - time (sec): 7.54 - samples/sec: 254.65 - lr: 0.050000 - momentum: 0.000000</span></span>
<span><span class="co">#&gt; 2024-12-28 16:31:49,378 ----------------------------------------------------------------------------------------------------</span></span>
<span><span class="co">#&gt; 2024-12-28 16:31:49,378 EPOCH 9 done: loss 0.6390 - lr: 0.050000</span></span>
<span><span class="co">#&gt; 2024-12-28 16:31:50,484 DEV : loss 0.7013777494430542 - f1-score (micro avg)  0.5556</span></span>
<span><span class="co">#&gt; 2024-12-28 16:31:50,845  - 1 epochs without improvement</span></span>
<span><span class="co">#&gt; 2024-12-28 16:31:50,847 ----------------------------------------------------------------------------------------------------</span></span>
<span><span class="co">#&gt; 2024-12-28 16:31:51,697 epoch 10 - iter 6/64 - loss 0.64244384 - time (sec): 0.85 - samples/sec: 225.87 - lr: 0.050000 - momentum: 0.000000</span></span>
<span><span class="co">#&gt; 2024-12-28 16:31:52,610 epoch 10 - iter 12/64 - loss 0.64041568 - time (sec): 1.76 - samples/sec: 217.84 - lr: 0.050000 - momentum: 0.000000</span></span>
<span><span class="co">#&gt; 2024-12-28 16:31:53,287 epoch 10 - iter 18/64 - loss 0.62766657 - time (sec): 2.44 - samples/sec: 236.07 - lr: 0.050000 - momentum: 0.000000</span></span>
<span><span class="co">#&gt; 2024-12-28 16:31:53,968 epoch 10 - iter 24/64 - loss 0.62390758 - time (sec): 3.12 - samples/sec: 246.12 - lr: 0.050000 - momentum: 0.000000</span></span>
<span><span class="co">#&gt; 2024-12-28 16:31:54,679 epoch 10 - iter 30/64 - loss 0.63394908 - time (sec): 3.83 - samples/sec: 250.51 - lr: 0.050000 - momentum: 0.000000</span></span>
<span><span class="co">#&gt; 2024-12-28 16:31:55,589 epoch 10 - iter 36/64 - loss 0.62478027 - time (sec): 4.74 - samples/sec: 242.93 - lr: 0.050000 - momentum: 0.000000</span></span>
<span><span class="co">#&gt; 2024-12-28 16:31:56,273 epoch 10 - iter 42/64 - loss 0.62560765 - time (sec): 5.43 - samples/sec: 247.72 - lr: 0.050000 - momentum: 0.000000</span></span>
<span><span class="co">#&gt; 2024-12-28 16:31:56,914 epoch 10 - iter 48/64 - loss 0.63533741 - time (sec): 6.07 - samples/sec: 253.19 - lr: 0.050000 - momentum: 0.000000</span></span>
<span><span class="co">#&gt; 2024-12-28 16:31:57,585 epoch 10 - iter 54/64 - loss 0.63838921 - time (sec): 6.74 - samples/sec: 256.46 - lr: 0.050000 - momentum: 0.000000</span></span>
<span><span class="co">#&gt; 2024-12-28 16:31:58,255 epoch 10 - iter 60/64 - loss 0.63580510 - time (sec): 7.41 - samples/sec: 259.17 - lr: 0.050000 - momentum: 0.000000</span></span>
<span><span class="co">#&gt; 2024-12-28 16:31:58,749 ----------------------------------------------------------------------------------------------------</span></span>
<span><span class="co">#&gt; 2024-12-28 16:31:58,749 EPOCH 10 done: loss 0.6379 - lr: 0.050000</span></span>
<span><span class="co">#&gt; 2024-12-28 16:31:59,633 DEV : loss 0.5563964247703552 - f1-score (micro avg)  0.72</span></span>
<span><span class="co">#&gt; 2024-12-28 16:32:00,234  - 0 epochs without improvement</span></span>
<span><span class="co">#&gt; 2024-12-28 16:32:00,236 saving best model</span></span>
<span><span class="co">#&gt; 2024-12-28 16:32:00,801 ----------------------------------------------------------------------------------------------------</span></span>
<span><span class="co">#&gt; 2024-12-28 16:32:00,801 Loading model from best epoch ...</span></span>
<span><span class="co">#&gt; 2024-12-28 16:32:02,080 </span></span>
<span><span class="co">#&gt; Results:</span></span>
<span><span class="co">#&gt; - F-score (micro) 0.752</span></span>
<span><span class="co">#&gt; - F-score (macro) 0.7514</span></span>
<span><span class="co">#&gt; - Accuracy 0.752</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; By class:</span></span>
<span><span class="co">#&gt;               precision    recall  f1-score   support</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;     NEGATIVE     0.7092    0.8264    0.7634       121</span></span>
<span><span class="co">#&gt;     POSITIVE     0.8073    0.6822    0.7395       129</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;     accuracy                         0.7520       250</span></span>
<span><span class="co">#&gt;    macro avg     0.7583    0.7543    0.7514       250</span></span>
<span><span class="co">#&gt; weighted avg     0.7598    0.7520    0.7510       250</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; 2024-12-28 16:32:02,081 ----------------------------------------------------------------------------------------------------</span></span>
<span><span class="co">#&gt; $test_score</span></span>
<span><span class="co">#&gt; [1] 0.752</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="loading-and-using-the-classifiers">Loading and Using the Classifiers<a class="anchor" aria-label="anchor" href="#loading-and-using-the-classifiers"></a>
</h3>
<div style="text-align: justify;">
<p>After training the text classification model, the resulting
classifier will already be stored in memory as part of the classifier
variable. It is possible, however, that your Python session exited after
training. If so, you’ll need to load the model into memory with the
following:</p>
</div>
<div class="sourceCode" id="cb64"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">TextClassifier</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/flair_models.html">flair_models</a></span><span class="op">(</span><span class="op">)</span><span class="op">$</span><span class="va">TextClassifier</span></span>
<span><span class="va">classifier</span> <span class="op">&lt;-</span> <span class="va">TextClassifier</span><span class="op">$</span><span class="fu">load</span><span class="op">(</span><span class="st">'classifier/best-model.pt'</span><span class="op">)</span></span></code></pre></div>
<p>We import the Sentence object. Now, we can generate predictions on
some example text inputs.</p>
<div class="sourceCode" id="cb65"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">Sentence</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/flair_data.html">flair_data</a></span><span class="op">(</span><span class="op">)</span><span class="op">$</span><span class="va">Sentence</span></span></code></pre></div>
<div class="sourceCode" id="cb66"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">sentence</span> <span class="op">&lt;-</span> <span class="fu">Sentence</span><span class="op">(</span><span class="st">"great"</span><span class="op">)</span></span>
<span><span class="va">classifier</span><span class="op">$</span><span class="fu">predict</span><span class="op">(</span><span class="va">sentence</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">sentence</span><span class="op">$</span><span class="va">labels</span><span class="op">)</span></span>
<span><span class="co">#&gt; [[1]]</span></span>
<span><span class="co">#&gt; 'Sentence[1]: "great"'/'POSITIVE' (1.0)</span></span></code></pre></div>
<div class="sourceCode" id="cb67"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">sentence</span> <span class="op">&lt;-</span> <span class="fu">Sentence</span><span class="op">(</span><span class="st">"sad"</span><span class="op">)</span></span>
<span><span class="va">classifier</span><span class="op">$</span><span class="fu">predict</span><span class="op">(</span><span class="va">sentence</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">sentence</span><span class="op">$</span><span class="va">labels</span><span class="op">)</span></span>
<span><span class="co">#&gt; [[1]]</span></span>
<span><span class="co">#&gt; 'Sentence[1]: "sad"'/'NEGATIVE' (0.5348)</span></span></code></pre></div>
<hr>
</div>
</div>
<div class="section level2">
<h2 id="training-rnns">Training RNNs<a class="anchor" aria-label="anchor" href="#training-rnns"></a>
</h2>
<div style="text-align: justify;">
<p>Here, we train a sentiment analysis model to categorize text. In this
case, we also include a pipeline that implements the use of Recurrent
Neural Networks (RNN). This makes them particularly effective for tasks
involving sequential data. This section also show you how to implement
one of most powerful features in flaiR, stacked embeddings. You can
stack multiple embeddings with different layers and let the classifier
learn from different types of features. In Flair NLP, and with the
<strong>flaiR</strong> package, it’s very easy to accomplish this
task.</p>
</div>
<div class="section level3">
<h3 id="import-necessary-modules">Import Necessary Modules<a class="anchor" aria-label="anchor" href="#import-necessary-modules"></a>
</h3>
<div class="sourceCode" id="cb68"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://davidycliao.github.io/flaiR">flaiR</a></span><span class="op">)</span></span>
<span><span class="va">WordEmbeddings</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/flair_embeddings.html">flair_embeddings</a></span><span class="op">(</span><span class="op">)</span><span class="op">$</span><span class="va">WordEmbeddings</span></span>
<span><span class="va">FlairEmbeddings</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/flair_embeddings.html">flair_embeddings</a></span><span class="op">(</span><span class="op">)</span><span class="op">$</span><span class="va">FlairEmbeddings</span></span>
<span><span class="va">DocumentRNNEmbeddings</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/flair_embeddings.html">flair_embeddings</a></span><span class="op">(</span><span class="op">)</span><span class="op">$</span><span class="va">DocumentRNNEmbeddings</span></span>
<span><span class="va">TextClassifier</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/flair_models.html">flair_models</a></span><span class="op">(</span><span class="op">)</span><span class="op">$</span><span class="va">TextClassifier</span></span>
<span><span class="va">ModelTrainer</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/flair_trainers.html">flair_trainers</a></span><span class="op">(</span><span class="op">)</span><span class="op">$</span><span class="va">ModelTrainer</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="get-the-imdb-corpus">Get the IMDB Corpus<a class="anchor" aria-label="anchor" href="#get-the-imdb-corpus"></a>
</h3>
<div style="text-align: justify;">
<p>The IMDB movie review dataset is used here, which is a commonly
utilized dataset for sentiment analysis. <code>$downsample(0.1)</code>
method means only 10% of the dataset is used, allowing for a faster
demonstration.</p>
</div>
<div class="sourceCode" id="cb69"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># load the IMDB file and downsize it to 0.1</span></span>
<span><span class="va">IMDB</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/flair_datasets.html">flair_datasets</a></span><span class="op">(</span><span class="op">)</span><span class="op">$</span><span class="va">IMDB</span></span>
<span><span class="va">corpus</span> <span class="op">&lt;-</span> <span class="fu">IMDB</span><span class="op">(</span><span class="op">)</span><span class="op">$</span><span class="fu">downsample</span><span class="op">(</span><span class="fl">0.1</span><span class="op">)</span> </span>
<span><span class="co">#&gt; 2024-12-28 16:32:02,465 Reading data from /Users/yenchiehliao/.flair/datasets/imdb_v4-rebalanced</span></span>
<span><span class="co">#&gt; 2024-12-28 16:32:02,469 Train: /Users/yenchiehliao/.flair/datasets/imdb_v4-rebalanced/train.txt</span></span>
<span><span class="co">#&gt; 2024-12-28 16:32:02,469 Dev: None</span></span>
<span><span class="co">#&gt; 2024-12-28 16:32:02,469 Test: None</span></span>
<span><span class="co">#&gt; 2024-12-28 16:32:02,980 No test split found. Using 10% (i.e. 5000 samples) of the train split as test data</span></span>
<span><span class="co">#&gt; 2024-12-28 16:32:02,993 No dev split found. Using 10% (i.e. 4500 samples) of the train split as dev data</span></span>
<span><span class="co">#&gt; 2024-12-28 16:32:02,993 Initialized corpus /Users/yenchiehliao/.flair/datasets/imdb_v4-rebalanced (label type name is 'sentiment')</span></span>
<span><span class="co"># create the label dictionary</span></span>
<span><span class="va">lbl_type</span> <span class="op">&lt;-</span> <span class="st">'sentiment'</span></span>
<span><span class="va">label_dict</span> <span class="op">&lt;-</span> <span class="va">corpus</span><span class="op">$</span><span class="fu">make_label_dictionary</span><span class="op">(</span>label_type<span class="op">=</span><span class="va">lbl_type</span><span class="op">)</span></span>
<span><span class="co">#&gt; 2024-12-28 16:32:03,006 Computing label dictionary. Progress:</span></span>
<span><span class="co">#&gt; 2024-12-28 16:32:09,396 Dictionary created for label 'sentiment' with 2 values: POSITIVE (seen 2056 times), NEGATIVE (seen 1994 times)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="stacked-embeddings">Stacked Embeddings<a class="anchor" aria-label="anchor" href="#stacked-embeddings"></a>
</h3>
<div style="text-align: justify;">
<p>This is one of Flair’s most powerful features: it allows for the
integration of embeddings to enable the model to learn from more sparse
features. Three types of embeddings are utilized here: GloVe embeddings,
and two types of Flair embeddings (forward and backward). Word
embeddings are used to convert words into vectors.</p>
</div>
<div class="sourceCode" id="cb70"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># make a list of word embeddings</span></span>
<span><span class="va">word_embeddings</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="fu">WordEmbeddings</span><span class="op">(</span><span class="st">'glove'</span><span class="op">)</span>,</span>
<span>                        <span class="fu">FlairEmbeddings</span><span class="op">(</span><span class="st">'news-forward-fast'</span><span class="op">)</span>,</span>
<span>                        <span class="fu">FlairEmbeddings</span><span class="op">(</span><span class="st">'news-backward-fast'</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># initialize the document embeddings</span></span>
<span><span class="va">document_embeddings</span> <span class="op">&lt;-</span> <span class="fu">DocumentRNNEmbeddings</span><span class="op">(</span><span class="va">word_embeddings</span>, </span>
<span>                                             hidden_size <span class="op">=</span> <span class="fl">512L</span>,</span>
<span>                                             reproject_words <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>                                             reproject_words_dimension <span class="op">=</span> <span class="fl">256L</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb71"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># create a Text Classifier with the embeddings and label dictionary</span></span>
<span><span class="va">classifier</span> <span class="op">&lt;-</span> <span class="fu">TextClassifier</span><span class="op">(</span><span class="va">document_embeddings</span>, </span>
<span>                            label_dictionary<span class="op">=</span><span class="va">label_dict</span>, label_type<span class="op">=</span><span class="st">'class'</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># initialize the text classifier trainer with our corpus</span></span>
<span><span class="va">trainer</span> <span class="op">&lt;-</span> <span class="fu">ModelTrainer</span><span class="op">(</span><span class="va">classifier</span>, <span class="va">corpus</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="start-the-training">Start the Training<a class="anchor" aria-label="anchor" href="#start-the-training"></a>
</h3>
<div style="text-align: justify;">
<p>For the sake of this example, setting max_epochs to 5. You might want
to increase this for better performance.</p>
<p>It is worth noting that the learning rate is a parameter that
determines the step size at each iteration while moving towards a
minimum of the loss function. A smaller learning rate could slow down
the learning process, but it could lead to more precise convergence.
<code>mini_batch_size</code> determines the number of samples that will
be used to compute the gradient at each step. The ‘L’ in 32L is used in
R to denote that the number is an integer.</p>
<p><code>patience</code> (aka early stop) is a hyper-parameter used in
conjunction with early stopping to avoid overfitting. It determines the
number of epochs the training process will tolerate without improvements
before stopping the training. Setting max_epochs to 5 means the
algorithm will make five passes through the dataset.</p>
</div>
<div class="sourceCode" id="cb72"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># note: the 'L' in 32L is used in R to denote that the number is an integer.</span></span>
<span><span class="va">trainer</span><span class="op">$</span><span class="fu">train</span><span class="op">(</span><span class="st">'models/sentiment'</span>,</span>
<span>              learning_rate<span class="op">=</span><span class="fl">0.1</span>,</span>
<span>              mini_batch_size<span class="op">=</span><span class="fl">32L</span>,</span>
<span>              patience<span class="op">=</span><span class="fl">5L</span>,</span>
<span>              max_epochs<span class="op">=</span><span class="fl">5L</span><span class="op">)</span>  </span></code></pre></div>
</div>
<div class="section level3">
<h3 id="to-apply-the-trained-model-for-prediction">To Apply the Trained Model for Prediction<a class="anchor" aria-label="anchor" href="#to-apply-the-trained-model-for-prediction"></a>
</h3>
<div class="sourceCode" id="cb73"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">sentence</span> <span class="op">&lt;-</span> <span class="st">"This movie was really exciting!"</span></span>
<span><span class="va">classifier</span><span class="op">$</span><span class="fu">predict</span><span class="op">(</span><span class="va">sentence</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">sentence.labels</span><span class="op">)</span></span></code></pre></div>
<hr>
</div>
</div>
<div class="section level2">
<h2 id="finetune-transformers">Finetune Transformers<a class="anchor" aria-label="anchor" href="#finetune-transformers"></a>
</h2>
<div style="text-align: justify;">
<p>We use data from <em>The Temporal Focus of Campaign Communication
(2020 JOP)</em> as an example. Let’s assume we receive the data for
training from different times. First, suppose you have a dataset of 1000
entries called <code>cc_muller_old</code>. On another day, with the help
of nice friends, you receive another set of data, adding 2000 entries in
a dataset called <code>cc_muller_new</code>. Both subsets are from
<code>data(cc_muller)</code>. We will show how to fine-tune a
transformer model with <code>cc_muller_old</code>, and then continue
with another round of fine-tuning using <code>cc_muller_new</code>.</p>
</div>
<div class="sourceCode" id="cb74"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://davidycliao.github.io/flaiR">flaiR</a></span><span class="op">)</span></span></code></pre></div>
<div class="section level3">
<h3 id="fine-tuning-a-transformers-model">Fine-tuning a Transformers Model<a class="anchor" aria-label="anchor" href="#fine-tuning-a-transformers-model"></a>
</h3>
<p><u><strong>Step 1</strong></u> Load Necessary Modules from Flair</p>
<p>Load necessary classes from <code>flair</code> package.</p>
<div class="sourceCode" id="cb75"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Sentence is a class for holding a text sentence</span></span>
<span><span class="va">Sentence</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/flair_data.html">flair_data</a></span><span class="op">(</span><span class="op">)</span><span class="op">$</span><span class="va">Sentence</span></span>
<span></span>
<span><span class="co"># Corpus is a class for text corpora</span></span>
<span><span class="va">Corpus</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/flair_data.html">flair_data</a></span><span class="op">(</span><span class="op">)</span><span class="op">$</span><span class="va">Corpus</span></span>
<span></span>
<span><span class="co"># TransformerDocumentEmbeddings is a class for loading transformer </span></span>
<span><span class="va">TransformerDocumentEmbeddings</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/flair_embeddings.html">flair_embeddings</a></span><span class="op">(</span><span class="op">)</span><span class="op">$</span><span class="va">TransformerDocumentEmbeddings</span></span>
<span></span>
<span><span class="co"># TextClassifier is a class for text classification</span></span>
<span><span class="va">TextClassifier</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/flair_models.html">flair_models</a></span><span class="op">(</span><span class="op">)</span><span class="op">$</span><span class="va">TextClassifier</span></span>
<span></span>
<span><span class="co"># ModelTrainer is a class for training and evaluating models</span></span>
<span><span class="va">ModelTrainer</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/flair_trainers.html">flair_trainers</a></span><span class="op">(</span><span class="op">)</span><span class="op">$</span><span class="va">ModelTrainer</span></span></code></pre></div>
<div style="text-align: justify;">
<p>We use purrr to help us split sentences using Sentence from
<code><a href="../reference/flair_data.html">flair_data()</a></code>, then use map2 to add labels, and finally use
<code>Corpus</code> to segment the data.</p>
</div>
<div class="sourceCode" id="cb76"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://purrr.tidyverse.org/" class="external-link">purrr</a></span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="va">cc_muller</span><span class="op">)</span></span>
<span><span class="va">cc_muller_old</span> <span class="op">&lt;-</span> <span class="va">cc_muller</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">1000</span>,<span class="op">]</span></span>
<span></span>
<span><span class="va">old_text</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html" class="external-link">map</a></span><span class="op">(</span><span class="va">cc_muller_old</span><span class="op">$</span><span class="va">text</span>, <span class="va">Sentence</span><span class="op">)</span></span>
<span><span class="va">old_labels</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/character.html" class="external-link">as.character</a></span><span class="op">(</span><span class="va">cc_muller_old</span><span class="op">$</span><span class="va">class</span><span class="op">)</span></span>
<span></span>
<span><span class="va">old_text</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://purrr.tidyverse.org/reference/map2.html" class="external-link">map2</a></span><span class="op">(</span><span class="va">old_text</span>, <span class="va">old_labels</span>, <span class="op">~</span> <span class="op">{</span></span>
<span>   </span>
<span>  <span class="va">.x</span><span class="op">$</span><span class="fu">add_label</span><span class="op">(</span><span class="st">"classification"</span>, <span class="va">.y</span><span class="op">)</span></span>
<span>  <span class="va">.x</span></span>
<span><span class="op">}</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb77"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">old_text</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 1000</span></span></code></pre></div>
<div class="sourceCode" id="cb78"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">2046</span><span class="op">)</span></span>
<span><span class="va">sample</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sample.html" class="external-link">sample</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="cn">TRUE</span>, <span class="cn">FALSE</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">old_text</span><span class="op">)</span>, replace<span class="op">=</span><span class="cn">TRUE</span>, prob<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.8</span>, <span class="fl">0.2</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">old_train</span>  <span class="op">&lt;-</span> <span class="va">old_text</span><span class="op">[</span><span class="va">sample</span><span class="op">]</span></span>
<span><span class="va">old_test</span>   <span class="op">&lt;-</span> <span class="va">old_text</span><span class="op">[</span><span class="op">!</span><span class="va">sample</span><span class="op">]</span></span>
<span></span>
<span><span class="va">test_id</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sample.html" class="external-link">sample</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="cn">TRUE</span>, <span class="cn">FALSE</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">old_test</span><span class="op">)</span>, replace<span class="op">=</span><span class="cn">TRUE</span>, prob<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.5</span>, <span class="fl">0.5</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">old_test</span>   <span class="op">&lt;-</span> <span class="va">old_test</span><span class="op">[</span><span class="va">test_id</span><span class="op">]</span></span>
<span><span class="va">old_dev</span>   <span class="op">&lt;-</span> <span class="va">old_test</span><span class="op">[</span><span class="op">!</span><span class="va">test_id</span><span class="op">]</span></span></code></pre></div>
<div style="text-align: justify;">
<p>If you do not provide a development set (dev set) while using Flair,
it will automatically split the training data into training and
development datasets. The test set is used for training the model and
evaluating its final performance, whereas the development set is used
for adjusting model parameters and preventing overfitting, or in other
words, for early stopping of the model.</p>
</div>
<div class="sourceCode" id="cb79"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">old_corpus</span> <span class="op">&lt;-</span> <span class="fu">Corpus</span><span class="op">(</span>train <span class="op">=</span> <span class="va">old_train</span>, test <span class="op">=</span> <span class="va">old_test</span><span class="op">)</span></span>
<span><span class="co">#&gt; 2024-12-28 16:32:11,859 No dev split found. Using 10% (i.e. 80 samples) of the train split as dev data</span></span></code></pre></div>
<p><u><strong>Step 3</strong></u> Load <code>distilbert</code>
Transformer</p>
<div class="sourceCode" id="cb80"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">document_embeddings</span> <span class="op">&lt;-</span> <span class="fu">TransformerDocumentEmbeddings</span><span class="op">(</span><span class="st">'distilbert-base-uncased'</span>, fine_tune<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
<div style="text-align: justify;">
<p>First, the <code>$make_label_dictionary</code> function is used to
automatically create a label dictionary for the classification task. The
label dictionary is a mapping from label to index, which is used to map
the labels to a tensor of label indices. Besides classification tasks,
flaiR also supports other label types for training custom model. From
the cc_muller dataset: Future (seen 423 times), Present (seen 262
times), Past (seen 131 times).</p>
</div>
<div class="sourceCode" id="cb81"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">old_label_dict</span> <span class="op">&lt;-</span> <span class="va">old_corpus</span><span class="op">$</span><span class="fu">make_label_dictionary</span><span class="op">(</span>label_type<span class="op">=</span><span class="st">"classification"</span><span class="op">)</span></span>
<span><span class="co">#&gt; 2024-12-28 16:32:12,999 Computing label dictionary. Progress:</span></span>
<span><span class="co">#&gt; 2024-12-28 16:32:13,004 Dictionary created for label 'classification' with 3 values: Future (seen 380 times), Present (seen 232 times), Past (seen 111 times)</span></span></code></pre></div>
<div style="text-align: justify;">
<p><code>TextClassifier</code> is used to create a text classifier. The
classifier takes the document embeddings (importing from
<code>'distilbert-base-uncased'</code> from Hugging Face) and the label
dictionary as input. The label type is also specified as
classification.</p>
</div>
<div class="sourceCode" id="cb82"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">old_classifier</span> <span class="op">&lt;-</span> <span class="fu">TextClassifier</span><span class="op">(</span><span class="va">document_embeddings</span>,</span>
<span>                                 label_dictionary <span class="op">=</span> <span class="va">old_label_dict</span>, </span>
<span>                                 label_type<span class="op">=</span><span class="st">'classification'</span><span class="op">)</span></span></code></pre></div>
<p><u><strong>Step 4</strong></u> Start Training</p>
<p><code>ModelTrainer</code> is used to train the model.</p>
<div class="sourceCode" id="cb83"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">old_trainer</span> <span class="op">&lt;-</span> <span class="fu">ModelTrainer</span><span class="op">(</span>model <span class="op">=</span> <span class="va">old_classifier</span>, corpus <span class="op">=</span> <span class="va">old_corpus</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb84"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">old_trainer</span><span class="op">$</span><span class="fu">train</span><span class="op">(</span><span class="st">"vignettes/inst/muller-campaign-communication"</span>,  </span>
<span>                  learning_rate<span class="op">=</span><span class="fl">0.02</span>,              </span>
<span>                  mini_batch_size<span class="op">=</span><span class="fl">8L</span>,              </span>
<span>                  anneal_with_restarts <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>                  save_final_model<span class="op">=</span><span class="cn">TRUE</span>,</span>
<span>                  max_epochs<span class="op">=</span><span class="fl">1L</span><span class="op">)</span>   </span>
<span><span class="co">#&gt; 2024-12-28 16:32:13,287 ----------------------------------------------------------------------------------------------------</span></span>
<span><span class="co">#&gt; 2024-12-28 16:32:13,288 Model: "TextClassifier(</span></span>
<span><span class="co">#&gt;   (embeddings): TransformerDocumentEmbeddings(</span></span>
<span><span class="co">#&gt;     (model): DistilBertModel(</span></span>
<span><span class="co">#&gt;       (embeddings): Embeddings(</span></span>
<span><span class="co">#&gt;         (word_embeddings): Embedding(30523, 768, padding_idx=0)</span></span>
<span><span class="co">#&gt;         (position_embeddings): Embedding(512, 768)</span></span>
<span><span class="co">#&gt;         (LayerNorm): LayerNorm((768,), eps=1e-12, elementwise_affine=True)</span></span>
<span><span class="co">#&gt;         (dropout): Dropout(p=0.1, inplace=False)</span></span>
<span><span class="co">#&gt;       )</span></span>
<span><span class="co">#&gt;       (transformer): Transformer(</span></span>
<span><span class="co">#&gt;         (layer): ModuleList(</span></span>
<span><span class="co">#&gt;           (0-5): 6 x TransformerBlock(</span></span>
<span><span class="co">#&gt;             (attention): MultiHeadSelfAttention(</span></span>
<span><span class="co">#&gt;               (dropout): Dropout(p=0.1, inplace=False)</span></span>
<span><span class="co">#&gt;               (q_lin): Linear(in_features=768, out_features=768, bias=True)</span></span>
<span><span class="co">#&gt;               (k_lin): Linear(in_features=768, out_features=768, bias=True)</span></span>
<span><span class="co">#&gt;               (v_lin): Linear(in_features=768, out_features=768, bias=True)</span></span>
<span><span class="co">#&gt;               (out_lin): Linear(in_features=768, out_features=768, bias=True)</span></span>
<span><span class="co">#&gt;             )</span></span>
<span><span class="co">#&gt;             (sa_layer_norm): LayerNorm((768,), eps=1e-12, elementwise_affine=True)</span></span>
<span><span class="co">#&gt;             (ffn): FFN(</span></span>
<span><span class="co">#&gt;               (dropout): Dropout(p=0.1, inplace=False)</span></span>
<span><span class="co">#&gt;               (lin1): Linear(in_features=768, out_features=3072, bias=True)</span></span>
<span><span class="co">#&gt;               (lin2): Linear(in_features=3072, out_features=768, bias=True)</span></span>
<span><span class="co">#&gt;               (activation): GELUActivation()</span></span>
<span><span class="co">#&gt;             )</span></span>
<span><span class="co">#&gt;             (output_layer_norm): LayerNorm((768,), eps=1e-12, elementwise_affine=True)</span></span>
<span><span class="co">#&gt;           )</span></span>
<span><span class="co">#&gt;         )</span></span>
<span><span class="co">#&gt;       )</span></span>
<span><span class="co">#&gt;     )</span></span>
<span><span class="co">#&gt;   )</span></span>
<span><span class="co">#&gt;   (decoder): Linear(in_features=768, out_features=3, bias=True)</span></span>
<span><span class="co">#&gt;   (dropout): Dropout(p=0.0, inplace=False)</span></span>
<span><span class="co">#&gt;   (locked_dropout): LockedDropout(p=0.0)</span></span>
<span><span class="co">#&gt;   (word_dropout): WordDropout(p=0.0)</span></span>
<span><span class="co">#&gt;   (loss_function): CrossEntropyLoss()</span></span>
<span><span class="co">#&gt;   (weights): None</span></span>
<span><span class="co">#&gt;   (weight_tensor) None</span></span>
<span><span class="co">#&gt; )"</span></span>
<span><span class="co">#&gt; 2024-12-28 16:32:13,288 ----------------------------------------------------------------------------------------------------</span></span>
<span><span class="co">#&gt; 2024-12-28 16:32:13,288 Corpus: 723 train + 80 dev + 85 test sentences</span></span>
<span><span class="co">#&gt; 2024-12-28 16:32:13,288 ----------------------------------------------------------------------------------------------------</span></span>
<span><span class="co">#&gt; 2024-12-28 16:32:13,288 Train:  723 sentences</span></span>
<span><span class="co">#&gt; 2024-12-28 16:32:13,288         (train_with_dev=False, train_with_test=False)</span></span>
<span><span class="co">#&gt; 2024-12-28 16:32:13,288 ----------------------------------------------------------------------------------------------------</span></span>
<span><span class="co">#&gt; 2024-12-28 16:32:13,288 Training Params:</span></span>
<span><span class="co">#&gt; 2024-12-28 16:32:13,288  - learning_rate: "0.02" </span></span>
<span><span class="co">#&gt; 2024-12-28 16:32:13,288  - mini_batch_size: "8"</span></span>
<span><span class="co">#&gt; 2024-12-28 16:32:13,288  - max_epochs: "1"</span></span>
<span><span class="co">#&gt; 2024-12-28 16:32:13,288  - shuffle: "True"</span></span>
<span><span class="co">#&gt; 2024-12-28 16:32:13,288 ----------------------------------------------------------------------------------------------------</span></span>
<span><span class="co">#&gt; 2024-12-28 16:32:13,288 Plugins:</span></span>
<span><span class="co">#&gt; 2024-12-28 16:32:13,288  - AnnealOnPlateau | patience: '3', anneal_factor: '0.5', min_learning_rate: '0.0001'</span></span>
<span><span class="co">#&gt; 2024-12-28 16:32:13,288 ----------------------------------------------------------------------------------------------------</span></span>
<span><span class="co">#&gt; 2024-12-28 16:32:13,288 Final evaluation on model from best epoch (best-model.pt)</span></span>
<span><span class="co">#&gt; 2024-12-28 16:32:13,288  - metric: "('micro avg', 'f1-score')"</span></span>
<span><span class="co">#&gt; 2024-12-28 16:32:13,288 ----------------------------------------------------------------------------------------------------</span></span>
<span><span class="co">#&gt; 2024-12-28 16:32:13,288 Computation:</span></span>
<span><span class="co">#&gt; 2024-12-28 16:32:13,288  - compute on device: cpu</span></span>
<span><span class="co">#&gt; 2024-12-28 16:32:13,288  - embedding storage: cpu</span></span>
<span><span class="co">#&gt; 2024-12-28 16:32:13,289 ----------------------------------------------------------------------------------------------------</span></span>
<span><span class="co">#&gt; 2024-12-28 16:32:13,289 Model training base path: "vignettes/inst/muller-campaign-communication"</span></span>
<span><span class="co">#&gt; 2024-12-28 16:32:13,289 ----------------------------------------------------------------------------------------------------</span></span>
<span><span class="co">#&gt; 2024-12-28 16:32:13,289 ----------------------------------------------------------------------------------------------------</span></span>
<span><span class="co">#&gt; 2024-12-28 16:32:15,733 epoch 1 - iter 9/91 - loss 1.18762477 - time (sec): 2.44 - samples/sec: 29.45 - lr: 0.020000 - momentum: 0.000000</span></span>
<span><span class="co">#&gt; 2024-12-28 16:32:18,028 epoch 1 - iter 18/91 - loss 1.09695290 - time (sec): 4.74 - samples/sec: 30.39 - lr: 0.020000 - momentum: 0.000000</span></span>
<span><span class="co">#&gt; 2024-12-28 16:32:20,349 epoch 1 - iter 27/91 - loss 0.99738498 - time (sec): 7.06 - samples/sec: 30.59 - lr: 0.020000 - momentum: 0.000000</span></span>
<span><span class="co">#&gt; 2024-12-28 16:32:22,431 epoch 1 - iter 36/91 - loss 0.94192335 - time (sec): 9.14 - samples/sec: 31.50 - lr: 0.020000 - momentum: 0.000000</span></span>
<span><span class="co">#&gt; 2024-12-28 16:32:24,706 epoch 1 - iter 45/91 - loss 0.88902943 - time (sec): 11.42 - samples/sec: 31.53 - lr: 0.020000 - momentum: 0.000000</span></span>
<span><span class="co">#&gt; 2024-12-28 16:32:26,935 epoch 1 - iter 54/91 - loss 0.84326868 - time (sec): 13.65 - samples/sec: 31.66 - lr: 0.020000 - momentum: 0.000000</span></span>
<span><span class="co">#&gt; 2024-12-28 16:32:29,162 epoch 1 - iter 63/91 - loss 0.78394446 - time (sec): 15.87 - samples/sec: 31.75 - lr: 0.020000 - momentum: 0.000000</span></span>
<span><span class="co">#&gt; 2024-12-28 16:32:31,701 epoch 1 - iter 72/91 - loss 0.75516539 - time (sec): 18.41 - samples/sec: 31.28 - lr: 0.020000 - momentum: 0.000000</span></span>
<span><span class="co">#&gt; 2024-12-28 16:32:34,055 epoch 1 - iter 81/91 - loss 0.74843798 - time (sec): 20.77 - samples/sec: 31.20 - lr: 0.020000 - momentum: 0.000000</span></span>
<span><span class="co">#&gt; 2024-12-28 16:32:36,324 epoch 1 - iter 90/91 - loss 0.74523400 - time (sec): 23.04 - samples/sec: 31.26 - lr: 0.020000 - momentum: 0.000000</span></span>
<span><span class="co">#&gt; 2024-12-28 16:32:36,439 ----------------------------------------------------------------------------------------------------</span></span>
<span><span class="co">#&gt; 2024-12-28 16:32:36,440 EPOCH 1 done: loss 0.7438 - lr: 0.020000</span></span>
<span><span class="co">#&gt; 2024-12-28 16:32:37,310 DEV : loss 0.48006948828697205 - f1-score (micro avg)  0.8125</span></span>
<span><span class="co">#&gt; 2024-12-28 16:32:37,311  - 0 epochs without improvement</span></span>
<span><span class="co">#&gt; 2024-12-28 16:32:37,312 saving best model</span></span>
<span><span class="co">#&gt; 2024-12-28 16:32:37,970 ----------------------------------------------------------------------------------------------------</span></span>
<span><span class="co">#&gt; 2024-12-28 16:32:37,971 Loading model from best epoch ...</span></span>
<span><span class="co">#&gt; 2024-12-28 16:32:40,040 </span></span>
<span><span class="co">#&gt; Results:</span></span>
<span><span class="co">#&gt; - F-score (micro) 0.7765</span></span>
<span><span class="co">#&gt; - F-score (macro) 0.8071</span></span>
<span><span class="co">#&gt; - Accuracy 0.7765</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; By class:</span></span>
<span><span class="co">#&gt;               precision    recall  f1-score   support</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;       Future     0.9310    0.6279    0.7500        43</span></span>
<span><span class="co">#&gt;      Present     0.6047    0.9630    0.7429        27</span></span>
<span><span class="co">#&gt;         Past     1.0000    0.8667    0.9286        15</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;     accuracy                         0.7765        85</span></span>
<span><span class="co">#&gt;    macro avg     0.8452    0.8192    0.8071        85</span></span>
<span><span class="co">#&gt; weighted avg     0.8395    0.7765    0.7792        85</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; 2024-12-28 16:32:40,040 ----------------------------------------------------------------------------------------------------</span></span>
<span><span class="co">#&gt; $test_score</span></span>
<span><span class="co">#&gt; [1] 0.7764706</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="continue-fine-tuning-with-new-dataset">Continue Fine-tuning with New Dataset<a class="anchor" aria-label="anchor" href="#continue-fine-tuning-with-new-dataset"></a>
</h3>
<div style="text-align: justify;">
<p>Now, we can continue to fine tune the already fine tuned model with
an additional 2000 pieces of data. First, let’s say we have another 2000
entries called <code>cc_muller_new</code>. We can fine-tune the previous
model with these 2000 entries. The steps are the same as before. For
this case, we don’t need to split the dataset again. We can use the
entire 2000 entries as the training set and use the
<code>old_test</code> set to evaluate how well our refined model
performs.</p>
</div>
<p><u><strong>Step 1</strong></u> Load the
<code>muller-campaign-communication</code> Model</p>
<p>Load the model (<code>old_model</code>) you have already fine tuned
from previous stage and let’s fine tune it with the new data,
<code>new_corpus</code>.</p>
<div class="sourceCode" id="cb85"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">old_model</span> <span class="op">&lt;-</span> <span class="va">TextClassifier</span><span class="op">$</span><span class="fu">load</span><span class="op">(</span><span class="st">"vignettes/inst/muller-campaign-communication/best-model.pt"</span><span class="op">)</span></span></code></pre></div>
<p><u><strong>Step 2</strong></u> Convert the New Data to Sentence and
Corpus</p>
<div class="sourceCode" id="cb86"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://purrr.tidyverse.org/" class="external-link">purrr</a></span><span class="op">)</span></span>
<span><span class="va">cc_muller_new</span> <span class="op">&lt;-</span> <span class="va">cc_muller</span><span class="op">[</span><span class="fl">1001</span><span class="op">:</span><span class="fl">3000</span>,<span class="op">]</span></span>
<span><span class="va">new_text</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html" class="external-link">map</a></span><span class="op">(</span><span class="va">cc_muller_new</span><span class="op">$</span><span class="va">text</span>, <span class="va">Sentence</span><span class="op">)</span></span>
<span><span class="va">new_labels</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/character.html" class="external-link">as.character</a></span><span class="op">(</span><span class="va">cc_muller_new</span><span class="op">$</span><span class="va">class</span><span class="op">)</span></span>
<span></span>
<span><span class="va">new_text</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://purrr.tidyverse.org/reference/map2.html" class="external-link">map2</a></span><span class="op">(</span><span class="va">new_text</span>, <span class="va">new_labels</span>, <span class="op">~</span> <span class="op">{</span></span>
<span>  <span class="va">.x</span><span class="op">$</span><span class="fu">add_label</span><span class="op">(</span><span class="st">"classification"</span>, <span class="va">.y</span><span class="op">)</span></span>
<span>  <span class="va">.x</span></span>
<span><span class="op">}</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb87"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">new_corpus</span> <span class="op">&lt;-</span> <span class="fu">Corpus</span><span class="op">(</span>train<span class="op">=</span><span class="va">new_text</span>, test<span class="op">=</span><span class="va">old_test</span><span class="op">)</span></span>
<span><span class="co">#&gt; 2024-12-28 16:32:41,506 No dev split found. Using 10% (i.e. 200 samples) of the train split as dev data</span></span></code></pre></div>
<p><u><strong>Step 3</strong></u> Create a New Model Trainer with the
Old Model and New Corpus</p>
<div class="sourceCode" id="cb88"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">new_trainer</span> <span class="op">&lt;-</span> <span class="fu">ModelTrainer</span><span class="op">(</span><span class="va">old_model</span>, <span class="va">new_corpus</span><span class="op">)</span></span></code></pre></div>
<p><u><strong>Step 4</strong></u> Train the New Model</p>
<div class="sourceCode" id="cb89"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">new_trainer</span><span class="op">$</span><span class="fu">train</span><span class="op">(</span><span class="st">"vignettes/inst/new-muller-campaign-communication"</span>,</span>
<span>                  learning_rate<span class="op">=</span><span class="fl">0.002</span>, </span>
<span>                  mini_batch_size<span class="op">=</span><span class="fl">8L</span>,  </span>
<span>                  max_epochs<span class="op">=</span><span class="fl">1L</span><span class="op">)</span>    </span>
<span><span class="co">#&gt; 2024-12-28 16:32:41,589 ----------------------------------------------------------------------------------------------------</span></span>
<span><span class="co">#&gt; 2024-12-28 16:32:41,590 Model: "TextClassifier(</span></span>
<span><span class="co">#&gt;   (embeddings): TransformerDocumentEmbeddings(</span></span>
<span><span class="co">#&gt;     (model): DistilBertModel(</span></span>
<span><span class="co">#&gt;       (embeddings): Embeddings(</span></span>
<span><span class="co">#&gt;         (word_embeddings): Embedding(30523, 768, padding_idx=0)</span></span>
<span><span class="co">#&gt;         (position_embeddings): Embedding(512, 768)</span></span>
<span><span class="co">#&gt;         (LayerNorm): LayerNorm((768,), eps=1e-12, elementwise_affine=True)</span></span>
<span><span class="co">#&gt;         (dropout): Dropout(p=0.1, inplace=False)</span></span>
<span><span class="co">#&gt;       )</span></span>
<span><span class="co">#&gt;       (transformer): Transformer(</span></span>
<span><span class="co">#&gt;         (layer): ModuleList(</span></span>
<span><span class="co">#&gt;           (0-5): 6 x TransformerBlock(</span></span>
<span><span class="co">#&gt;             (attention): MultiHeadSelfAttention(</span></span>
<span><span class="co">#&gt;               (dropout): Dropout(p=0.1, inplace=False)</span></span>
<span><span class="co">#&gt;               (q_lin): Linear(in_features=768, out_features=768, bias=True)</span></span>
<span><span class="co">#&gt;               (k_lin): Linear(in_features=768, out_features=768, bias=True)</span></span>
<span><span class="co">#&gt;               (v_lin): Linear(in_features=768, out_features=768, bias=True)</span></span>
<span><span class="co">#&gt;               (out_lin): Linear(in_features=768, out_features=768, bias=True)</span></span>
<span><span class="co">#&gt;             )</span></span>
<span><span class="co">#&gt;             (sa_layer_norm): LayerNorm((768,), eps=1e-12, elementwise_affine=True)</span></span>
<span><span class="co">#&gt;             (ffn): FFN(</span></span>
<span><span class="co">#&gt;               (dropout): Dropout(p=0.1, inplace=False)</span></span>
<span><span class="co">#&gt;               (lin1): Linear(in_features=768, out_features=3072, bias=True)</span></span>
<span><span class="co">#&gt;               (lin2): Linear(in_features=3072, out_features=768, bias=True)</span></span>
<span><span class="co">#&gt;               (activation): GELUActivation()</span></span>
<span><span class="co">#&gt;             )</span></span>
<span><span class="co">#&gt;             (output_layer_norm): LayerNorm((768,), eps=1e-12, elementwise_affine=True)</span></span>
<span><span class="co">#&gt;           )</span></span>
<span><span class="co">#&gt;         )</span></span>
<span><span class="co">#&gt;       )</span></span>
<span><span class="co">#&gt;     )</span></span>
<span><span class="co">#&gt;   )</span></span>
<span><span class="co">#&gt;   (decoder): Linear(in_features=768, out_features=3, bias=True)</span></span>
<span><span class="co">#&gt;   (dropout): Dropout(p=0.0, inplace=False)</span></span>
<span><span class="co">#&gt;   (locked_dropout): LockedDropout(p=0.0)</span></span>
<span><span class="co">#&gt;   (word_dropout): WordDropout(p=0.0)</span></span>
<span><span class="co">#&gt;   (loss_function): CrossEntropyLoss()</span></span>
<span><span class="co">#&gt;   (weights): None</span></span>
<span><span class="co">#&gt;   (weight_tensor) None</span></span>
<span><span class="co">#&gt; )"</span></span>
<span><span class="co">#&gt; 2024-12-28 16:32:41,590 ----------------------------------------------------------------------------------------------------</span></span>
<span><span class="co">#&gt; 2024-12-28 16:32:41,590 Corpus: 1800 train + 200 dev + 85 test sentences</span></span>
<span><span class="co">#&gt; 2024-12-28 16:32:41,590 ----------------------------------------------------------------------------------------------------</span></span>
<span><span class="co">#&gt; 2024-12-28 16:32:41,591 Train:  1800 sentences</span></span>
<span><span class="co">#&gt; 2024-12-28 16:32:41,591         (train_with_dev=False, train_with_test=False)</span></span>
<span><span class="co">#&gt; 2024-12-28 16:32:41,591 ----------------------------------------------------------------------------------------------------</span></span>
<span><span class="co">#&gt; 2024-12-28 16:32:41,591 Training Params:</span></span>
<span><span class="co">#&gt; 2024-12-28 16:32:41,591  - learning_rate: "0.002" </span></span>
<span><span class="co">#&gt; 2024-12-28 16:32:41,591  - mini_batch_size: "8"</span></span>
<span><span class="co">#&gt; 2024-12-28 16:32:41,591  - max_epochs: "1"</span></span>
<span><span class="co">#&gt; 2024-12-28 16:32:41,591  - shuffle: "True"</span></span>
<span><span class="co">#&gt; 2024-12-28 16:32:41,591 ----------------------------------------------------------------------------------------------------</span></span>
<span><span class="co">#&gt; 2024-12-28 16:32:41,591 Plugins:</span></span>
<span><span class="co">#&gt; 2024-12-28 16:32:41,591  - AnnealOnPlateau | patience: '3', anneal_factor: '0.5', min_learning_rate: '0.0001'</span></span>
<span><span class="co">#&gt; 2024-12-28 16:32:41,591 ----------------------------------------------------------------------------------------------------</span></span>
<span><span class="co">#&gt; 2024-12-28 16:32:41,591 Final evaluation on model from best epoch (best-model.pt)</span></span>
<span><span class="co">#&gt; 2024-12-28 16:32:41,591  - metric: "('micro avg', 'f1-score')"</span></span>
<span><span class="co">#&gt; 2024-12-28 16:32:41,591 ----------------------------------------------------------------------------------------------------</span></span>
<span><span class="co">#&gt; 2024-12-28 16:32:41,591 Computation:</span></span>
<span><span class="co">#&gt; 2024-12-28 16:32:41,591  - compute on device: cpu</span></span>
<span><span class="co">#&gt; 2024-12-28 16:32:41,591  - embedding storage: cpu</span></span>
<span><span class="co">#&gt; 2024-12-28 16:32:41,591 ----------------------------------------------------------------------------------------------------</span></span>
<span><span class="co">#&gt; 2024-12-28 16:32:41,600 Model training base path: "vignettes/inst/new-muller-campaign-communication"</span></span>
<span><span class="co">#&gt; 2024-12-28 16:32:41,601 ----------------------------------------------------------------------------------------------------</span></span>
<span><span class="co">#&gt; 2024-12-28 16:32:41,601 ----------------------------------------------------------------------------------------------------</span></span>
<span><span class="co">#&gt; 2024-12-28 16:32:47,712 epoch 1 - iter 22/225 - loss 0.35835030 - time (sec): 6.11 - samples/sec: 28.80 - lr: 0.002000 - momentum: 0.000000</span></span>
<span><span class="co">#&gt; 2024-12-28 16:32:53,308 epoch 1 - iter 44/225 - loss 0.36694252 - time (sec): 11.71 - samples/sec: 30.07 - lr: 0.002000 - momentum: 0.000000</span></span>
<span><span class="co">#&gt; 2024-12-28 16:32:58,940 epoch 1 - iter 66/225 - loss 0.41839106 - time (sec): 17.34 - samples/sec: 30.45 - lr: 0.002000 - momentum: 0.000000</span></span>
<span><span class="co">#&gt; 2024-12-28 16:33:04,479 epoch 1 - iter 88/225 - loss 0.40447060 - time (sec): 22.88 - samples/sec: 30.77 - lr: 0.002000 - momentum: 0.000000</span></span>
<span><span class="co">#&gt; 2024-12-28 16:33:10,410 epoch 1 - iter 110/225 - loss 0.37927674 - time (sec): 28.81 - samples/sec: 30.55 - lr: 0.002000 - momentum: 0.000000</span></span>
<span><span class="co">#&gt; 2024-12-28 16:33:16,860 epoch 1 - iter 132/225 - loss 0.37781600 - time (sec): 35.26 - samples/sec: 29.95 - lr: 0.002000 - momentum: 0.000000</span></span>
<span><span class="co">#&gt; 2024-12-28 16:33:22,578 epoch 1 - iter 154/225 - loss 0.38130228 - time (sec): 40.98 - samples/sec: 30.07 - lr: 0.002000 - momentum: 0.000000</span></span>
<span><span class="co">#&gt; 2024-12-28 16:33:29,594 epoch 1 - iter 176/225 - loss 0.37322175 - time (sec): 47.99 - samples/sec: 29.34 - lr: 0.002000 - momentum: 0.000000</span></span>
<span><span class="co">#&gt; 2024-12-28 16:33:35,075 epoch 1 - iter 198/225 - loss 0.37087017 - time (sec): 53.47 - samples/sec: 29.62 - lr: 0.002000 - momentum: 0.000000</span></span>
<span><span class="co">#&gt; 2024-12-28 16:33:40,407 epoch 1 - iter 220/225 - loss 0.37474458 - time (sec): 58.81 - samples/sec: 29.93 - lr: 0.002000 - momentum: 0.000000</span></span>
<span><span class="co">#&gt; 2024-12-28 16:33:41,750 ----------------------------------------------------------------------------------------------------</span></span>
<span><span class="co">#&gt; 2024-12-28 16:33:41,750 EPOCH 1 done: loss 0.3733 - lr: 0.002000</span></span>
<span><span class="co">#&gt; 2024-12-28 16:33:44,121 DEV : loss 0.38437068462371826 - f1-score (micro avg)  0.87</span></span>
<span><span class="co">#&gt; 2024-12-28 16:33:44,124  - 0 epochs without improvement</span></span>
<span><span class="co">#&gt; 2024-12-28 16:33:44,126 saving best model</span></span>
<span><span class="co">#&gt; 2024-12-28 16:33:44,802 ----------------------------------------------------------------------------------------------------</span></span>
<span><span class="co">#&gt; 2024-12-28 16:33:44,806 Loading model from best epoch ...</span></span>
<span><span class="co">#&gt; 2024-12-28 16:33:46,850 </span></span>
<span><span class="co">#&gt; Results:</span></span>
<span><span class="co">#&gt; - F-score (micro) 0.8588</span></span>
<span><span class="co">#&gt; - F-score (macro) 0.8674</span></span>
<span><span class="co">#&gt; - Accuracy 0.8588</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; By class:</span></span>
<span><span class="co">#&gt;               precision    recall  f1-score   support</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;       Future     0.8636    0.8837    0.8736        43</span></span>
<span><span class="co">#&gt;      Present     0.7857    0.8148    0.8000        27</span></span>
<span><span class="co">#&gt;         Past     1.0000    0.8667    0.9286        15</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;     accuracy                         0.8588        85</span></span>
<span><span class="co">#&gt;    macro avg     0.8831    0.8551    0.8674        85</span></span>
<span><span class="co">#&gt; weighted avg     0.8629    0.8588    0.8599        85</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; 2024-12-28 16:33:46,850 ----------------------------------------------------------------------------------------------------</span></span>
<span><span class="co">#&gt; $test_score</span></span>
<span><span class="co">#&gt; [1] 0.8588235</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="model-performance-metrics-pre-and-post-fine-tuning">Model Performance Metrics: Pre and Post Fine-tuning<a class="anchor" aria-label="anchor" href="#model-performance-metrics-pre-and-post-fine-tuning"></a>
</h3>
<p>After fine-tuning for 1 epoch, the model showed improved performance
on the same test set.</p>
<table class="table">
<thead><tr class="header">
<th>Evaluation Metric</th>
<th>Pre-finetune</th>
<th>Post-finetune</th>
<th>Improvement</th>
</tr></thead>
<tbody>
<tr class="odd">
<td>F-score (micro)</td>
<td>0.7294</td>
<td>0.8471</td>
<td>+0.1177</td>
</tr>
<tr class="even">
<td>F-score (macro)</td>
<td>0.7689</td>
<td>0.8583</td>
<td>+0.0894</td>
</tr>
<tr class="odd">
<td>Accuracy</td>
<td>0.7294</td>
<td>0.8471</td>
<td>+0.1177</td>
</tr>
</tbody>
</table>
<p>More R tutorial and documentation see <a href="https://github.com/davidycliao/flaiR" class="external-link">here</a>.</p>
<hr>
</div>
</div>
<div class="section level2">
<h2 id="extending-contexts-embedding-regression">Extending conText’s Embedding Regression<a class="anchor" aria-label="anchor" href="#extending-contexts-embedding-regression"></a>
</h2>
<div style="text-align: justify;">
<p><code>ConText</code> is a fast, flexible, and transparent framework
for estimating context-specific word and short document embeddings using
<a href="https://github.com/prodriguezsosa/EmbeddingRegression" class="external-link">the ‘a
la carte’ embeddings regression</a>, implemented by Rodriguez et al.</p>
<p>In this case study, I’ll demonstrate how to use the conText package
alongside other embedding frameworks by working through the example
provided in Rodriguez et al.’s <a href="https://github.com/prodriguezsosa/conText/blob/master/vignettes/quickstart.md" class="external-link">Quick
Start Guide</a>. While ConText includes its own cross-lingual ALC
Embeddings, this tutorial extends its capabilities by integrating it
with flaiR. Through this tutorial integration, this tutorial shows how
to:</p>
</div>
<ul>
<li><p>Access flaiR’s powerful embedding models</p></li>
<li><p>Connect with any transformer-based embedding models from
HuggingFace via FlaiR</p></li>
</ul>
<div style="text-align: justify;">
<p>I’ll be following the example directly from <a href="">Rodriguez et
al.’s Quick Start Guide</a> as this case study. It’s important to note
that results obtained using alternative embedding frameworks may deviate
from the original implementation, and should be interpreted with
caution. These comparative results are primarily intended for reference
and educational use.</p>
<p>First of all, when loading the conText package, you’ll find three
pre-loaded datasets: <code>cr_sample_corpus</code>,
<code>cr_glove_subset</code>, and <code>cr_transform.</code> These
datasets are used in the package’s tutorial to demonstrate preprocessing
steps. For this exercise, I’ll use <code>cr_sample_corpus</code> to
explore other embedding frameworks, including:</p>
</div>
<ul>
<li><p><code>en-crawl</code> embedding</p></li>
<li><p>Flair NLP contextual embeddings (as described in <a href="https://flairnlp.github.io/docs/tutorial-embeddings/flair-embeddings" class="external-link">Akbik
et al., COLING 2018 paper</a>)</p></li>
<li><p>Integrated embeddings extracted from transformers like
BERT.</p></li>
</ul>
<div class="section level3">
<h3 id="build-document-embedding-matrix-with-other-embedding-frameworks">Build Document-Embedding-Matrix with Other Embedding Frameworks<a class="anchor" aria-label="anchor" href="#build-document-embedding-matrix-with-other-embedding-frameworks"></a>
</h3>
<p><u><strong>Step 1</strong></u> Tokenize Text with
<code>quanteda</code> and <code>conText</code></p>
<p>First, let’s tokenize <code>cr_sample_corpus</code> using the
tokens_context function from the conText package.</p>
<div class="sourceCode" id="cb90"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># tokenize corpus removing unnecessary (i.e. semantically uninformative) elements</span></span>
<span><span class="va">toks</span> <span class="op">&lt;-</span> <span class="fu">tokens</span><span class="op">(</span><span class="va">cr_sample_corpus</span>, remove_punct<span class="op">=</span><span class="cn">T</span>, remove_symbols<span class="op">=</span><span class="cn">T</span>, remove_numbers<span class="op">=</span><span class="cn">T</span>, remove_separators<span class="op">=</span><span class="cn">T</span><span class="op">)</span></span>
<span><span class="co">#&gt; Warning in (function (n) : input string '#</span></span>
<span><span class="co">#&gt; # Copyright (C) 2016 and later: Unicode, Inc. and others.</span></span>
<span><span class="co">#&gt; # License &amp; terms of use: http://www.unicode.org/copyright.html</span></span>
<span><span class="co">#&gt; # Copyright (C) 2002-2016, International Business Machines Corporation</span></span>
<span><span class="co">#&gt; # and others. All Rights Reserved.</span></span>
<span><span class="co">#&gt; #</span></span>
<span><span class="co">#&gt; # file:  word.txt</span></span>
<span><span class="co">#&gt; #</span></span>
<span><span class="co">#&gt; # ICU Word Break Rules</span></span>
<span><span class="co">#&gt; #      See Unicode Standard Annex #29.</span></span>
<span><span class="co">#&gt; #      These rules are based on UAX #29 Revision 34 for Unicode Version 12.0</span></span>
<span><span class="co">#&gt; #</span></span>
<span><span class="co">#&gt; # Note:  Updates to word.txt will usually need to be merged into</span></span>
<span><span class="co">#&gt; #        word_POSIX.txt and word_fi_sv.txt also.</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; ##############################################################################</span></span>
<span><span class="co">#&gt; #</span></span>
<span><span class="co">#&gt; #  Character class definitions from TR 29</span></span>
<span><span class="co">#&gt; #</span></span>
<span><span class="co">#&gt; ##############################################################################</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; !!chain;</span></span>
<span><span class="co">#&gt; !!quoted_literals_only;</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; #</span></span>
<span><span class="co">#&gt; #  Character Class Definitions.</span></span>
<span><span class="co">#&gt; #</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $Han                = [:Han:];</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $CR                 = [\p{Word_Break = CR}];</span></span>
<span><span class="co">#&gt; $LF                 = [\p{Word_Break = LF}];</span></span>
<span><span class="co">#&gt; $Newline            = [\p{Word_Break = Newline}];</span></span>
<span><span class="co">#&gt; $Extend             = [\p{Wor [... truncated]</span></span>
<span></span>
<span><span class="co"># clean out stopwords and words with 2 or fewer characters</span></span>
<span><span class="va">toks_nostop</span> <span class="op">&lt;-</span> <span class="fu">tokens_select</span><span class="op">(</span><span class="va">toks</span>, pattern <span class="op">=</span> <span class="fu">stopwords</span><span class="op">(</span><span class="st">"en"</span><span class="op">)</span>, selection <span class="op">=</span> <span class="st">"remove"</span>, min_nchar<span class="op">=</span><span class="fl">3</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># only use features that appear at least 5 times in the corpus</span></span>
<span><span class="va">feats</span> <span class="op">&lt;-</span> <span class="fu">dfm</span><span class="op">(</span><span class="va">toks_nostop</span>, tolower<span class="op">=</span><span class="cn">T</span>, verbose <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu">dfm_trim</span><span class="op">(</span>min_termfreq <span class="op">=</span> <span class="fl">5</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu">featnames</span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># leave the pads so that non-adjacent words will not become adjacent</span></span>
<span><span class="va">toks_nostop_feats</span> <span class="op">&lt;-</span> <span class="fu">tokens_select</span><span class="op">(</span><span class="va">toks_nostop</span>, <span class="va">feats</span>, padding <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># build a tokenized corpus of contexts surrounding the target term "immigration"</span></span>
<span><span class="va">immig_toks</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/conText/man/tokens_context.html" class="external-link">tokens_context</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">toks_nostop_feats</span>, pattern <span class="op">=</span> <span class="st">"immigr*"</span>, window <span class="op">=</span> <span class="fl">6L</span><span class="op">)</span></span>
<span><span class="co">#&gt; 125 instances of "immigrant" found.</span></span>
<span><span class="co">#&gt; 288 instances of "immigrants" found.</span></span>
<span><span class="co">#&gt; 924 instances of "immigration" found.</span></span>
<span></span>
<span><span class="co"># build document-feature matrix</span></span>
<span><span class="va">immig_dfm</span> <span class="op">&lt;-</span> <span class="fu">dfm</span><span class="op">(</span><span class="va">immig_toks</span><span class="op">)</span></span></code></pre></div>
<p><u><strong>Step 2</strong></u> Import Embedding Tools</p>
<div style="text-align: justify;">
<p>To facilitate the loading of different embedding types, I’ll import
the following <strong>classes</strong> and <strong>functions</strong>
from flaiR: <code>WordEmbeddings</code>, <code>FlairEmbeddings</code>,
<code>TransformerWordEmbeddings</code>, <code>StackedEmbeddings</code>,
and <code>Sentence.</code> These components enable us to work with GloVe
embeddings, Flair’s contextual embeddings, and transformer-based
embeddings from the HuggingFace library.</p>
</div>
<div style="text-align: justify;">
<p>Initialize a Flair Sentence object by concatenating cr_glove_subset
row names. The collapse parameter ensures proper tokenization by adding
space delimiters. Then, embed the sentence text using the loaded
fasttext embeddings.</p>
</div>
<div class="sourceCode" id="cb91"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Combine all text into a single string and create a Flair sentence</span></span>
<span><span class="va">sentence</span> <span class="op">&lt;-</span> <span class="fu">Sentence</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">rownames</a></span><span class="op">(</span><span class="va">cr_glove_subset</span><span class="op">)</span>, collapse <span class="op">=</span> <span class="st">" "</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Apply FastText embeddings to the sentence</span></span>
<span><span class="va">fasttext_embeddings</span><span class="op">$</span><span class="fu">embed</span><span class="op">(</span><span class="va">sentence</span><span class="op">)</span></span>
<span><span class="co">#&gt; [[1]]</span></span>
<span><span class="co">#&gt; Sentence[500]: "people bill immigration president can american country law states one united speaker time going just now senate years want congress work get border know said make security many think act need children today come house also americans like year dont say america new state take way jobs senator federal government first back even amendment important well legislation support right women reform colleagues million committee laws system percent vote floor last every nation program made issue care immigrants see department national health world good republican families court workers executive administration much help illegal enforcement republicans thank fact members working number opportunity thats believe pass great never legal obama homeland money family across two put look process came may violence order give rule job done able pay must day economy home community budget tax public without passed things better since majority texas let justice another hope policy lets provide debate history ago sure presidents action week young actually nations amendments bipartisan says long issues comprehensive next something place life doesnt thing lot point chairman economic business leadership service constitution tell status dream cant yield future office billion visa find military still member talk together school rights continue part madam amnesty days secure bring best yet lives democrats broken times side nothing ask protect allow problem around making clear body foreign communities including coming use rise simply heard forward end programs leader already saying individuals general power funding case whether debt course keep question worked needs washington war change got address secretary parents little least hard three citizens different education judiciary ever strong immigrant always means current report child less really services political given increase might enough create countries domestic human supreme authority brought reason kind past become aliens understand millions judge enforce benefits constitutional high stand others criminal serve stop middle real matter talking makes someone proud month safety line used college live didnt class called call far borders victims ensure district thousands california taxes rules obamacare deal goes representatives took insurance spending companies actions small instead read resources friends mexico seen illegally policies trying labor party example crisis bills votes ice special wage went taken men asked told comes serious maybe students businesses getting words group chamber senators taking leaders wish dollars citizenship sense problems close information social friend stay offer record away months set urge person minimum democratic cost local voted numbers join energy served happen aisle found congressional wanted according plan kids try chance major almost powers trade undocumented critical poverty start article single left certainly cases access patrol individual honor remember income attorney within officers wrong speak company second hundreds impact created hours respect arizona though move hearing employees gentleman anyone along known meet chair full southern big trillion level four ability experience face provisions man provides fix open theyre efforts asian university decision groups industry allowed higher often agree white visas held upon path certain share isnt looking employers consider colleague average woman anything however balance former city interest control crime weeks free gone unemployment idea true"</span></span></code></pre></div>
<div style="text-align: justify;">
<p>The <code>process_embeddings</code> function from flaiR extracts
pre-embedded GloVe vectors from a sentence object and arranges them into
a structured matrix. In this matrix, tokens are represented as rows,
embedding dimensions as columns, and each row is labeled with its
corresponding token text.</p>
</div>
<div class="sourceCode" id="cb92"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">fasttext_subset</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/process_embeddings.html">process_embeddings</a></span><span class="op">(</span><span class="va">sentence</span>, verbose <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="co">#&gt; Extracting token embeddings...</span></span>
<span><span class="co">#&gt; Converting embeddings to matrix format...Processing completed in 3.451 seconds</span></span>
<span><span class="co">#&gt; Generated embedding matrix with 500 tokens and 300 dimensions</span></span></code></pre></div>
<p><u><strong>Step 3</strong></u> Computing Context-Specific Word
Embeddings Using FastText</p>
<div style="text-align: justify;">
<p>Create a feature co-occurrence matrix (FCM) from tokenized text and
transform pre-trained FastText embeddings using co-occurrence
information.</p>
</div>
<div class="sourceCode" id="cb93"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Create a feature co-occurrence matrix (FCM) from tokenized text</span></span>
<span><span class="va">toks_fcm</span> <span class="op">&lt;-</span> <span class="fu">fcm</span><span class="op">(</span><span class="va">toks_nostop_feats</span>, </span>
<span>                context <span class="op">=</span> <span class="st">"window"</span>,    </span>
<span>                window <span class="op">=</span> <span class="fl">6</span>,            </span>
<span>                count <span class="op">=</span> <span class="st">"frequency"</span>,   </span>
<span>                tri <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span>           </span>
<span></span>
<span><span class="co"># Transform pre-trained Glove embeddings using co-occurrence information</span></span>
<span><span class="va">ft_transform</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/conText/man/compute_transform.html" class="external-link">compute_transform</a></span><span class="op">(</span></span>
<span>    x <span class="op">=</span> <span class="va">toks_fcm</span>,                    </span>
<span>    pre_trained <span class="op">=</span> <span class="va">fasttext_subset</span>,        </span>
<span>    weighting <span class="op">=</span> <span class="st">'log'</span>                </span>
<span><span class="op">)</span></span></code></pre></div>
<p>Calculate Document Embedding Matrix (DEM) using transformed FastText
embeddings.</p>
<div class="sourceCode" id="cb94"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Calculate Document Embedding Matrix (DEM) using transformed FastText embeddings</span></span>
<span><span class="va">immig_dem_ft</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/conText/man/dem.html" class="external-link">dem</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">immig_dfm</span>, </span>
<span>                    pre_trained <span class="op">=</span> <span class="va">fasttext_subset</span>, </span>
<span>                    transform <span class="op">=</span> <span class="cn">TRUE</span>, </span>
<span>                    transform_matrix <span class="op">=</span> <span class="va">ft_transform</span>, </span>
<span>                    verbose <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
<p>Show each document inherits its corresponding docvars.</p>
<div class="sourceCode" id="cb95"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">immig_dem_ft</span><span class="op">@</span><span class="va">docvars</span><span class="op">)</span></span>
<span><span class="co">#&gt;       pattern party gender nominate_dim1</span></span>
<span><span class="co">#&gt; 1  immigrants     D      F        -0.759</span></span>
<span><span class="co">#&gt; 2 immigration     D      F        -0.402</span></span>
<span><span class="co">#&gt; 3   immigrant     D      F        -0.402</span></span>
<span><span class="co">#&gt; 4   immigrant     D      F        -0.402</span></span>
<span><span class="co">#&gt; 5   immigrant     D      F        -0.402</span></span>
<span><span class="co">#&gt; 6 immigration     D      F        -0.402</span></span></code></pre></div>
<p><u><strong>Step 4</strong></u> Embedding Eegression</p>
<div class="sourceCode" id="cb96"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">2021L</span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/prodriguezsosa/EmbeddingRegression" class="external-link">conText</a></span><span class="op">)</span></span>
<span><span class="va">ft_model</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/conText/man/conText.html" class="external-link">conText</a></span><span class="op">(</span>formula <span class="op">=</span> <span class="va">immigration</span> <span class="op">~</span> <span class="va">party</span> <span class="op">+</span> <span class="va">gender</span>,</span>
<span>                    data <span class="op">=</span> <span class="va">toks_nostop_feats</span>,</span>
<span>                    pre_trained <span class="op">=</span> <span class="va">fasttext_subset</span>,</span>
<span>                    transform <span class="op">=</span> <span class="cn">TRUE</span>, </span>
<span>                    transform_matrix <span class="op">=</span> <span class="va">ft_transform</span>, </span>
<span>                    confidence_level <span class="op">=</span> <span class="fl">0.95</span>,</span>
<span>                    permute <span class="op">=</span> <span class="cn">TRUE</span>, </span>
<span>                    jackknife <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>                    num_permutations <span class="op">=</span> <span class="fl">100</span>,</span>
<span>                    window <span class="op">=</span> <span class="fl">6</span>, case_insensitive <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>                    verbose <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="co">#&gt; Note: These values are not regression coefficients. Check out the Quick Start Guide for help with interpretation: </span></span>
<span><span class="co">#&gt; https://github.com/prodriguezsosa/conText/blob/master/vignettes/quickstart.md</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;   coefficient normed.estimate std.error  lower.ci upper.ci p.value</span></span>
<span><span class="co">#&gt; 1     party_R        1.169415 0.1589605 0.8574491 1.481381       0</span></span>
<span><span class="co">#&gt; 2    gender_M        0.837367 0.1433172 0.5561016 1.118632       0</span></span></code></pre></div>
<p>extract D-dimensional beta coefficients.</p>
<div class="sourceCode" id="cb97"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># The intercept in this case is the fastext embedding for female Democrats</span></span>
<span><span class="co"># beta coefficients can be combined to get each group's fastext embedding</span></span>
<span><span class="va">DF_wv</span> <span class="op">&lt;-</span> <span class="va">ft_model</span><span class="op">[</span><span class="st">'(Intercept)'</span>,<span class="op">]</span>  <span class="co"># (D)emocrat - (F)emale </span></span>
<span><span class="va">DM_wv</span> <span class="op">&lt;-</span> <span class="va">ft_model</span><span class="op">[</span><span class="st">'(Intercept)'</span>,<span class="op">]</span> <span class="op">+</span> <span class="va">ft_model</span><span class="op">[</span><span class="st">'gender_M'</span>,<span class="op">]</span> <span class="co"># (D)emocrat - (M)ale </span></span>
<span><span class="va">RF_wv</span> <span class="op">&lt;-</span> <span class="va">ft_model</span><span class="op">[</span><span class="st">'(Intercept)'</span>,<span class="op">]</span> <span class="op">+</span> <span class="va">ft_model</span><span class="op">[</span><span class="st">'party_R'</span>,<span class="op">]</span>  <span class="co"># (R)epublican - (F)emale </span></span>
<span><span class="va">RM_wv</span> <span class="op">&lt;-</span> <span class="va">ft_model</span><span class="op">[</span><span class="st">'(Intercept)'</span>,<span class="op">]</span> <span class="op">+</span> <span class="va">ft_model</span><span class="op">[</span><span class="st">'party_R'</span>,<span class="op">]</span> <span class="op">+</span> <span class="va">ft_model</span><span class="op">[</span><span class="st">'gender_M'</span>,<span class="op">]</span> <span class="co"># (R)epublican - (M)ale</span></span></code></pre></div>
<p>nearest neighbors</p>
<div class="sourceCode" id="cb98"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/pkg/conText/man/nns.html" class="external-link">nns</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">rbind</a></span><span class="op">(</span><span class="va">DF_wv</span>,<span class="va">DM_wv</span><span class="op">)</span>, </span>
<span>    N <span class="op">=</span> <span class="fl">10</span>, </span>
<span>    pre_trained <span class="op">=</span> <span class="va">fasttext_subset</span>, </span>
<span>    candidates <span class="op">=</span> <span class="va">ft_model</span><span class="op">@</span><span class="va">features</span><span class="op">)</span></span>
<span><span class="co">#&gt; $DM_wv</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 10 × 4</span></span></span>
<span><span class="co">#&gt;    target feature      rank value</span></span>
<span><span class="co">#&gt;    <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>       <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 1</span> DM_wv  immigration     1 0.850</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 2</span> DM_wv  immigrants      2 0.746</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 3</span> DM_wv  immigrant       3 0.698</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 4</span> DM_wv  education       4 0.589</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 5</span> DM_wv  government      5 0.587</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 6</span> DM_wv  legislation     6 0.579</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 7</span> DM_wv  city            7 0.569</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 8</span> DM_wv  law             8 0.566</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 9</span> DM_wv  reform          9 0.559</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">10</span> DM_wv  citizenship    10 0.557</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $DF_wv</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 10 × 4</span></span></span>
<span><span class="co">#&gt;    target feature      rank value</span></span>
<span><span class="co">#&gt;    <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>       <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 1</span> DF_wv  immigration     1 0.779</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 2</span> DF_wv  immigrants      2 0.667</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 3</span> DF_wv  immigrant       3 0.620</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 4</span> DF_wv  education       4 0.574</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 5</span> DF_wv  government      5 0.556</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 6</span> DF_wv  economic        6 0.551</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 7</span> DF_wv  citizenship     7 0.549</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 8</span> DF_wv  legislation     8 0.540</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 9</span> DF_wv  issues          9 0.531</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">10</span> DF_wv  laws           10 0.530</span></span></code></pre></div>
<div class="sourceCode" id="cb99"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org" class="external-link">ggplot2</a></span><span class="op">)</span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">ft_model</span><span class="op">@</span><span class="va">normed_coefficients</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">coefficient</span>, y <span class="op">=</span> <span class="va">normed.estimate</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_linerange.html" class="external-link">geom_errorbar</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>ymin <span class="op">=</span> <span class="va">lower.ci</span>, ymax <span class="op">=</span> <span class="va">upper.ci</span><span class="op">)</span>, width <span class="op">=</span> <span class="fl">0.2</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html" class="external-link">geom_point</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">3</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_abline.html" class="external-link">geom_hline</a></span><span class="op">(</span>yintercept <span class="op">=</span> <span class="fl">0</span>, linetype <span class="op">=</span> <span class="st">"dashed"</span>, color <span class="op">=</span> <span class="st">"gray50"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_minimal</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span></span>
<span>    title <span class="op">=</span> <span class="st">"Estimated Coefficients with 95% CIs"</span>,</span>
<span>    x <span class="op">=</span> <span class="st">"Variables"</span>,</span>
<span>    y <span class="op">=</span> <span class="st">"Normalized Estimate"</span></span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span>axis.text.x <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_text</a></span><span class="op">(</span>angle <span class="op">=</span> <span class="fl">45</span>, hjust <span class="op">=</span> <span class="fl">1</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><img src="tutorial_files/figure-html/unnamed-chunk-102-1.png" width="700"></p>
</div>
<div class="section level3">
<h3 id="exploring-document-embedding-matrix-with-context-functions">Exploring Document-Embedding Matrix with conText Functions<a class="anchor" aria-label="anchor" href="#exploring-document-embedding-matrix-with-context-functions"></a>
</h3>
<p>Check dimensions of the resulting matrix.</p>
<div class="sourceCode" id="cb100"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Calculate average document embeddings for immigration-related texts</span></span>
<span><span class="va">immig_wv_ft</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/colSums.html" class="external-link">colMeans</a></span><span class="op">(</span><span class="va">immig_dem_ft</span><span class="op">)</span>, </span>
<span>                   ncol <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">ncol</a></span><span class="op">(</span><span class="va">immig_dem_ft</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span>  <span class="fu">`rownames&lt;-`</span><span class="op">(</span><span class="st">"immigration"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/dim.html" class="external-link">dim</a></span><span class="op">(</span><span class="va">immig_wv_ft</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1]   1 300</span></span></code></pre></div>
<p>to get group-specific embeddings, average within party</p>
<div class="sourceCode" id="cb101"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">immig_wv_ft_party</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/conText/man/dem_group.html" class="external-link">dem_group</a></span><span class="op">(</span><span class="va">immig_dem_ft</span>, </span>
<span>                               groups <span class="op">=</span> <span class="va">immig_dem_ft</span><span class="op">@</span><span class="va">docvars</span><span class="op">$</span><span class="va">party</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/dim.html" class="external-link">dim</a></span><span class="op">(</span><span class="va">immig_wv_ft_party</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1]   2 300</span></span></code></pre></div>
<p>Find nearest neighbors by party</p>
<div class="sourceCode" id="cb102"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># find nearest neighbors by party</span></span>
<span><span class="co"># setting as_list = FALSE combines each group's results into a single tibble (useful for joint plotting)</span></span>
<span><span class="va">immig_nns_ft</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/conText/man/nns.html" class="external-link">nns</a></span><span class="op">(</span><span class="va">immig_wv_ft_party</span>, </span>
<span>                    pre_trained <span class="op">=</span> <span class="va">fasttext_subset</span>, </span>
<span>                    N <span class="op">=</span> <span class="fl">5</span>, </span>
<span>                    candidates <span class="op">=</span> <span class="va">immig_wv_ft_party</span><span class="op">@</span><span class="va">features</span>, </span>
<span>                    as_list <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
<p>check out results for Republican.</p>
<div class="sourceCode" id="cb103"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">immig_nns_ft</span><span class="op">[[</span><span class="st">"R"</span><span class="op">]</span><span class="op">]</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 5 × 4</span></span></span>
<span><span class="co">#&gt;   target feature      rank value</span></span>
<span><span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>       <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span> R      immigration     1 0.837</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span> R      immigrants      2 0.779</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">3</span> R      immigrant       3 0.721</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">4</span> R      government      4 0.590</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">5</span> R      laws            5 0.588</span></span></code></pre></div>
<p>check out results for Democrat</p>
<div class="sourceCode" id="cb104"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">immig_nns_ft</span><span class="op">[[</span><span class="st">"D"</span><span class="op">]</span><span class="op">]</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 5 × 4</span></span></span>
<span><span class="co">#&gt;   target feature      rank value</span></span>
<span><span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>       <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span> D      immigration     1 0.849</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span> D      immigrants      2 0.817</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">3</span> D      immigrant       3 0.764</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">4</span> D      education       4 0.621</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">5</span> D      families        5 0.612</span></span></code></pre></div>
<p>compute the cosine similarity between each party’s embedding and a
specific set of features</p>
<div class="sourceCode" id="cb105"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/pkg/conText/man/cos_sim.html" class="external-link">cos_sim</a></span><span class="op">(</span><span class="va">immig_wv_ft_party</span>, </span>
<span>        pre_trained <span class="op">=</span> <span class="va">fasttext_subset</span>, </span>
<span>        features <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">'reform'</span>, <span class="st">'enforcement'</span><span class="op">)</span>, as_list <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="co">#&gt;   target     feature     value</span></span>
<span><span class="co">#&gt; 1      D      reform 0.5306484</span></span>
<span><span class="co">#&gt; 2      R      reform 0.5425264</span></span>
<span><span class="co">#&gt; 3      D enforcement 0.5102908</span></span>
<span><span class="co">#&gt; 4      R enforcement 0.5647015</span></span></code></pre></div>
<p>compute the cosine similarity between each party’s embedding and a
specific set of features.</p>
<div class="sourceCode" id="cb106"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Republican</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/conText/man/nns_ratio.html" class="external-link">nns_ratio</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">immig_wv_ft_party</span>, </span>
<span>          N <span class="op">=</span> <span class="fl">15</span>, </span>
<span>          numerator <span class="op">=</span> <span class="st">"R"</span>, </span>
<span>          candidates <span class="op">=</span> <span class="va">immig_wv_ft_party</span><span class="op">@</span><span class="va">features</span>, </span>
<span>          pre_trained <span class="op">=</span> <span class="va">fasttext_subset</span>, </span>
<span>          verbose <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="co">#&gt;        feature     value</span></span>
<span><span class="co">#&gt; 1       coming 1.3142709</span></span>
<span><span class="co">#&gt; 2       things 1.2022012</span></span>
<span><span class="co">#&gt; 3    political 1.1506919</span></span>
<span><span class="co">#&gt; 4  enforcement 1.1066269</span></span>
<span><span class="co">#&gt; 5       aliens 1.0194435</span></span>
<span><span class="co">#&gt; 6       issues 1.0124816</span></span>
<span><span class="co">#&gt; 7   government 0.9908574</span></span>
<span><span class="co">#&gt; 8        visas 0.9904320</span></span>
<span><span class="co">#&gt; 9         laws 0.9874748</span></span>
<span><span class="co">#&gt; 10 immigration 0.9849872</span></span>
<span><span class="co">#&gt; 11 legislation 0.9666258</span></span>
<span><span class="co">#&gt; 12  immigrants 0.9526017</span></span>
<span><span class="co">#&gt; 13 citizenship 0.9524804</span></span>
<span><span class="co">#&gt; 14   education 0.9448045</span></span>
<span><span class="co">#&gt; 15   immigrant 0.9435372</span></span>
<span><span class="co">#&gt; 16         law 0.9222851</span></span>
<span><span class="co">#&gt; 17   community 0.8816272</span></span>
<span><span class="co">#&gt; 18    citizens 0.8722014</span></span>
<span><span class="co">#&gt; 19        city 0.8544540</span></span>
<span><span class="co">#&gt; 20    families 0.7845902</span></span>
<span><span class="co">#&gt; 21 communities 0.7798629</span></span></code></pre></div>
<div class="sourceCode" id="cb107"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Democrat</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/conText/man/nns_ratio.html" class="external-link">nns_ratio</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">immig_wv_ft_party</span>, </span>
<span>          N <span class="op">=</span> <span class="fl">15</span>, </span>
<span>          numerator <span class="op">=</span> <span class="st">"D"</span>, </span>
<span>          candidates <span class="op">=</span> <span class="va">immig_wv_ft_party</span><span class="op">@</span><span class="va">features</span>, </span>
<span>          pre_trained <span class="op">=</span> <span class="va">fasttext_subset</span>, </span>
<span>          verbose <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="co">#&gt;        feature     value</span></span>
<span><span class="co">#&gt; 1  communities 1.2822766</span></span>
<span><span class="co">#&gt; 2     families 1.2745507</span></span>
<span><span class="co">#&gt; 3         city 1.1703380</span></span>
<span><span class="co">#&gt; 4     citizens 1.1465242</span></span>
<span><span class="co">#&gt; 5    community 1.1342663</span></span>
<span><span class="co">#&gt; 6          law 1.0842634</span></span>
<span><span class="co">#&gt; 7    immigrant 1.0598416</span></span>
<span><span class="co">#&gt; 8    education 1.0584201</span></span>
<span><span class="co">#&gt; 9  citizenship 1.0498903</span></span>
<span><span class="co">#&gt; 10  immigrants 1.0497567</span></span>
<span><span class="co">#&gt; 11 legislation 1.0345265</span></span>
<span><span class="co">#&gt; 12 immigration 1.0152416</span></span>
<span><span class="co">#&gt; 13        laws 1.0126841</span></span>
<span><span class="co">#&gt; 14       visas 1.0096605</span></span>
<span><span class="co">#&gt; 15  government 1.0092270</span></span>
<span><span class="co">#&gt; 16      issues 0.9876722</span></span>
<span><span class="co">#&gt; 17      aliens 0.9809273</span></span>
<span><span class="co">#&gt; 18 enforcement 0.9036469</span></span>
<span><span class="co">#&gt; 19   political 0.8690423</span></span>
<span><span class="co">#&gt; 20      things 0.8318075</span></span>
<span><span class="co">#&gt; 21      coming 0.7608781</span></span></code></pre></div>
<p>compute the cosine similarity between each party’s embedding and a
set of tokenized contexts</p>
<div class="sourceCode" id="cb108"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">immig_ncs</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/conText/man/ncs.html" class="external-link">ncs</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">immig_wv_ft_party</span>, </span>
<span>                 contexts_dem <span class="op">=</span> <span class="va">immig_dem_ft</span>, </span>
<span>                 contexts <span class="op">=</span> <span class="va">immig_toks</span>, </span>
<span>                 N <span class="op">=</span> <span class="fl">5</span>, </span>
<span>                 as_list <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># nearest contexts to Republican embedding of target term</span></span>
<span><span class="co"># note, these may included contexts originating from Democrat speakers</span></span>
<span><span class="va">immig_ncs</span><span class="op">[[</span><span class="st">"R"</span><span class="op">]</span><span class="op">]</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 5 × 4</span></span></span>
<span><span class="co">#&gt;   target context                                                rank value</span></span>
<span><span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>                                                 <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span> R      reminded difficult achieve consensus issues reform s…     1 0.536</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span> R      laws last years eight states adopted enforcement mea…     2 0.496</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">3</span> R      well exactly right way stop illegal reducing demand …     3 0.492</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">4</span> R      speeches border enforcement speeches stopping illega…     4 0.482</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">5</span> R      welcome legal immigrants legal process illegal simpl…     5 0.472</span></span></code></pre></div>
<div class="sourceCode" id="cb109"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">immig_ncs</span><span class="op">[[</span><span class="st">"D"</span><span class="op">]</span><span class="op">]</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 5 × 4</span></span></span>
<span><span class="co">#&gt;   target context                                                rank value</span></span>
<span><span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>                                                 <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span> D      heritage principles demand courage reform broken sys…     1 0.571</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span> D      speaker almost year since twothirds comprehensive re…     2 0.562</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">3</span> D      senate accepted indeed need thorough comprehensive r…     3 0.562</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">4</span> D      state union consideration bill provide comprehensive…     4 0.536</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">5</span> D      cover house republican failure bring comprehensive r…     5 0.534</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="comparative-analysis-of-a-la-carte-flair-stacked-and-bert-embeddings">Comparative Analysis of A La Carte, Flair Stacked, and BERT
Embeddings<a class="anchor" aria-label="anchor" href="#comparative-analysis-of-a-la-carte-flair-stacked-and-bert-embeddings"></a>
</h3>
<div class="section level4">
<h4 id="build-a-la-carte-document-embedding-matrix">Build A La Carte Document-Embedding-Matrix<a class="anchor" aria-label="anchor" href="#build-a-la-carte-document-embedding-matrix"></a>
</h4>
<div class="sourceCode" id="cb110"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># build a document-embedding-matrix</span></span>
<span><span class="va">immig_dem</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/conText/man/dem.html" class="external-link">dem</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">immig_dfm</span>, pre_trained <span class="op">=</span> <span class="va">cr_glove_subset</span>, transform <span class="op">=</span> <span class="cn">TRUE</span>, transform_matrix <span class="op">=</span> <span class="va">cr_transform</span>, verbose <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">2021L</span><span class="op">)</span></span>
<span><span class="va">alc_model</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/conText/man/conText.html" class="external-link">conText</a></span><span class="op">(</span>formula <span class="op">=</span> <span class="va">immigration</span> <span class="op">~</span> <span class="va">party</span> <span class="op">+</span> <span class="va">gender</span>,</span>
<span>                     data <span class="op">=</span> <span class="va">toks_nostop_feats</span>,</span>
<span>                     pre_trained <span class="op">=</span> <span class="va">cr_glove_subset</span>,</span>
<span>                     transform <span class="op">=</span> <span class="cn">TRUE</span>, </span>
<span>                     transform_matrix <span class="op">=</span> <span class="va">cr_transform</span>,</span>
<span>                     jackknife <span class="op">=</span> <span class="cn">TRUE</span>, </span>
<span>                     confidence_level <span class="op">=</span> <span class="fl">0.95</span>,</span>
<span>                     permute <span class="op">=</span> <span class="cn">TRUE</span>, </span>
<span>                     num_permutations <span class="op">=</span> <span class="fl">100</span>,</span>
<span>                     window <span class="op">=</span> <span class="fl">6</span>, </span>
<span>                     case_insensitive <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>                     verbose <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="co">#&gt; Note: These values are not regression coefficients. Check out the Quick Start Guide for help with interpretation: </span></span>
<span><span class="co">#&gt; https://github.com/prodriguezsosa/conText/blob/master/vignettes/quickstart.md</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;   coefficient normed.estimate std.error lower.ci upper.ci p.value</span></span>
<span><span class="co">#&gt; 1     party_R        2.960860 0.2398964 2.490054 3.431665       0</span></span>
<span><span class="co">#&gt; 2    gender_M        2.303401 0.2290150 1.853950 2.752851       0</span></span></code></pre></div>
</div>
<div class="section level4">
<h4 id="document-embedding-matrix-construction-using-flair-contextual-stacked-embeddings">Document Embedding Matrix Construction Using Flair Contextual
Stacked Embeddings<a class="anchor" aria-label="anchor" href="#document-embedding-matrix-construction-using-flair-contextual-stacked-embeddings"></a>
</h4>
<div style="text-align: justify;">
<p>To facilitate the loading of different embedding types, I’ll import
the following <strong>classes</strong> and <strong>functions</strong>
from flaiF: <code>WordEmbeddings</code>, <code>FlairEmbeddings</code>,
<code>TransformerWordEmbeddings</code>, <code>StackedEmbeddings</code>,
and <code>Sentence</code>. These components enable us to work with GloVe
embeddings, Flair’s contextual embeddings, and transformer-based
embeddings from the HuggingFace library.</p>
</div>
<p>Combine three different types of embeddings into a stacked embedding
model.</p>
<p>This creates a stacked embedding model that combines:</p>
<ul>
<li>
<code>FastText embeddings</code>: Captures general word
semantics</li>
<li>
<code>Forward Flair</code>: Captures contextual information reading
text left-to-right</li>
<li>
<code>Backward Flair</code>: Captures contextual information reading
text right-to-left</li>
</ul>
<div class="sourceCode" id="cb111"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">stacked_embeddings</span>  <span class="op">&lt;-</span> <span class="fu">StackedEmbeddings</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>  <span class="va">fasttext_embeddings</span>,    </span>
<span>  <span class="va">flair_forward</span>,          </span>
<span>  <span class="va">flair_backward</span>        </span>
<span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb112"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Step 1: Create a Flair Sentence object from the text</span></span>
<span><span class="va">sentence</span> <span class="op">&lt;-</span> <span class="fu">Sentence</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">rownames</a></span><span class="op">(</span><span class="va">cr_glove_subset</span><span class="op">)</span>, collapse <span class="op">=</span> <span class="st">" "</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Step 2: Generate embeddings using our stacked model</span></span>
<span><span class="va">stacked_embeddings</span><span class="op">$</span><span class="fu">embed</span><span class="op">(</span><span class="va">sentence</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Step 3: Extract and store embeddings for each token</span></span>
<span><span class="va">stacked_subset</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/process_embeddings.html">process_embeddings</a></span><span class="op">(</span><span class="va">sentence</span>, verbose <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="co">#&gt; Extracting token embeddings...</span></span>
<span><span class="co">#&gt; Converting embeddings to matrix format...Processing completed in 3.103 seconds</span></span>
<span><span class="co">#&gt; Generated embedding matrix with 500 tokens and 4396 dimensions</span></span>
<span></span>
<span><span class="co"># Step 4: Compute transformation matrix</span></span>
<span></span>
<span><span class="va">st_transform</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/conText/man/compute_transform.html" class="external-link">compute_transform</a></span><span class="op">(</span></span>
<span>   x <span class="op">=</span> <span class="va">toks_fcm</span>,               </span>
<span>   pre_trained <span class="op">=</span> <span class="va">stacked_subset</span>,</span>
<span>   weighting <span class="op">=</span> <span class="st">'log'</span>          </span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Step 5: Generate document embeddings matrix</span></span>
<span><span class="va">immig_dem_st</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/conText/man/dem.html" class="external-link">dem</a></span><span class="op">(</span></span>
<span>   x <span class="op">=</span> <span class="va">immig_dfm</span>,              </span>
<span>   pre_trained <span class="op">=</span> <span class="va">stacked_subset</span>,</span>
<span>   transform <span class="op">=</span> <span class="cn">TRUE</span>,          </span>
<span>   transform_matrix <span class="op">=</span> <span class="va">st_transform</span>,</span>
<span>   verbose <span class="op">=</span> <span class="cn">TRUE</span>             </span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Step 6: Fit conText model for analysis</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">2021L</span><span class="op">)</span>                 </span>
<span><span class="va">st_model</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/conText/man/conText.html" class="external-link">conText</a></span><span class="op">(</span>formula <span class="op">=</span> <span class="va">immigration</span> <span class="op">~</span> <span class="va">party</span> <span class="op">+</span> <span class="va">gender</span>,  </span>
<span>                    data <span class="op">=</span> <span class="va">toks_nostop_feats</span>,                </span>
<span>                    pre_trained <span class="op">=</span> <span class="va">stacked_subset</span>,          </span>
<span>                    transform <span class="op">=</span> <span class="cn">TRUE</span>,                      </span>
<span>                    transform_matrix <span class="op">=</span> <span class="va">st_transform</span>,       </span>
<span>                    jackknife <span class="op">=</span> <span class="cn">TRUE</span>,                      </span>
<span>                    confidence_level <span class="op">=</span> <span class="fl">0.95</span>,             </span>
<span>                    permute <span class="op">=</span> <span class="cn">TRUE</span>,                      </span>
<span>                    num_permutations <span class="op">=</span> <span class="fl">100</span>,               </span>
<span>                    window <span class="op">=</span> <span class="fl">6</span>,                          </span>
<span>                    case_insensitive <span class="op">=</span> <span class="cn">TRUE</span>,              </span>
<span>                    verbose <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="co">#&gt; Note: These values are not regression coefficients. Check out the Quick Start Guide for help with interpretation: </span></span>
<span><span class="co">#&gt; https://github.com/prodriguezsosa/conText/blob/master/vignettes/quickstart.md</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;   coefficient normed.estimate std.error  lower.ci upper.ci p.value</span></span>
<span><span class="co">#&gt; 1     party_R        121.4567   96.6311 -68.18549 311.0988    0.32</span></span>
<span><span class="co">#&gt; 2    gender_M        226.2376  102.9460  24.20230 428.2730    0.07</span></span></code></pre></div>
</div>
<div class="section level4">
<h4 id="document-embedding-matrix-construction-with-bert">Document Embedding Matrix Construction with BERT<a class="anchor" aria-label="anchor" href="#document-embedding-matrix-construction-with-bert"></a>
</h4>
<div style="text-align: justify;">
<p>BERT embeddings provide powerful contextual representations through
their bidirectional transformer architecture. These embeddings are good
at understanding context from both directions within text, generating
deep contextual representations through multiple transformer layers, and
leveraging pre-training on large text corpora to achieve strong
performance across NLP tasks. The classic BERT base model generates
768-dimensional embeddings for each token, providing rich semantic
representations.</p>
</div>
<p>By utilizing the Flair framework, we also can seamlessly
integrate:</p>
<ul>
<li>Multiple BERT variants like RoBERTa and DistilBERT</li>
<li>Cross-lingual models such as XLM-RoBERTa<br>
</li>
<li>Domain-adapted BERT models</li>
<li>Any transformer model available on HuggingFace</li>
</ul>
<div class="sourceCode" id="cb113"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Initialize BERT base uncased model embeddings from HuggingFace</span></span>
<span><span class="va">bert_embeddings</span> <span class="op">&lt;-</span> <span class="fu">TransformerWordEmbeddings</span><span class="op">(</span><span class="st">'bert-base-uncased'</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb114"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Step 1: Create a Flair Sentence object from the text</span></span>
<span><span class="va">sentence</span> <span class="op">&lt;-</span> <span class="fu">Sentence</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">rownames</a></span><span class="op">(</span><span class="va">cr_glove_subset</span><span class="op">)</span>, collapse <span class="op">=</span> <span class="st">" "</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Step 2: Generate embeddings using BERT model from HugginFace</span></span>
<span><span class="va">bert_embeddings</span><span class="op">$</span><span class="fu">embed</span><span class="op">(</span><span class="va">sentence</span><span class="op">)</span></span>
<span><span class="co">#&gt; [[1]]</span></span>
<span><span class="co">#&gt; Sentence[500]: "people bill immigration president can american country law states one united speaker time going just now senate years want congress work get border know said make security many think act need children today come house also americans like year dont say america new state take way jobs senator federal government first back even amendment important well legislation support right women reform colleagues million committee laws system percent vote floor last every nation program made issue care immigrants see department national health world good republican families court workers executive administration much help illegal enforcement republicans thank fact members working number opportunity thats believe pass great never legal obama homeland money family across two put look process came may violence order give rule job done able pay must day economy home community budget tax public without passed things better since majority texas let justice another hope policy lets provide debate history ago sure presidents action week young actually nations amendments bipartisan says long issues comprehensive next something place life doesnt thing lot point chairman economic business leadership service constitution tell status dream cant yield future office billion visa find military still member talk together school rights continue part madam amnesty days secure bring best yet lives democrats broken times side nothing ask protect allow problem around making clear body foreign communities including coming use rise simply heard forward end programs leader already saying individuals general power funding case whether debt course keep question worked needs washington war change got address secretary parents little least hard three citizens different education judiciary ever strong immigrant always means current report child less really services political given increase might enough create countries domestic human supreme authority brought reason kind past become aliens understand millions judge enforce benefits constitutional high stand others criminal serve stop middle real matter talking makes someone proud month safety line used college live didnt class called call far borders victims ensure district thousands california taxes rules obamacare deal goes representatives took insurance spending companies actions small instead read resources friends mexico seen illegally policies trying labor party example crisis bills votes ice special wage went taken men asked told comes serious maybe students businesses getting words group chamber senators taking leaders wish dollars citizenship sense problems close information social friend stay offer record away months set urge person minimum democratic cost local voted numbers join energy served happen aisle found congressional wanted according plan kids try chance major almost powers trade undocumented critical poverty start article single left certainly cases access patrol individual honor remember income attorney within officers wrong speak company second hundreds impact created hours respect arizona though move hearing employees gentleman anyone along known meet chair full southern big trillion level four ability experience face provisions man provides fix open theyre efforts asian university decision groups industry allowed higher often agree white visas held upon path certain share isnt looking employers consider colleague average woman anything however balance former city interest control crime weeks free gone unemployment idea true"</span></span>
<span></span>
<span><span class="co"># Step 3: Extract and store embeddings for each token</span></span>
<span><span class="va">bert_subset</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/process_embeddings.html">process_embeddings</a></span><span class="op">(</span><span class="va">sentence</span>, verbose <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="co">#&gt; Extracting token embeddings...</span></span>
<span><span class="co">#&gt; Converting embeddings to matrix format...Processing completed in 2.733 seconds</span></span>
<span><span class="co">#&gt; Generated embedding matrix with 500 tokens and 768 dimensions</span></span>
<span></span>
<span><span class="co"># Step 4: Compute transformation matrix </span></span>
<span><span class="va">bt_transform</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/conText/man/compute_transform.html" class="external-link">compute_transform</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">toks_fcm</span>,     </span>
<span>                                  pre_trained <span class="op">=</span> <span class="va">bert_subset</span>,</span>
<span>                                  weighting <span class="op">=</span> <span class="st">'log'</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Step 5: Generate document embeddings matrix</span></span>
<span><span class="va">immig_dem_bt</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/conText/man/dem.html" class="external-link">dem</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">immig_dfm</span>,</span>
<span>                    pre_trained <span class="op">=</span> <span class="va">bert_subset</span>,</span>
<span>                    transform <span class="op">=</span> <span class="cn">TRUE</span>,          </span>
<span>                    transform_matrix <span class="op">=</span> <span class="va">bt_transform</span>,</span>
<span>                    verbose <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Step 6: Fit conText model for analysis</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">2021L</span><span class="op">)</span>                 </span>
<span><span class="va">bt_model</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/conText/man/conText.html" class="external-link">conText</a></span><span class="op">(</span>formula <span class="op">=</span> <span class="va">immigration</span> <span class="op">~</span> <span class="va">party</span> <span class="op">+</span> <span class="va">gender</span>,  </span>
<span>                    data <span class="op">=</span> <span class="va">toks_nostop_feats</span>,                </span>
<span>                    pre_trained <span class="op">=</span> <span class="va">bert_subset</span>,          </span>
<span>                    transform <span class="op">=</span> <span class="cn">TRUE</span>,                      </span>
<span>                    transform_matrix <span class="op">=</span> <span class="va">bt_transform</span>,       </span>
<span>                    jackknife <span class="op">=</span> <span class="cn">TRUE</span>,                      </span>
<span>                    confidence_level <span class="op">=</span> <span class="fl">0.95</span>,             </span>
<span>                    permute <span class="op">=</span> <span class="cn">TRUE</span>,                      </span>
<span>                    num_permutations <span class="op">=</span> <span class="fl">100</span>,               </span>
<span>                    window <span class="op">=</span> <span class="fl">6</span>,                          </span>
<span>                    case_insensitive <span class="op">=</span> <span class="cn">TRUE</span>,              </span>
<span>                    verbose <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="co">#&gt; Note: These values are not regression coefficients. Check out the Quick Start Guide for help with interpretation: </span></span>
<span><span class="co">#&gt; https://github.com/prodriguezsosa/conText/blob/master/vignettes/quickstart.md</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;   coefficient normed.estimate std.error  lower.ci  upper.ci p.value</span></span>
<span><span class="co">#&gt; 1     party_R        356.6359  260.9005 -155.3911  868.6629    0.20</span></span>
<span><span class="co">#&gt; 2    gender_M        571.7142  276.0198   30.0149 1113.4134    0.07</span></span></code></pre></div>
</div>
<div class="section level4">
<h4 id="comparision-of-different-embedding-approaches">Comparision of Different Embedding Approaches<a class="anchor" aria-label="anchor" href="#comparision-of-different-embedding-approaches"></a>
</h4>
<div style="text-align: justify;">
<p>While this tutorial doesn’t determine a definitive best approach,
it’s important to understand the key distinctions between word embedding
methods. BERT, FastText, Flair Stacked Embeddings, and GloVe can be
categorized into two groups: dynamic and static embeddings.</p>
<p>Dynamic embeddings, such as BERT and Flair, adapt their word
representations based on context using high-dimensional vector spaces
(BERT uses 768 dimensions in its base model). BERT employs
self-attention mechanisms and subword tokenization, while Flair uses
character-level modeling. Both effectively handle out-of-vocabulary
words through these mechanisms.</p>
<p>However, it’s worth noting that in their case study, where they
provide selected words, in our case study we directly extract individual
word vectors from BERT and Flair (forward/backward) embeddings using
those selected words. This approach doesn’t truly achieve the intended
contextual modeling. A more meaningful approach would be to extract
embeddings at the quasi-sentence or paragraph level. Alternatively,
pooling the entire document before extracting embeddings could be more
valuable.</p>
<p>These context-based approaches differ significantly from GloVe’s
methodology, which relies on pre-computed global word-word co-occurrence
statistics to generate static word vectors.</p>
</div>
<p><img src="tutorial_files/figure-html/unnamed-chunk-119-1.png" width="95%"></p>
</div>
</div>
</div>

  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



   </div>
  <footer><div class="container">
  <div class="pkgdown-footer-left">
  <p>Developed by <a href="https://davidycliao.github.io" class="external-link">Yen-Chieh Liao</a>, <a href="https://muellerstefan.net" class="external-link">Stefan Müller</a>, Akbik Alan, Blythe Duncan, Vollgraf Roland.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.1.</p>
</div>

  </div></footer>
</body>
</html>
