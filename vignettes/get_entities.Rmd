---
title: "Tagging Named Entities with Flair Standard Models"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{Tagging Named Entities with Flair Standard Models}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>"
)
```

```{r include=FALSE}
reticulate::py_install("flair")
```

## List of NER Models

| ID                  | Task              | Language         | Training Dataset            | Accuracy     | Contributor / Notes    |
|---------------------|-------------------|------------------|-----------------------------|--------------|------------------------|
| 'ner'               | NER (4-class)     | English          | Conll-03                    | 93.03 (F1)   |                        |
| 'ner-fast'          | NER (4-class)     | English          | Conll-03                    | 92.75 (F1)   | (fast model)           |
| 'ner-large'         | NER (4-class)     | English / Multilingual | Conll-03                | 94.09 (F1)   | (large model)          |
| 'ner-pooled'        | NER (4-class)     | English          | Conll-03                    | 93.24 (F1)   | (memory inefficient)   |
| 'ner-ontonotes'     | NER (18-class)    | English          | Ontonotes                   | 89.06 (F1)   |                        |
| 'ner-ontonotes-fast'| NER (18-class)    | English          | Ontonotes                   | 89.27 (F1)   | (fast model)           |
| 'ner-ontonotes-large'| NER (18-class)   | English / Multilingual | Ontonotes               | 90.93 (F1)   | (large model)          |
| 'ar-ner'            | NER (4-class)     | Arabic           | AQMAR & ANERcorp (curated)  | 86.66 (F1)   |                        |
| 'da-ner'            | NER (4-class)     | Danish           | Danish NER dataset          |              | AmaliePauli            |
| 'de-ner'            | NER (4-class)     | German           | Conll-03                    | 87.94 (F1)   |                        |
| 'de-ner-large'      | NER (4-class)     | German / Multilingual | Conll-03                 | 92.31 (F1)   |                        |
| 'de-ner-germeval'   | NER (4-class)     | German           | Germeval                    | 84.90 (F1)   |                        |
| 'de-ner-legal'      | NER (legal text)  | German           | LER dataset                 | 96.35 (F1)   |                        |
| 'fr-ner'            | NER (4-class)     | French           | WikiNER (aij-wikiner-fr-wp3)| 95.57 (F1)   | mhham                  |
| 'es-ner-large'      | NER (4-class)     | Spanish          | CoNLL-03                    | 90.54 (F1)   | mhham                  |
| 'nl-ner'            | NER (4-class)     | Dutch            | CoNLL 2002                  | 92.58 (F1)   |                        |
| 'nl-ner-large'      | NER (4-class)     | Dutch            | Conll-03                    | 95.25 (F1)   |                        |
| 'nl-ner-rnn'        | NER (4-class)     | Dutch            | CoNLL 2002                  | 90.79 (F1)   |                        |
| 'ner-ukrainian'     | NER (4-class)     | Ukrainian        | NER-UK dataset              | 86.05 (F1)   | dchaplinsky             |


__Source__: https://flairnlp.github.io/docs/tutorial-basics/tagging-entities


## An Example Using `ner` Model (Pre-trained NER English Model)


```{r}
library(flaiR)
data("uk_immigration")
uk_immigration <- head(uk_immigration, 5)
```


Use `load_tagger_ner` to call the NER pretrained model. The model will be downloaded from Flair's Hugging Face repo. Thus, ensure you have an internet connection. Once downloaded, the model will be stored in __.flair__ as the cache in your device. So, once you've downloaded it and it hasn't been manually removed, executing the command again will not trigger a download.
```{r}
tagger_pos <- flaiR::load_tagger_ner("ner")
```

If you want the computation to run faster, it is recommended to keep the show.text_id set to FALSE by default. Additionally, when processing large texts, it can cause R's memory to expand, so it's suggested to set `gc.active` to TRUE. This doesn't necessarily improve computational efficiency but can prevent RStudio from failing.

```{r setup}
show.text_id_isFALE <- system.time({
    results <- get_entities(uk_immigration$text, uk_immigration$speaker, 
                            tagger_pos,
                            show.text_id = FALSE,
                            gc.active = TRUE)
    gc()
})
```


```{r}
print(show.text_id_isFALE)
```

```{r}
print(results)
```

If `show.text_id` is set to TRUE, the original text will be displayed, but it will occupy a significant amount of computer memory space when processing a large amount of text.
```{r }
show.text_id_isTRUE <- system.time({
    results <- get_entities(uk_immigration$text, uk_immigration$speaker, 
                            tagger_pos,
                            show.text_id = TRUE,
                            gc.active = TRUE)
    gc()
})
```

```{r}
print(show.text_id_isTRUE)
```

```{r}
print(results)
```
